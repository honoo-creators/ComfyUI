import{a8 as we,as as r,aj as x,az as je,ad as s,o as n,B as he,a6 as e,a5 as t,ax as Le,av as I,x as ve,k as T,aD as ye,v as ke,aI as U,q as Ue,ai as Me,i as Ce,m as be,w as $e,l as a,an as _,ao as M,g as Ae,f as Ge,b7 as Qe,au as pe,a9 as Ve,b as m,b8 as qe,aN as We,at as Fe,aT as de,af as Z,y as He,a$ as fe,j as Ye,p as Ke,t as Je,a0 as Xe,aX as Ze,z as et,al as tt,a as D,aw as me,n as ee,c as j,ac as at,b9 as nt}from"./DSpykZFe.js";import{_ as ot}from"./C2hCeMaT.js";import{_ as st}from"./DIg8J3yP.js";import{_ as lt}from"./CAOfRVqV.js";import{_ as it}from"./JfUvbmD8.js";const ut=we({__name:"OutputStatusIndicator",props:{paused:{type:Boolean,default:!1},processing:{type:Boolean,default:!1},progress:{type:Number,default:0},count:{type:Number,default:0},total:{type:Number,default:0}},emits:["pause","resume","next","end"],setup(g,{emit:B}){const A=g,w=B,h=r(0),y=x(()=>A.paused?"light060":"light");return(te,o)=>{const G=ke,k=ye,p=ve,Q=Ue,R=be,u=Ce,d=$e,v=he,i=je("resize");return n(),s(v,{class:"outputStatusIndicator"},{default:e(()=>[t(p,{w:a(h)+24,r:"full",h:"40",color:"dark",animation:"",relative:"",overflow:""},{default:e(()=>[Le((n(),s(v,{class:"outputStatusIndicator-inner",align:"center",gap:"12","fit-h":"",nowrap:""},{default:e(()=>[t(p,{w:"24","min-w":"24",h:"24","min-h":"24",relative:""},{default:e(()=>[g.processing?(n(),s(p,{key:0,w:"100%",h:"100%",relative:""},{default:e(()=>[t(k,null,{default:e(()=>[t(G,{size:"20",color:"light"})]),_:1})]),_:1})):(n(),T(U,{key:1},[t(Q,Me({percent:g.progress},{size:"24",stroke:"4",color:"light"}),null,16),t(p,{absolute:"",top:"0",left:"0",w:"100%",h:"100%"},{default:e(()=>[g.paused?(n(),s(u,{key:1,link:"","no-padding":"",w:"100%",h:"100%",onClick:o[1]||(o[1]=f=>w("resume"))},{default:e(()=>[t(k,null,{default:e(()=>[t(p,{pl:"2",pt:"1"},{default:e(()=>[t(R,{name:"play",size:"10",color:"light"})]),_:1})]),_:1})]),_:1})):(n(),s(u,{key:0,link:"","no-padding":"",w:"100%",h:"100%",onClick:o[0]||(o[0]=f=>w("pause"))},{default:e(()=>[t(k,null,{default:e(()=>[t(p,{pt:"1"},{default:e(()=>[t(R,{name:"pause",size:"10",color:"light"})]),_:1})]),_:1})]),_:1}))]),_:1})],64))]),_:1}),t(p,{mt:"-2"},{default:e(()=>[t(v,{align:"center",gap:"2",nowrap:""},{default:e(()=>[t(d,{body:"",bold:"",color:a(y),"cap-height-baseline":"",unselectable:""},{default:e(()=>[_(M(g.count),1)]),_:1},8,["color"]),t(d,{caption2:"",bold:"",color:a(y),"cap-height-baseline":"",unselectable:""},{default:e(()=>o[4]||(o[4]=[_(" / ")])),_:1},8,["color"]),t(d,{body:"",bold:"",color:a(y),"cap-height-baseline":"",unselectable:""},{default:e(()=>[_(M(g.total),1)]),_:1},8,["color"])]),_:1})]),_:1}),g.paused?(n(),s(p,{key:0,pt:"0",pl:"8",pr:"4"},{default:e(()=>[t(v,{align:"center",gap:"16",nowrap:""},{default:e(()=>[t(u,{info:"","no-padding":"",small:"",onClick:o[2]||(o[2]=f=>w("next"))},{default:e(()=>o[5]||(o[5]=[_(" 原図を変更 ")])),_:1}),t(u,{link:"","no-padding":"",small:"",onClick:o[3]||(o[3]=f=>w("end"))},{default:e(()=>[t(d,{inherit:"",color:"light"},{default:e(()=>o[6]||(o[6]=[_(" 終了 ")])),_:1})]),_:1})]),_:1})]),_:1})):I("",!0)]),_:1})),[[i,f=>h.value=f.width]])]),_:1},8,["w"])]),_:1})}}}),rt={class:"pageOutput",full:""},ct={key:0},_e=1e3,L=3,ge=99,gt=we({__name:"output",setup(g){const{isQueue:B,output:A,isInitQueue:w,progress:h,previewImageUrl:y,state:te}=m(),o=Ae(),{processing:G}=Ge(Qe()),k=r(null),p=r(0),Q=r(0),R=r(!1),u=r(!1),d=r(!1),v=r(!1),i=r([]),f=r(!1),ae=r("Starting."),V=r(-1),C=r(!1);let q=1,W;const F=x(()=>i.value.length===ge),Ee=x(()=>!w.value&&(h.value>=0||i.value.length>0)?!0:w.value),ne=x(()=>o.imageHeight/o.imageWidth*100),oe=x(()=>o.prompt),Ie=async()=>{await D().open({name:"prompt"})||(await z(),await m().postInterrupt(),p.value=0,Q.value=0,R.value=!1,i.value=[],await me(),await o.setWorkflow(),o.incrementRetryCount(),S())},Te=()=>{o.incrementRetryCount(),ee(j().GENERATE_UPLOAD)},Se=()=>{o.init(),ee(j().GENERATE_LOOKSTYLE)},ze=async l=>{C.value=!0,await D().open({name:"upscaleSelect",options:{src:i.value[l]}}),C.value=!1,O()},Ne=l=>{i.value.splice(l,1)},Pe=async()=>{const l=await D().open({name:"uploadImage"});l&&l.base64&&l.file&&(o.continue(l.base64,l.file),ee(j().GENERATE_CONFIRM))},se=async()=>{await D().open({name:"generateEndDialog"})&&(o.init(),at().replace(j().GENERATE_LOOKSTYLE))},xe=async l=>{await nt().open({name:"imagePreview",options:{index:l,list:i.value,onDownloadStart:()=>C.value=!0,onDownloadEnd:()=>C.value=!1}}),B.value||O()},S=async()=>{F.value||u.value||C.value||(B.value?(await Z().wait(_e),S()):(v.value=!0,await z(),u.value=!1,await m().queuePrompt({json:JSON.stringify(m().workflow.updateSeed(o.workflow)),batchCount:1}),v.value=!1))},H=async()=>{d.value=!0,v.value?(await Z().wait(_e),await H()):(await z(),await m().postInterrupt(),d.value=!1,u.value=!0)},O=()=>{u.value=!1,S()},z=async()=>{await m().queueClear(),await m().historyClear()};return pe(()=>A.value,async l=>{if(!C.value&&l&&l.length>0){const c=l[l.length-1];c.includes("upscale")||i.value.push(c),k.value&&(await me(),await Z().wait(250),k.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),pe(()=>i.value.length,async(l,c)=>{c!==void 0&&l>c&&S()},{immediate:!0}),Ve(async()=>{await z(),await m().postInterrupt(),S(),W=qe(()=>{q=q%3+1,ae.value=" Starting "+".".repeat(q)},1e3),f.value=!0}),We(async()=>{await z(),await m().postInterrupt(),W!==null&&clearInterval(W)}),(l,c)=>{const le=Ke,Y=Ye,ie=ot,N=be,P=Ce,K=he,J=He,X=Je,Be=ke,ue=ye,$=ve,Re=Xe,re=$e,Oe=et,De=st;return n(),T("div",rt,[t(K,{justify:"center",gap:[8,28],split:L},{default:e(()=>[(n(!0),T(U,null,fe(a(i),(b,E)=>(n(),s(J,{key:`pageOutput-item-generate-${E}`,justify:"center",gap:"10"},{default:e(()=>[t(ie,{per:a(ne)},{default:e(()=>[t(Y,{onClick:ce=>xe(E)},{default:e(()=>[t(le,{class:"pageOutput-img",src:b,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(K,{justify:"center",gap:"20"},{default:e(()=>[t(P,{w:"20",h:"20","no-padding":"",link:"",onClick:ce=>ze(E)},{default:e(()=>[t(N,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(P,{w:"20",h:"20","no-padding":"",link:"",onClick:ce=>Ne(E)},{default:e(()=>[t(N,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(F)?I("",!0):(n(!0),T(U,{key:0},fe(L-a(i).length%L,b=>(n(),s(ie,{key:`pageOutput-item-${b}`,class:"pageOutput-img",per:a(ne)},{default:e(()=>[b===1?(n(),s($,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:E=>V.value=b,onMouseleave:c[0]||(c[0]=E=>V.value=-1)},{default:e(()=>[a(G)?(n(),s(X,{key:0,w:"100%",h:"100%"})):a(y)?(n(),s(le,{key:2,src:a(y),cover:""},null,8,["src"])):(n(),s(X,{key:1,w:"100%",h:"100%",animation:""})),t(Re,{duration:"100"},{default:e(()=>[a(V)===b||a(u)?(n(),s($,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"text060"},{default:e(()=>[t(ue,null,{default:e(()=>[a(d)?(n(),T("div",ct,[t(Be,{size:"2.2vw",color:"light"})])):a(u)?(n(),s(Y,{key:2,onClick:O},{default:e(()=>[t(N,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),s(Y,{key:1,onClick:H},{default:e(()=>[t(N,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):I("",!0)]),_:2},1024),!a(C)&&!a(u)&&!a(d)?(n(),s($,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark-090","min-w":"32",h:"18",r:"4",pt:"3.7",pr:"4",pl:"4","bg-blur":""},{default:e(()=>[a(te)==="executing"&&a(y)&&a(f)?(n(),s(re,{key:0,footnote:"",bold:"",center:"",color:"light","cap-height-baseline":""},{default:e(()=>[_(M(Math.round(a(h)*100))+"% ",1)]),_:1})):!a(w)||a(h)===0||!a(f)?(n(),s(re,{key:1,footnote:"",bold:"",color:"light","cap-height-baseline":"",style:{width:"56px"}},{default:e(()=>[_(M(a(ae)),1)]),_:1})):I("",!0)]),_:1})):I("",!0)]),_:2},1032,["onMouseover"])):(n(),s(X,{key:1,w:"100%",h:"100%",animation:!a(Ee),delay:b/L*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t($,{h:"80"}),a(F)?(n(),s(J,{key:0,justify:"center",gap:"40"},{default:e(()=>[t(Ze,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Oe,null,{default:e(()=>[t(J,{justify:"stretch",gap:"20"},{default:e(()=>[t(P,{onClick:Te},{default:e(()=>c[1]||(c[1]=[_(" 内容を変更してやり直す ")])),_:1}),t(P,{info:"",onClick:Se},{default:e(()=>c[2]||(c[2]=[_(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),s($,{key:1,fixed:"",bottom:"20",left:"0",right:"0"},{default:e(()=>[t(ue,null,{default:e(()=>[t(ut,{paused:a(u),processing:!a(i).length&&!a(h)&&!a(u)||a(d),progress:a(i).length+a(h),count:a(i).length,total:ge,onPause:H,onResume:O,onNext:Pe,onEnd:se},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),Fe("div",{ref_key:"element",ref:k,class:"pageOutput-scrollTarget"},null,512),a(f)?(n(),T(U,{key:2},[(n(),s(de,{to:"#headerWideCenter"},[t(K,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:e(()=>[t(it,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:e(()=>[t(lt,{class:tt(["headerPrompt-list-inner",{_empty:a(oe).length===0}]),name:"プロンプト",data:a(oe),more:""},null,8,["class","data"])]),_:1}),t($,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:e(()=>[t(P,{w:"100%",h:"100%",info:"",onClick:Ie},{default:e(()=>[t(N,{name:"edit",size:"20",gradation:"horizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(de,{to:"#headerWideRightEnd"},[t(De,{class:"headerEndBtn",link:"",xsmall:"",icon:{name:"cross",size:20},onClick:se})]))],64)):I("",!0)])}}});export{gt as default};
