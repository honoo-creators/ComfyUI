var A=i=>{throw TypeError(i)};var I=(i,r,e)=>r.has(i)||A("Cannot "+e);var E=(i,r,e)=>(I(i,r,"read from private field"),e?e.call(i):r.get(i)),_=(i,r,e)=>r.has(i)?A("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(i):r.set(i,e);var d=(i,r,e)=>(I(i,r,"access private method"),e);import{bj as j,bk as x,bg as O,ab as R,n as D,aD as U,ak as N,al as L,ae as J,k as B,b5 as q,aM as M,aj as z,e as H,p as V,c as T,ac as g,u as c,az as Q,w as u,H as G,D as F,b3 as W,o as h,a as p,G as K,am as X,v as Y,j as Z,aE as ee,b as te,m as C,d as b}from"./Dc-E6pfJ.js";import{_ as se}from"./CZCgHkdn.js";var m,o,P,k,v;class ae extends EventTarget{constructor(){super();_(this,o);_(this,m,new Set);this.api_host=location.host,this.api_base=location.pathname.split("/").slice(0,-1).join("/"),this.initialClientId=sessionStorage.getItem("clientId")}apiURL(e){return this.api_base+e}fetchApi(e,t){return t||(t={}),t.headers||(t.headers={}),t.headers["Comfy-User"]=this.user,fetch(this.apiURL(e),t)}addEventListener(e,t,s){super.addEventListener(e,t,s),E(this,m).add(e)}init(){d(this,o,k).call(this)}async getExtensions(){return await(await this.fetchApi("/extensions",{cache:"no-store"})).json()}async getEmbeddings(){return await(await this.fetchApi("/embeddings",{cache:"no-store"})).json()}async getNodeDefs(){return await(await this.fetchApi("/object_info",{cache:"no-store"})).json()}async queuePrompt(e,{output:t,workflow:s}){const a={client_id:this.clientId,prompt:t,extra_data:{extra_pnginfo:{workflow:s}}};e===-1?a.front=!0:e!=0&&(a.number=e);const n=await this.fetchApi("/prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(n.status!==200)throw{response:await n.json()};return await n.json()}async getItems(e){return e==="queue"?this.getQueue():this.getHistory()}async getQueue(){try{const t=await(await this.fetchApi("/queue")).json();return{Running:t.queue_running.map(s=>({prompt:s,remove:{name:"Cancel",cb:()=>api.interrupt()}})),Pending:t.queue_pending.map(s=>({prompt:s}))}}catch(e){return console.error(e),{Running:[],Pending:[]}}}async getHistory(e=200){try{const t=await this.fetchApi(`/history?max_items=${e}`);return{History:Object.values(await t.json())}}catch(t){return console.error(t),{History:[]}}}async getSystemStats(){return await(await this.fetchApi("/system_stats")).json()}async deleteItem(e,t){await d(this,o,v).call(this,e,{delete:[t]})}async clearItems(e){await d(this,o,v).call(this,e,{clear:!0})}async interrupt(){await d(this,o,v).call(this,"interrupt",null)}async getUserConfig(){return(await this.fetchApi("/users")).json()}createUser(e){return this.fetchApi("/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})})}async getSettings(){return(await this.fetchApi("/settings")).json()}async getSetting(e){return(await this.fetchApi(`/settings/${encodeURIComponent(e)}`)).json()}async storeSettings(e){return this.fetchApi("/settings",{method:"POST",body:JSON.stringify(e)})}async storeSetting(e,t){return this.fetchApi(`/settings/${encodeURIComponent(e)}`,{method:"POST",body:JSON.stringify(t)})}async getUserData(e,t){return this.fetchApi(`/userdata/${encodeURIComponent(e)}`,t)}async storeUserData(e,t,s={overwrite:!0,stringify:!0,throwOnError:!0}){const a=await this.fetchApi(`/userdata/${encodeURIComponent(e)}?overwrite=${s==null?void 0:s.overwrite}`,{method:"POST",body:s!=null&&s.stringify?JSON.stringify(t):t,...s});if(a.status!==200&&(s==null?void 0:s.throwOnError)!==!1)throw new Error(`Error storing user data file '${e}': ${a.status} ${(await a).statusText}`);return a}async deleteUserData(e){const t=await this.fetchApi(`/userdata/${encodeURIComponent(e)}`,{method:"DELETE"});if(t.status!==204)throw new Error(`Error removing user data file '${e}': ${t.status} ${t.statusText}`)}async moveUserData(e,t,s={overwrite:!1}){return await this.fetchApi(`/userdata/${encodeURIComponent(e)}/move/${encodeURIComponent(t)}?overwrite=${s==null?void 0:s.overwrite}`,{method:"POST"})}async listUserData(e,t,s){const a=await this.fetchApi(`/userdata?${new URLSearchParams({recurse:t,dir:e,split:s})}`);if(a.status===404)return[];if(a.status!==200)throw new Error(`Error getting user data list '${e}': ${a.status} ${a.statusText}`);return a.json()}}m=new WeakMap,o=new WeakSet,P=function(){O(async()=>{try{const t=await(await this.fetchApi("/prompt")).json();this.dispatchEvent(new CustomEvent("status",{detail:t}))}catch{this.dispatchEvent(new CustomEvent("status",{detail:null}))}},1e3)},k=function(e){if(this.socket)return;let t=!1,s=window.name;s&&(s="?clientId="+s),this.socket=new WebSocket(`ws${window.location.protocol==="https:"?"s":""}://${this.api_host}${this.api_base}/ws${s}`),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",()=>{t=!0,e&&this.dispatchEvent(new CustomEvent("reconnected"))}),this.socket.addEventListener("error",()=>{this.socket&&this.socket.close(),!e&&!t&&d(this,o,P).call(this)}),this.socket.addEventListener("close",()=>{setTimeout(()=>{this.socket=null,d(this,o,k).call(this,!0)},300),t&&(this.dispatchEvent(new CustomEvent("status",{detail:null})),this.dispatchEvent(new CustomEvent("reconnecting")))}),this.socket.addEventListener("message",a=>{try{if(a.data instanceof ArrayBuffer){const f=new DataView(a.data).getUint32(0),l=a.data.slice(4);switch(f){case 1:const y=new DataView(a.data).getUint32(0);let w;switch(y){case 1:default:w="image/jpeg";break;case 2:w="image/png"}const $=new Blob([l.slice(4)],{type:w});this.dispatchEvent(new CustomEvent("b_preview",{detail:$}));break;default:throw new Error(`Unknown binary websocket message of type ${f}`)}}else{const n=JSON.parse(a.data);switch(n.type){case"status":n.data.sid&&(this.clientId=n.data.sid,window.name=this.clientId,sessionStorage.setItem("clientId",this.clientId)),this.dispatchEvent(new CustomEvent("status",{detail:n.data.status}));break;case"progress":this.dispatchEvent(new CustomEvent("progress",{detail:n.data}));break;case"executing":this.dispatchEvent(new CustomEvent("executing",{detail:n.data.display_node}));break;case"executed":this.dispatchEvent(new CustomEvent("executed",{detail:n.data}));break;case"execution_start":this.dispatchEvent(new CustomEvent("execution_start",{detail:n.data}));break;case"execution_success":this.dispatchEvent(new CustomEvent("execution_success",{detail:n.data}));break;case"execution_error":this.dispatchEvent(new CustomEvent("execution_error",{detail:n.data}));break;case"execution_cached":this.dispatchEvent(new CustomEvent("execution_cached",{detail:n.data}));break;default:if(E(this,m).has(n.type))this.dispatchEvent(new CustomEvent(n.type,{detail:n.data}));else throw new Error(`Unknown message type ${n.type}`)}}}catch(n){console.warn("Unhandled message:",a.data,n)}})},v=async function(e,t){try{await this.fetchApi("/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0})}catch(s){console.error(s)}};const ne=()=>{const i=j("comfyAPI",()=>new ae);return{init:()=>{i.value.init(),window.comfyAPI=window.comfyAPI||{},window.comfyAPI.api=window.comfyAPI.api||{},window.comfyAPI.api.api=i},api:x(i.value)}},ie={class:"pageDashboard"},ue=R({__name:"index",setup(i){const{list:r,active:e}=D(U()),t=N(!1),s=L(()=>W().design.page.spinner.size);return J(async()=>{t.value=!0,await ne().init(),await B().init(),await q().profileUpdate(),await M(),z().query.showMenu==="true"&&H().open({name:"myMenu"}),V().init(),await U().init(),t.value=!1}),(a,n)=>{const f=Y,l=te,S=K,y=G,w=F;return h(),T("div",ie,[c(t)?(h(),g(w,{key:1,size:c(s)},null,8,["size"])):(h(),T(Q,{key:0},[c(r).length?(h(),g(y,{key:0,narrow:""},{default:u(()=>[p(S,{gap:"28"},{default:u(()=>[c(e)?(h(),g(f,{key:0,onClick:n[0]||(n[0]=$=>("useSheet"in a?a.useSheet:c(Z))().open({name:"usageTypeSelect"}))},{default:u(()=>[p(ee,{data:c(e)},null,8,["data"])]),_:1})):X("",!0),p(l,{to:("useConstantsPath"in a?a.useConstantsPath:c(C))().generate("lookstyle")},{default:u(()=>n[1]||(n[1]=[b(" 背景美術生成を開始する ")])),_:1},8,["to"])]),_:1})]),_:1})):(h(),g(y,{key:1},{default:u(()=>[p(se,{icon:"exclamation",title:"ご契約プランがありません",body:"プランにご加入いただくことで<br />生成サービスをご利用いただけます。"},{button:u(()=>[p(l,{to:`${("useConstantsPath"in a?a.useConstantsPath:c(C))().ROOT}#pricing`},{default:u(()=>n[2]||(n[2]=[b(" プランを詳しくみる ")])),_:1},8,["to"]),p(l,{info:"",to:("useConstantsPath"in a?a.useConstantsPath:c(C))().JOIN},{default:u(()=>n[3]||(n[3]=[b(" エンタープライズコードをお持ちの方はこちら ")])),_:1},8,["to"])]),_:1})]),_:1}))],64))])}}});export{ue as default};
