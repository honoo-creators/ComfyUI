import{d as he,ab as ke,r,k as $,$ as ye,o as we,S as X,at as Ce,a0 as $e,f as E,h as e,w as t,l as a,p as s,t as v,N as D,ae as Z,e as Ee,c as b,a6 as be,a5 as h,D as Te,B as Ie,J as Oe,g as n,M as ee,al as ze,q as k,v as Ne,O as M,n as U,K as Re,_ as Se,F as Pe,ac as Le,H as te,au as Be,V as De,L as Me,av as Ue,z as je}from"./DRtnay5Q.js";import{_ as xe}from"./BaStOyk_.js";import{_ as Ae}from"./m2fR89IK.js";import{_ as qe}from"./Cs6KhVPa.js";import{_ as Ge}from"./D5FXmLHB.js";import{_ as He}from"./CWyfg425.js";const Ve=1e3,T=3,ae=99,Ze=he({__name:"output",setup(Fe){const{isQueue:I,output:ne,isInitQueue:O,progress:z,previewImageUrl:j}=h(),c=ke(),N=r(null),oe=r(0),se=r(0),le=r(!1),m=r(!1),i=r([]),x=r(!1),A=r("Starting."),R=r(-1),f=r(!1);let S=1,P;const y=$(()=>i.value.length===ae),ie=$(()=>!O.value&&(z.value>=0||i.value.length>0)?!0:O.value),q=$(()=>c.imageHeight/c.imageWidth*100),G=$(()=>c.prompt),ue=async()=>{await M().open({name:"prompt"})||(I.value&&h().postInterrupt(),h().queueClear(),oe.value=0,se.value=0,le.value=!1,i.value=[],await X(),await c.setWorkflow(),c.incrementRetryCount(),w())},re=()=>{c.incrementRetryCount(),U(b().GENERATE_UPLOAD)},ce=()=>{c.init(),U(b().GENERATE_LOOKSTYLE)},me=async o=>{f.value=!0,await M().open({name:"upscaleSelect",options:{src:i.value[o]}}),f.value=!1,L()},pe=o=>{i.value.splice(o,1)},_e=async()=>{const o=await M().open({name:"uploadImage"});o&&o.base64&&o.file&&(c.continue(o.base64,o.file),U(b().GENERATE_CONFIRM))},H=()=>{i.value=[],Ee().replace(b().dashboard())},fe=async o=>{await Be().open({name:"imagePreview",options:{index:o,list:i.value,onDownloadStart:()=>f.value=!0,onDownloadEnd:()=>f.value=!1}}),I.value||L()},w=async()=>{y.value||m.value||(I.value?(await be().wait(Ve),w()):(m.value=!1,h().queuePrompt({json:JSON.stringify(c.workflow),batchCount:ae-i.value.length})))},V=()=>{m.value=!0,h().postInterrupt(),h().queueClear()},L=()=>{m.value=!1,w()};return ye(()=>ne.value,o=>{if(!f.value&&o&&o.length>0){const l=o[o.length-1];l.includes("upscale")||i.value.push(l),N.value&&N.value.scrollIntoView({behavior:"smooth",block:"end"})}},{deep:!0}),we(async()=>{await X(),w(),P=Ce(()=>{S=S%3+1,A.value=" Starting "+".".repeat(S)},1e3),x.value=!0}),$e(()=>{V(),P!==null&&clearInterval(P)}),(o,l)=>{const F=De,Q=xe,d=Re,u=Te,B=Ie,C=Oe,W=Ae,de=Me,p=Se,ge=Ue,J=je,K=Pe,ve=qe;return n(),E("div",{ref_key:"element",ref:N,class:"pageOutput",full:""},[e(B,{gap:[8,28],split:T},{default:t(()=>[(n(!0),E(D,null,ee(a(i),(_,g)=>(n(),s(C,{key:`pageOutput-item-generate-${g}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(Q,{per:a(q)},{default:t(()=>[e(Le,{onClick:Y=>fe(g)},{default:t(()=>[e(F,{src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(B,{justify:"center",gap:"20"},{default:t(()=>[e(u,{w:"20",h:"20","no-padding":"",link:"",onClick:Y=>me(g)},{default:t(()=>[e(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(u,{w:"20",h:"20","no-padding":"",link:"",onClick:Y=>pe(g)},{default:t(()=>[e(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(y)?v("",!0):(n(!0),E(D,{key:0},ee(T-a(i).length%T,_=>(n(),s(Q,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:a(q)},{default:t(()=>[_===1?(n(),s(p,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:g=>R.value=_,onMouseleave:l[0]||(l[0]=g=>R.value=-1)},{default:t(()=>[a(j)?(n(),s(F,{key:1,src:a(j),cover:""},null,8,["src"])):(n(),s(W,{key:0,w:"100%",h:"100%",animation:""})),e(ge,{duration:"100"},{default:t(()=>[a(R)===_||a(m)?(n(),s(p,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(de,null,{default:t(()=>[a(m)?(n(),s(u,{key:1,link:"",onClick:L},{default:t(()=>[e(d,{name:"play",size:"20",color:"light"})]),_:1})):(n(),s(u,{key:0,link:"",onClick:V},{default:t(()=>[e(d,{name:"pause",size:"20",color:"light"})]),_:1}))]),_:1})]),_:1})):v("",!0)]),_:2},1024),a(f)?v("",!0):(n(),s(p,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(O)&&a(z)>0?(n(),s(J,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[k(te(Math.round(a(z)*100))+"% ",1)]),_:1})):(n(),s(J,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[k(te(a(A)),1)]),_:1}))]),_:1}))]),_:2},1032,["onMouseover"])):(n(),s(W,{key:1,w:"100%",h:"100%",animation:!a(ie),delay:_/T*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(p,{h:"20"}),a(y)?(n(),s(C,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(ze,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(K,null,{default:t(()=>[e(C,{justify:"stretch",gap:"20"},{default:t(()=>[e(u,{onClick:re},{default:t(()=>l[1]||(l[1]=[k(" 内容を変更してやり直す ")])),_:1}),e(u,{info:"",onClick:ce},{default:t(()=>l[2]||(l[2]=[k(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):v("",!0),e(ve,null,{default:t(()=>[!a(y)&&a(m)?(n(),s(K,{key:0},{default:t(()=>[e(C,{justify:"center"},{default:t(()=>[e(u,{info:"",onClick:_e},{default:t(()=>l[3]||(l[3]=[k(" 続けて他の原図を生成する ")])),_:1}),e(p,{h:"0"}),e(u,{minimal:"",onClick:H},{default:t(()=>l[4]||(l[4]=[k(" 終了する ")])),_:1}),e(p,{h:"40"})]),_:1})]),_:1})):v("",!0)]),_:1}),a(x)?(n(),E(D,{key:1},[(n(),s(Z,{to:"#headerWideCenter"},[e(B,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(He,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:t(()=>[e(Ge,{class:Ne(["headerPrompt-list-inner",{_empty:a(G).length===0}]),name:"プロンプト",data:a(G),more:""},null,8,["class","data"])]),_:1}),e(p,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(u,{w:"100%",h:"100%",info:"",onClick:ue},{default:t(()=>[e(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(Z,{to:"#headerWideRightEnd"},[e(u,{class:"headerEndBtn",link:"",xsmall:"",onClick:H},{default:t(()=>[e(d,{name:"cross",size:"20"})]),_:1})]))],64)):v("",!0)],512)}}});export{Ze as default};
