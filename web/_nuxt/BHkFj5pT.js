import{d as $e,aK as Ee,x as i,h as C,P as be,o as Ie,a5 as _,aU as Te,X as Pe,f as n,g as $,z as e,w as t,F as M,G as ae,Y as a,l as E,i as s,ag as Re,A as b,k as ze,p as Ne,aM as ne,a0 as A,ay as oe,n as j,c as I,e as Oe,aJ as G,D as Se,a2 as xe,t as Be,U as Le,a6 as Ue,E as De,V as Me,aL as Ae,B as se,as as je,a8 as Ge,aA as Ve,R as Qe,_ as qe}from"./Dp9VDKOV.js";import{_ as Fe}from"./CJ50CDcs.js";import{_ as He}from"./BirKD3ie.js";import{_ as We}from"./BSXd2E7S.js";import{_ as Ye}from"./5vRTO_zW.js";import{_ as Je}from"./WiRlcOSv.js";const Ke={class:"pageOutput",full:""},le=1e3,T=3,P=99,st=$e({__name:"output",setup(Xe){const{isQueue:V,output:ie,isInitQueue:R,progress:v,previewImageUrl:Q,queueRemaining:ue}=_(),u=Ee(),z=i(null),re=i(0),ce=i(0),pe=i(!1),r=i(!1),N=i(!1),l=i([]),q=i(!1),F=i("Starting."),O=i(-1),d=i(!1);let S=1,x;const B=C(()=>l.value.length===P),me=C(()=>!R.value&&(v.value>=0||l.value.length>0)?!0:R.value),H=C(()=>u.imageHeight/u.imageWidth*100),W=C(()=>u.prompt),_e=async()=>{await A().open({name:"prompt"})||(await w(),await _().postInterrupt(),re.value=0,ce.value=0,pe.value=!1,l.value=[],await oe(),await u.setWorkflow(),u.incrementRetryCount(),y())},de=()=>{u.incrementRetryCount(),j(I().GENERATE_UPLOAD)},fe=()=>{u.init(),j(I().GENERATE_LOOKSTYLE)},ge=async o=>{d.value=!0,await A().open({name:"upscaleSelect",options:{src:l.value[o]}}),d.value=!1,k()},he=o=>{l.value.splice(o,1)},ve=async()=>{const o=await A().open({name:"uploadImage"});o&&o.base64&&o.file&&(u.continue(o.base64,o.file),j(I().GENERATE_CONFIRM))},Y=()=>{l.value=[],Oe().replace(I().dashboard())},we=async o=>{await je().open({name:"imagePreview",options:{index:o,list:l.value,onDownloadStart:()=>d.value=!0,onDownloadEnd:()=>d.value=!1}}),V.value||k()},y=async()=>{B.value||r.value||(V.value?(await G().wait(le),y()):(await w(),r.value=!1,_().queuePrompt({json:JSON.stringify(u.workflow),batchCount:P-l.value.length})))},L=async()=>{N.value=!0,ue.value<P-l.value.length?(await G().wait(le),await L()):(await w(),await _().postInterrupt(),N.value=!1,r.value=!0)},k=()=>{r.value=!1,y()},w=async()=>{await _().queueClear(),await _().historyClear()};return be(()=>ie.value,async o=>{if(!d.value&&o&&o.length>0){const c=o[o.length-1];c.includes("upscale")||l.value.push(c),z.value&&(await oe(),await G().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),Ie(async()=>{await w(),await _().postInterrupt(),y(),x=Te(()=>{S=S%3+1,F.value=" Starting "+".".repeat(S)},1e3),q.value=!0}),Pe(()=>{w(),x!==null&&clearInterval(x)}),(o,c)=>{const J=Ge,K=Fe,f=Se,p=xe,U=Be,D=Le,X=He,ye=Ve,Z=Ue,g=De,ke=Qe,ee=qe,Ce=Me;return n(),$("div",Ke,[e(U,{justify:"center",gap:[8,28],split:T},{default:t(()=>[(n(!0),$(M,null,ae(a(l),(m,h)=>(n(),s(D,{key:`pageOutput-item-generate-${h}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(K,{per:a(H)},{default:t(()=>[e(Ae,{onClick:te=>we(h)},{default:t(()=>[e(J,{src:m,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(U,{justify:"center",gap:"20"},{default:t(()=>[e(p,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ge(h)},{default:t(()=>[e(f,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(p,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>he(h)},{default:t(()=>[e(f,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(B)?E("",!0):(n(!0),$(M,{key:0},ae(T-a(l).length%T,m=>(n(),s(K,{key:`pageOutput-item-${m}`,class:"pageOutput-img",per:a(H)},{default:t(()=>[m===1?(n(),s(g,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:h=>O.value=m,onMouseleave:c[0]||(c[0]=h=>O.value=-1)},{default:t(()=>[a(Q)?(n(),s(J,{key:1,src:a(Q),cover:""},null,8,["src"])):(n(),s(X,{key:0,w:"100%",h:"100%",animation:""})),e(ke,{duration:"100"},{default:t(()=>[a(O)===m||a(r)?(n(),s(g,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(Z,null,{default:t(()=>[a(N)?(n(),s(p,{key:0,link:""},{default:t(()=>[e(ye,{size:"20",color:"light"})]),_:1})):a(r)?(n(),s(p,{key:2,link:"",onClick:k},{default:t(()=>[e(f,{name:"play",size:"20",color:"light"})]),_:1})):(n(),s(p,{key:1,link:"",onClick:L},{default:t(()=>[e(f,{name:"pause",size:"20",color:"light"})]),_:1}))]),_:1})]),_:1})):E("",!0)]),_:2},1024),!a(d)&&!a(r)?(n(),s(g,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(R)&&a(v)>0?(n(),s(ee,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[b(se(Math.round(a(v)*100))+"% ",1)]),_:1})):(n(),s(ee,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[b(se(a(F)),1)]),_:1}))]),_:1})):E("",!0)]),_:2},1032,["onMouseover"])):(n(),s(X,{key:1,w:"100%",h:"100%",animation:!a(me),delay:m/T*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(g,{h:"40"}),a(B)?(n(),s(D,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Re,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(Ce,null,{default:t(()=>[e(D,{justify:"stretch",gap:"20"},{default:t(()=>[e(p,{onClick:de},{default:t(()=>c[1]||(c[1]=[b(" 内容を変更してやり直す ")])),_:1}),e(p,{info:"",onClick:fe},{default:t(()=>c[2]||(c[2]=[b(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),s(g,{key:1,w:"100%",fixed:"",bottom:"20"},{default:t(()=>[e(Z,null,{default:t(()=>[e(Je,{paused:a(r),processing:!a(l).length&&!a(v)&&!a(r),count:a(l).length+a(v),total:P,onPause:L,onResume:k,onNext:ve,onEnd:Y},null,8,["paused","processing","count"])]),_:1})]),_:1})),ze("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),a(q)?(n(),$(M,{key:2},[(n(),s(ne,{to:"#headerWideCenter"},[e(U,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Ye,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:t(()=>[e(We,{class:Ne(["headerPrompt-list-inner",{_empty:a(W).length===0}]),name:"プロンプト",data:a(W),more:""},null,8,["class","data"])]),_:1}),e(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(p,{w:"100%",h:"100%",info:"",onClick:_e},{default:t(()=>[e(f,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(ne,{to:"#headerWideRightEnd"},[e(p,{class:"headerEndBtn",link:"",xsmall:"",onClick:Y},{default:t(()=>[e(f,{name:"cross",size:"20"})]),_:1})]))],64)):E("",!0)])}}});export{st as default};
