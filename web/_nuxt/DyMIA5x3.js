import{d as te,z as y,c as E,Q as S,o as ne,f as s,k as u,w as e,h as n,i as a,p as ae,aB as w,q as p,g as U,m as G,B as T,H as oe,G as se,n as O,e as L,aA as H,E as ue,ak as le,F as ie,_ as ce,a2 as re,V as _e,y as pe,W as fe,al as me,a0 as I,ar as de}from"./CvNwVGvF.js";import{_ as ge}from"./-6sWPGkG.js";import{_ as ye}from"./DfFKjqG5.js";import{_ as ve}from"./KL11dRCu.js";import{_ as V}from"./DCrCMofR.js";import{u as ke}from"./-l16dqB2.js";import{u as N}from"./CKGx6a2W.js";const he={key:0,class:"pageOutput-info-spinner"},$e=["innerHTML"],Ce=["innerHTML"],z=1e3,D=3,f=9,Pe=te({__name:"output",setup(Ee){const{isQueue:M,output:j}=N(),b=ke(),v=y(0),i=y(0),c=y(!1),l=y([]),k=E(()=>`${l.value.length}/${f}`),h=E(()=>{if(l.value.length===f)return"背景美術を生成しました。";const t=Math.floor(i.value/36e5),o=Math.floor(i.value%36e5/6e4),r=Math.floor(i.value%6e4/1e3);let _="";return t>0&&(_+=`${t}時間`),o>0&&(_+=`${o}分`),_+=`${r}秒`,M.value&&i.value<=0?"...":`あと ${_}`}),$=E(()=>l.value.length===f),x=()=>{P(),O(L().GENERATE_PROMPT_A)},q=()=>{O(L().GENERATE_UPLOAD)},Q=()=>{b.init(),O(L().GENERATE_LOOKSTYLE)},B=async()=>{if(c.value)return;const t=1e3;await H().wait(t),i.value-=t,i.value>=0?B():i.value=0},F=t=>{me().open({name:"imagePreview",options:{list:l.value,index:t}})},d=async()=>{$.value||c.value||(M.value?(await H().wait(z),d()):(c.value=!1,N().queuePrompt({json:JSON.stringify(b.workflow),batchCount:1})))},P=()=>{c.value=!0,N().postInterrupt()},Y=()=>{c.value=!1,d()};return S(()=>j.value,t=>{t&&t.length>0&&(I().public.ENVIRONMENT==="local"?l.value.push(t[0].replace("http://127.0.0.1:8188",I().public.BASE_URL)):l.value.push(t[0]))},{deep:!0}),S(()=>l.value.length,(t,o)=>{if(v.value||(v.value=Date.now()),t===1&&o===0){const r=Date.now()-v.value;i.value=(r+z)*(f-1),B()}t!==o&&t<f&&d()},{immediate:!0}),ne(async()=>{console.log("output onMounted"),d()}),(t,o)=>{const r=ue,_=le,J=ge,K=ie,R=ce,C=re,g=_e,W=de,X=ye,Z=ve,ee=pe,A=fe;return s(),u(A,{class:"pageOutput",wide:""},{default:e(()=>[n(g,{gap:"36"},{default:e(()=>[a($)?(s(),u(V,ae({key:0},{title:a(k),body:a(h)},{icon:"shine"}),null,16)):(s(),u(g,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:e(()=>[n(K,{w:"48",h:"48",mt:"20",relative:""},{default:e(()=>[n(_,null,{default:e(()=>[a(c)?p("",!0):(s(),u(w,{key:0,onClick:P},{default:e(()=>[n(r,{name:"pause",size:"24"})]),_:1})),a(c)?(s(),u(w,{key:1,onClick:Y},{default:e(()=>[n(r,{name:"play",size:"44"})]),_:1})):p("",!0)]),_:1}),a(c)?p("",!0):(s(),U("div",he,[n(J,{size:"64",stroke:"4.4"})]))]),_:1}),a(k)?(s(),u(R,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(k)},null,8,$e)]),_:1})):p("",!0),a(h)?(s(),u(R,{key:1,class:"pageOutput-info-body",caption1:"",bold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(h)},null,8,Ce)]),_:1})):p("",!0),n(C,{class:"pageOutput-info-edit",link:"",xsmall:"","no-padding":"",onClick:x},{default:e(()=>[n(r,{name:"edit",size:"16"}),o[0]||(o[0]=T(" プロンプトを変更 "))]),_:1})]),_:1})),n(ee,{class:"pageOutput-list",gap:"2",split:D},{default:e(()=>[(s(),U(se,null,oe(f,m=>n(Z,{key:`pageOutput-item-${m}`},{default:e(()=>[a(l)[m-1]?(s(),u(w,{key:0,class:"pageOutput-img",onClick:we=>F(m-1)},{default:e(()=>[n(W,{src:a(l)[m-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):(s(),u(X,{key:1,w:"100%",h:"100%",animation:"",delay:m/D*150},null,8,["delay"]))]),_:2},1024)),64))]),_:1}),a($)?(s(),u(g,{key:2,justify:"center",gap:"40"},{default:e(()=>[n(V,{icon:"checkCircleLine",body:"生成画像は以上です"}),n(A,null,{default:e(()=>[n(g,{justify:"stretch",gap:"20"},{default:e(()=>[n(C,{onClick:q},{default:e(()=>o[1]||(o[1]=[T(" 設定を変更してやり直す ")])),_:1}),n(C,{info:"",onClick:Q},{default:e(()=>o[2]||(o[2]=[T(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})}}});export{Pe as default};
