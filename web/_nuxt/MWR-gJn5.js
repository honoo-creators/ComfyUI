import{d as te,aC as ne,x as v,h as w,P as S,o as ae,f as s,i as u,w as e,z as n,Y as a,m as oe,aD as T,l as p,g as U,k as G,A as O,G as se,F as ue,n as L,c as N,aB as I,a5 as M,D as le,aj as ie,E as ce,_ as re,a2 as _e,U as pe,t as fe,V as me,ak as de,$ as V,ar as ge}from"./DHmO57dV.js";import{_ as ye}from"./BohL6lRJ.js";import{_ as ve}from"./8uezsCuj.js";import{_ as ke}from"./D4g9ZAQC.js";import{_ as j}from"./Bwu0yGje.js";const he={key:0,class:"pageOutput-info-spinner"},Ce=["innerHTML"],$e=["innerHTML"],x=1e3,z=3,f=9,Re=te({__name:"output",setup(Ee){const{isQueue:R,output:H}=M(),d=ne(),k=v(0),i=v(0),c=v(!1),l=v([]),h=w(()=>`${l.value.length}/${f}`),C=w(()=>{if(l.value.length===f)return"背景美術を生成しました。";const t=Math.floor(i.value/36e5),o=Math.floor(i.value%36e5/6e4),r=Math.floor(i.value%6e4/1e3);let _="";return t>0&&(_+=`${t}時間`),o>0&&(_+=`${o}分`),_+=`${r}秒`,R.value&&i.value<=0?"...":`あと ${_}`}),$=w(()=>l.value.length===f),Y=()=>{b(),d.incrementRetryCount(),L(N().GENERATE_PROMPT_A)},q=()=>{d.incrementRetryCount(),L(N().GENERATE_UPLOAD)},F=()=>{d.init(),L(N().GENERATE_LOOKSTYLE)},P=async()=>{if(c.value)return;const t=1e3;await I().wait(t),i.value-=t,i.value>=0?P():i.value=0},Q=t=>{de().open({name:"imagePreview",options:{index:t,list:l.value,onDownloadEnd:()=>A()}})},g=async()=>{$.value||c.value||(R.value?(await I().wait(x),g()):(c.value=!1,M().queuePrompt({json:JSON.stringify(d.workflow),batchCount:1})))},b=()=>{c.value=!0,M().postInterrupt()},A=()=>{c.value=!1,g()};return S(()=>H.value,t=>{t&&t.length>0&&(V().public.ENVIRONMENT==="local"?l.value.push(t[0].replace("http://127.0.0.1:8188",V().public.BASE_URL)):l.value.push(t[0]))},{deep:!0}),S(()=>l.value.length,(t,o)=>{if(k.value||(k.value=Date.now()),t===1&&o===0){const r=Date.now()-k.value;i.value=(r+x)*(f-1),P()}t!==o&&t<f&&g()},{immediate:!0}),ae(async()=>{console.log("output onMounted"),g()}),(t,o)=>{const r=le,_=ie,J=ye,K=ce,B=re,E=_e,y=pe,W=ge,X=ve,Z=ke,ee=fe,D=me;return s(),u(D,{class:"pageOutput",wide:""},{default:e(()=>[n(y,{gap:"36"},{default:e(()=>[a($)?(s(),u(j,oe({key:0},{title:a(h),body:a(C)},{icon:"shine"}),null,16)):(s(),u(y,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:e(()=>[n(K,{w:"48",h:"48",mt:"20",relative:""},{default:e(()=>[n(_,null,{default:e(()=>[a(c)?p("",!0):(s(),u(T,{key:0,onClick:b},{default:e(()=>[n(r,{name:"pause",size:"24"})]),_:1})),a(c)?(s(),u(T,{key:1,onClick:A},{default:e(()=>[n(r,{name:"play",size:"44"})]),_:1})):p("",!0)]),_:1}),a(c)?p("",!0):(s(),U("div",he,[n(J,{size:"64",stroke:"4.4"})]))]),_:1}),a(h)?(s(),u(B,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(h)},null,8,Ce)]),_:1})):p("",!0),a(C)?(s(),u(B,{key:1,class:"pageOutput-info-body",caption1:"",bold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(C)},null,8,$e)]),_:1})):p("",!0),n(E,{class:"pageOutput-info-edit",link:"",xsmall:"","no-padding":"",onClick:Y},{default:e(()=>[n(r,{name:"edit",size:"16"}),o[0]||(o[0]=O(" プロンプトを変更 "))]),_:1})]),_:1})),n(ee,{class:"pageOutput-list",gap:"2",split:z},{default:e(()=>[(s(),U(ue,null,se(f,m=>n(Z,{key:`pageOutput-item-${m}`},{default:e(()=>[a(l)[m-1]?(s(),u(T,{key:0,class:"pageOutput-img",onClick:we=>Q(m-1)},{default:e(()=>[n(W,{src:a(l)[m-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):(s(),u(X,{key:1,w:"100%",h:"100%",animation:"",delay:m/z*150},null,8,["delay"]))]),_:2},1024)),64))]),_:1}),a($)?(s(),u(y,{key:2,justify:"center",gap:"40"},{default:e(()=>[n(j,{icon:"checkCircleLine",body:"生成画像は以上です"}),n(D,null,{default:e(()=>[n(y,{justify:"stretch",gap:"20"},{default:e(()=>[n(E,{onClick:q},{default:e(()=>o[1]||(o[1]=[O(" 設定を変更してやり直す ")])),_:1}),n(E,{info:"",onClick:F},{default:e(()=>o[2]||(o[2]=[O(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})}}});export{Re as default};
