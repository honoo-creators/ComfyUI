import{aa as Pe,p as Se,m as Oe,bh as Ne,af as r,ag as b,aL as ae,ab as Re,k as p,bi as ze,b4 as Be,o as n,c as I,a as t,w as a,aO as Q,aP as ne,u as e,aj as C,ai as o,aq as xe,d as T,aB as Le,aG as De,bg as se,j as P,aQ as oe,n as V,l as S,ae as je,a_ as q,v as Me,b as Ue,I as Ae,F as Ge,ak as Qe,E as Ve,G as qe,aM as le,f as Fe,x as We,t as He,A as Ye,B as Ke,a6 as Je,D as Xe}from"./TvOMxzgX.js";import{_ as Ze}from"./7oZ-js4J.js";import{_ as et}from"./CcO8s_QK.js";import{_ as tt}from"./Byy5K5bY.js";import{_ as at}from"./CxTRuXHw.js";import{_ as nt}from"./CvPTlRqN.js";const st={class:"pageOutput",full:""},ie=1e3,O=3,re=99,ft=Pe({__name:"output",setup(ot){const{isQueue:F,output:ue,isInitQueue:N,progress:h,previewImageUrl:R,state:ce}=p(),u=Se(),{processing:pe}=Oe(Ne()),z=r(null),fe=r(0),me=r(0),_e=r(!1),c=r(!1),w=r(!1),B=r(!1),l=r([]),E=r(!1),W=r("Starting."),x=r(-1),m=r(!1);let L=1,D;const j=b(()=>l.value.length===re),de=b(()=>!N.value&&(h.value>=0||l.value.length>0)?!0:N.value),H=b(()=>u.imageHeight/u.imageWidth*100),Y=b(()=>u.prompt),ge=async()=>{await P().open({name:"prompt"})||(await k(),await p().postInterrupt(),fe.value=0,me.value=0,_e.value=!1,l.value=[],await oe(),await u.setWorkflow(),u.incrementRetryCount(),v())},he=()=>{u.incrementRetryCount(),V(S().GENERATE_UPLOAD)},we=()=>{u.init(),V(S().GENERATE_LOOKSTYLE)},ve=async s=>{m.value=!0,await P().open({name:"upscaleSelect",options:{src:l.value[s]}}),m.value=!1,$()},ke=s=>{l.value.splice(s,1)},ye=async()=>{const s=await P().open({name:"uploadImage"});s&&s.base64&&s.file&&(u.continue(s.base64,s.file),V(S().GENERATE_CONFIRM))},K=async()=>{await P().open({name:"generateEndDialog"})&&(u.init(),je().replace(S().GENERATE_LOOKSTYLE))},Ce=async s=>{await Fe().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>m.value=!0,onDownloadEnd:()=>m.value=!1}}),F.value||$()},v=async()=>{j.value||c.value||m.value||(F.value?(await q().wait(ie),v()):(B.value=!0,await k(),c.value=!1,await p().queuePrompt({json:JSON.stringify(p().workflow.updateSeed(u.workflow)),batchCount:1}),B.value=!1))},M=async()=>{w.value=!0,B.value?(await q().wait(ie),await M()):(await k(),await p().postInterrupt(),w.value=!1,c.value=!0)},$=()=>{c.value=!1,v()},k=async()=>{await p().queueClear(),await p().historyClear()};return ae(()=>ue.value,async s=>{if(!m.value&&s&&s.length>0){const i=s[s.length-1];i.includes("upscale")||l.value.push(i),z.value&&(await oe(),await q().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),ae(()=>l.value.length,async(s,i)=>{i!==void 0&&s>i&&v()},{immediate:!0}),Re(async()=>{await k(),await p().postInterrupt(),v(),D=ze(()=>{L=L%3+1,W.value=" Starting "+".".repeat(L)},1e3),E.value=!0}),Be(async()=>{await k(),await p().postInterrupt(),D!==null&&clearInterval(D)}),(s,i)=>{const J=We,Ee=He,X=Ze,y=Me,f=Ue,U=Ae,A=Ge,G=Ye,$e=Ke,Z=Qe,d=Ve,be=Je,ee=Xe,Ie=qe,Te=et;return n(),I("div",st,[t(U,{justify:"center",gap:[8,28],split:O},{default:a(()=>[(n(!0),I(Q,null,ne(e(l),(_,g)=>(n(),o(A,{key:`pageOutput-item-generate-${g}`,justify:"center",gap:"10"},{default:a(()=>[t(X,{per:e(H)},{default:a(()=>[t(Ee,{onClick:te=>Ce(g)},{default:a(()=>[t(J,{class:"pageOutput-img",src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(U,{justify:"center",gap:"20"},{default:a(()=>[t(f,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ve(g)},{default:a(()=>[t(y,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(f,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ke(g)},{default:a(()=>[t(y,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(j)?C("",!0):(n(!0),I(Q,{key:0},ne(O-e(l).length%O,_=>(n(),o(X,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:e(H)},{default:a(()=>[_===1?(n(),o(d,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:g=>x.value=_,onMouseleave:i[0]||(i[0]=g=>x.value=-1)},{default:a(()=>[e(pe)?(n(),o(G,{key:0,w:"100%",h:"100%"})):e(R)?(n(),o(J,{key:2,src:e(R),cover:""},null,8,["src"])):(n(),o(G,{key:1,w:"100%",h:"100%",animation:""})),t(be,{duration:"100"},{default:a(()=>[e(x)===_||e(c)?(n(),o(d,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"text060"},{default:a(()=>[t(Z,null,{default:a(()=>[e(w)?(n(),o(f,{key:0,link:""},{default:a(()=>[t($e,{size:"2.2vw",color:"light"})]),_:1})):e(c)?(n(),o(f,{key:2,link:"",onClick:$},{default:a(()=>[t(y,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(f,{key:1,link:"",onClick:M},{default:a(()=>[t(y,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):C("",!0)]),_:2},1024),!e(m)&&!e(c)&&!e(w)?(n(),o(d,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark-090","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(ce)==="executing"&&e(R)&&e(E)?(n(),o(ee,{key:0,footnote:"",bold:"",center:"",color:"light","cap-height-baseline":""},{default:a(()=>[T(le(Math.round(e(h)*100))+"% ",1)]),_:1})):!e(N)||e(h)===0||!e(E)?(n(),o(ee,{key:1,footnote:"",bold:"",color:"light","cap-height-baseline":"",style:{width:"56px"}},{default:a(()=>[T(le(e(W)),1)]),_:1})):C("",!0)]),_:1})):C("",!0)]),_:2},1032,["onMouseover"])):(n(),o(G,{key:1,w:"100%",h:"100%",animation:!e(de),delay:_/O*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(d,{h:"80"}),e(j)?(n(),o(A,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(xe,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Ie,null,{default:a(()=>[t(A,{justify:"stretch",gap:"20"},{default:a(()=>[t(f,{onClick:he},{default:a(()=>i[1]||(i[1]=[T(" 内容を変更してやり直す ")])),_:1}),t(f,{info:"",onClick:we},{default:a(()=>i[2]||(i[2]=[T(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(d,{key:1,fixed:"",bottom:"20",left:"0",right:"0"},{default:a(()=>[t(Z,null,{default:a(()=>[t(nt,{paused:e(c),processing:!e(l).length&&!e(h)&&!e(c)||e(w),progress:e(l).length+e(h),count:e(l).length,total:re,onPause:M,onResume:$,onNext:ye,onEnd:K},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),Le("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),e(E)?(n(),I(Q,{key:2},[(n(),o(se,{to:"#headerWideCenter"},[t(U,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(at,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(tt,{class:De(["headerPrompt-list-inner",{_empty:e(Y).length===0}]),name:"プロンプト",data:e(Y),more:""},null,8,["class","data"])]),_:1}),t(d,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(f,{w:"100%",h:"100%",info:"",onClick:ge},{default:a(()=>[t(y,{name:"edit",size:"20",gradation:"horizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(se,{to:"#headerWideRightEnd"},[t(Te,{class:"headerEndBtn",link:"",xsmall:"",icon:{name:"cross",size:20},onClick:K})]))],64)):C("",!0)])}}});export{ft as default};
