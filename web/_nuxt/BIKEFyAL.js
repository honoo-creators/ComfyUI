import{d as ge,aI as he,x as u,h as B,P as ve,o as ke,ax as Y,aS as ye,X as we,f as n,g as C,z as e,w as t,F as L,G as J,Y as a,l as g,i as o,A as h,p as Ce,aK as K,a0 as X,a5 as v,n as Z,c as U,e as $e,aH as Ee,D as Te,a2 as be,t as Ie,U as ze,E as Pe,V as Oe,aJ as Re,B as ee,ar as Se,a8 as xe,a6 as Be,R as Le,_ as Ue}from"./Cloa7yoR.js";import{_ as Ne}from"./CSOKIR39.js";import{_ as je}from"./DXf9PSw6.js";import{_ as Ae}from"./BKT6s1PM.js";import{_ as De}from"./W7pTBSEC.js";import{_ as Me}from"./Ce3uDyFM.js";import{_ as Ge}from"./CtS2_DQz.js";const He=1e3,$=3,te=99,Xe=ge({__name:"output",setup(Ve){const{isQueue:E,output:ae,isInitQueue:T,progress:b,previewImageUrl:N}=v(),c=he(),I=u(null),ne=u(0),oe=u(0),se=u(!1),m=u(!1),l=u([]),j=u(!1),A=u("Starting."),z=u(-1),P=u(!1);let O=1,R;const k=B(()=>l.value.length===te),le=B(()=>!T.value&&(b.value>=0||l.value.length>0)?!0:T.value),D=B(()=>c.imageHeight/c.imageWidth*100),ie=async()=>{await X().open({name:"prompt"})||(E.value&&v().postInterrupt(),v().queueClear(),ne.value=0,oe.value=0,se.value=!1,l.value=[],await Y(),await c.setWorkflow(),c.incrementRetryCount(),y())},re=()=>{c.incrementRetryCount(),Z(U().GENERATE_UPLOAD)},ue=()=>{c.init(),Z(U().GENERATE_LOOKSTYLE)},ce=async i=>{P.value=!0,await X().open({name:"upscaleSelect",options:{src:l.value[i]}}),P.value=!1,S()},me=i=>{l.value.splice(i,1)},M=()=>{l.value=[],$e().replace(U().dashboard())},_e=async i=>{await Se().open({name:"imagePreview",options:{index:i,list:l.value}}),E.value||S()},y=async()=>{k.value||m.value||(E.value?(await Ee().wait(He),y()):(m.value=!1,v().queuePrompt({json:JSON.stringify(c.workflow),batchCount:te-l.value.length})))},G=()=>{m.value=!0,v().postInterrupt(),v().queueClear()},S=()=>{m.value=!1,y()};return ve(()=>ae.value,i=>{if(i&&i.length>0){const s=i[i.length-1];s.includes("upscale")||l.value.push(s),I.value&&I.value.scrollIntoView({behavior:"smooth",block:"end"})}},{deep:!0}),ke(async()=>{await Y(),y(),R=ye(()=>{O=O%3+1,A.value=" Starting "+".".repeat(O)},1e3),j.value=!0}),we(()=>{G(),R!==null&&clearInterval(R)}),(i,s)=>{const H=xe,V=Ne,f=Te,r=be,x=Ie,w=ze,q=je,pe=Be,_=Pe,fe=Le,Q=Ue,W=Oe,de=Ae;return n(),C("div",{ref_key:"element",ref:I,class:"pageOutput",full:""},[e(x,{gap:[8,28],split:$},{default:t(()=>[(n(!0),C(L,null,J(a(l),(p,d)=>(n(),o(w,{key:`pageOutput-item-generate-${d}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(V,{per:a(D)},{default:t(()=>[e(Re,{onClick:F=>_e(d)},{default:t(()=>[e(H,{src:p,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(x,{justify:"center",gap:"20"},{default:t(()=>[e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:F=>ce(d)},{default:t(()=>[e(f,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:F=>me(d)},{default:t(()=>[e(f,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(k)?g("",!0):(n(!0),C(L,{key:0},J($-a(l).length%$,p=>(n(),o(V,{key:`pageOutput-item-${p}`,class:"pageOutput-img",per:a(D)},{default:t(()=>[p===1?(n(),o(_,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:d=>z.value=p,onMouseleave:s[0]||(s[0]=d=>z.value=-1)},{default:t(()=>[a(N)?(n(),o(H,{key:1,src:a(N),cover:""},null,8,["src"])):(n(),o(q,{key:0,w:"100%",h:"100%",animation:""})),e(fe,{duration:"100"},{default:t(()=>[a(z)===p||a(m)?(n(),o(_,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(pe,null,{default:t(()=>[a(m)?(n(),o(r,{key:1,link:"",onClick:S},{default:t(()=>[e(f,{name:"play",size:"20",color:"light"})]),_:1})):(n(),o(r,{key:0,link:"",onClick:G},{default:t(()=>[e(f,{name:"pause",size:"20",color:"light"})]),_:1}))]),_:1})]),_:1})):g("",!0)]),_:2},1024),a(P)?g("",!0):(n(),o(_,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(T)&&a(b)>0?(n(),o(Q,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[h(ee(Math.round(a(b)*100))+"% ",1)]),_:1})):(n(),o(Q,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[h(ee(a(A)),1)]),_:1}))]),_:1}))]),_:2},1032,["onMouseover"])):(n(),o(q,{key:1,w:"100%",h:"100%",animation:!a(le),delay:p/$*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(_,{h:"20"}),a(k)?(n(),o(w,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(De,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(W,null,{default:t(()=>[e(w,{justify:"stretch",gap:"20"},{default:t(()=>[e(r,{onClick:re},{default:t(()=>s[1]||(s[1]=[h(" 内容を変更してやり直す ")])),_:1}),e(r,{info:"",onClick:ue},{default:t(()=>s[2]||(s[2]=[h(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),e(de,null,{default:t(()=>[!a(k)&&a(m)?(n(),o(W,{key:0},{default:t(()=>[e(w,{justify:"center"},{default:t(()=>[e(r,{info:""},{default:t(()=>s[3]||(s[3]=[h(" 続けて他の原図を生成する ")])),_:1}),e(_,{h:"0"}),e(r,{minimal:"",onClick:M},{default:t(()=>s[4]||(s[4]=[h(" 終了する ")])),_:1}),e(_,{h:"40"})]),_:1})]),_:1})):g("",!0)]),_:1}),a(j)?(n(),C(L,{key:1},[(n(),o(K,{to:"#headerWideCenter"},[e(x,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Ge,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(Me,{class:Ce(["headerPrompt-list-inner",{_empty:a(c).prompt.length===0}]),name:"プロンプト",data:a(c).prompt},null,8,["class","data"])]),_:1}),e(_,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(r,{w:"100%",h:"100%",info:"",onClick:ie},{default:t(()=>[e(f,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(K,{to:"#headerWideRightEnd"},[e(r,{class:"headerEndBtn",link:"",xsmall:"",onClick:M},{default:t(()=>[e(f,{name:"cross",size:"20"})]),_:1})]))],64)):g("",!0)],512)}}});export{Xe as default};
