import{d as R,a8 as V,z,c as L,f as r,k as l,w as o,h as n,i as e,q as u,B as g,D as j,ah as h,aD as O,a3 as I,Z as W,e as P,ai as F,C as M,W as Q,V as q,_ as J,ap as Y,y as Z,a0 as H,a as K}from"./BFpHv30j.js";import{_ as X}from"./DOis_vKE.js";import{_ as ee}from"./CMsktRJA.js";import{_ as te,a as w}from"./B4h8wYvl.js";import{u as D}from"./Y7XeIKGk.js";import{u as ae}from"./Bfky4g4z.js";import"./HcFoHHq8.js";import"./ANxciWS5.js";const me=R({__name:"confirm",setup(oe){const{lookStyle:E,base64:k,imageFile:N,promptA:d,promptB:c,promptC:m,promptD:f,customWorkflow:S}=D(),{face:U,name:A,ticket:$}=V(),v=K(),T=ae(),C=z(!1),x=L(()=>I().public.COMFYUI_GENERATE_ENABLED),B=()=>{h().alert({title:"ComfyUI Queue Disabled",message:"この環境では画像生成が許可されていません。",icon:"prohibited"})},G=async()=>{C.value=!0;try{const _=await O().optimize(k,512e3),{original_image_id:i}=await v.upload.originalImage(_);let a;if(S)typeof a=="object"&&a!==null&&"nodes"in a&&a.nodes.forEach(t=>{t.type==="CLIPTextEncode"&&Array.isArray(t.widgets_values)&&t.widgets_values.length>0&&(d.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},What to draw,${d.join(",")}`),c.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},Environment around,${c.join(",")}`),m.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},Color tone and mood,${m.join(",")}`),f.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},Lighting,${f.join(",")}`))});else{const{workflow:s}=await v.template.workflow({backgroundArtStyleId:2,prompt:[d,c,m,f].join(" "),retry_count:0,original_image_id:i});a=s}if(I().public.ENVIRONMENT==="local"){const{name:s}=await T.upload.image(N);typeof a=="object"&&a!==null&&"nodes"in a&&a.nodes.forEach(b=>{const p=b;p.type==="LoadImage"&&(p.widgets_values=p.widgets_values.map(y=>typeof y=="string"?s:y))})}D().setWorkflow(JSON.stringify(a)),W().push(P().OUTPUT)}catch(_){C.value=!1,_ instanceof F?h().error(_):h().error({title:"Generate Error",message:"生成に失敗しました。",icon:"exclamation",button:"閉じる",code:M.UnknownError,name:"UnknownError"})}};return(_,i)=>{const a=Q,s=q,t=J,b=Y,p=Z,y=H;return r(),l(s,{class:"pageGenerateConfirm",gap:"28"},{default:o(()=>[n(a,null,{default:o(()=>[n(X,{icon:"document",title:"設定内容の確認",body:"設定内容をご確認ください"})]),_:1}),n(a,null,{default:o(()=>[n(s,{justify:"stretch",gap:"32"},{default:o(()=>[n(s,{justify:"stretch",gap:"8"},{default:o(()=>[e(E)?(r(),l(ee,{key:0,class:"pageGenerateConfirm-lookstyle",data:e(E)},null,8,["data"])):u("",!0),e(k)?(r(),l(te,{key:1,data:e(k)},null,8,["data"])):u("",!0),e(d)?(r(),l(w,{key:2,data:e(d),name:"何を描くか"},null,8,["data"])):u("",!0),e(c)?(r(),l(w,{key:3,data:e(c),name:"周りの環境"},null,8,["data"])):u("",!0),e(m)?(r(),l(w,{key:4,data:e(m),name:"色調・ムード"},null,8,["data"])):u("",!0),e(f)?(r(),l(w,{key:5,data:e(f),name:"ライティング"},null,8,["data"])):u("",!0)]),_:1}),n(t,{title3:"",center:""},{default:o(()=>i[0]||(i[0]=[g(" 上記の設定で背景美術を生成します。 ")])),_:1}),n(s,{justify:"center",gap:"8"},{default:o(()=>[n(b,{src:e(U),size:"72"},null,8,["src"]),n(t,{headline:"",extrabold:"",center:""},{default:o(()=>[g(j(e(A)),1)]),_:1}),e($)!==1/0?(r(),l(p,{key:0,justify:"center",align:"end",gap:"1",nowrap:""},{default:o(()=>[n(t,{body:"",bold:"","baseline-height":""},{default:o(()=>[g(j(e($)),1)]),_:1}),n(t,{caption2:"",bold:"","baseline-height":""},{default:o(()=>i[1]||(i[1]=[g(" チケット ")])),_:1})]),_:1})):u("",!0)]),_:1}),n(y,{loading:e(C),disabled:!e(x),onClick:G,onDisabledClick:B},{default:o(()=>i[2]||(i[2]=[g(" 生成する ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})}}});export{me as default};
