import{ab as ze,p as Ee,n as Be,bf as xe,ak as r,al as P,aJ as ae,ae as De,k as c,l as ne,m as C,bg as Ne,ba as Re,c as S,a as t,ac as s,at as je,am as $,w as a,u as e,az as W,b4 as oe,ag as q,J as Me,G as Oe,F as Ue,o as n,aW as se,v as Le,y as Qe,b as Ve,x as We,B as qe,a7 as He,ao as Ae,D as Fe,E as Ge,d as T,aA as le,aB as Je,H as Ye,aL as Ke,j as z,aM as ie,q as H,f as Xe}from"./Dj0VYh-l.js";import{_ as Ze}from"./CMbKMYN3.js";import{_ as et}from"./B0DW1Cn3.js";import{_ as tt}from"./UbO9YGe3.js";import{_ as at}from"./Dwy3Y6XO.js";import{_ as nt}from"./CAVpwYhC.js";const ot={class:"pageOutput",full:""},re=1e3,E=3,ue=99,ft=ze({__name:"output",setup(st){const{isQueue:A,output:ce,isInitQueue:B,progress:h,previewImageUrl:x,state:pe}=c(),u=Ee(),{processing:fe}=Be(xe()),D=r(null),me=r(0),_e=r(0),de=r(!1),p=r(!1),w=r(!1),N=r(!1),l=r([]),b=r(!1),F=r("Starting."),R=r(-1),m=r(!1);let j=1,M;const O=P(()=>l.value.length===ue),ge=P(()=>!B.value&&(h.value>=0||l.value.length>0)?!0:B.value),G=P(()=>u.imageHeight/u.imageWidth*100),J=P(()=>u.prompt),he=async()=>{await z().open({name:"prompt"})||(await y(),await c().postInterrupt(),me.value=0,_e.value=0,de.value=!1,l.value=[],await ie(),await u.setWorkflow(),u.incrementRetryCount(),v())},we=()=>{u.incrementRetryCount(),H(C().generate("upload"))},ve=()=>{u.init(),H(C().generate("lookstyle"))},ye=async o=>{m.value=!0,await z().open({name:"upscaleSelect",options:{src:l.value[o]}}),m.value=!1,I()},ke=o=>{l.value.splice(o,1)},Ce=async()=>{const o=await z().open({name:"uploadImage"});o&&o.base64&&o.file&&(u.continue(o.base64,o.file),H(C().generate("confirm")))},Y=async()=>{await z().open({name:"generateEndDialog"})&&(u.init(),ne().replace(C().generate("lookstyle")))},$e=async o=>{await Xe().open({name:"imagePreview",options:{index:o,list:l.value,onDownloadStart:()=>m.value=!0,onDownloadEnd:()=>m.value=!1}}),A.value||I()},v=async()=>{O.value||p.value||m.value||(A.value?(await q().wait(re),v()):(N.value=!0,await y(),p.value=!1,await c().queuePrompt({json:JSON.stringify(c().workflow.updateSeed(u.workflow)),batchCount:1}),N.value=!1))},U=async()=>{w.value=!0,N.value?(await q().wait(re),await U()):(await y(),await c().postInterrupt(),w.value=!1,p.value=!0)},I=()=>{p.value=!1,v()},y=async()=>{await c().queueClear(),await c().historyClear()};return ae(()=>ce.value,async o=>{if(!m.value&&o&&o.length>0){const i=o[o.length-1];i.includes("upscale")||l.value.push(i),D.value&&(await ie(),await q().wait(250),D.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),ae(()=>l.value.length,async(o,i)=>{i!==void 0&&o>i&&v()},{immediate:!0}),De(async()=>{if(!c().isInit.value){ne().push(C().comfyuiInit());return}await y(),await c().postInterrupt(),v(),M=Ne(()=>{j=j%3+1,F.value=" Starting "+".".repeat(j)},1e3),b.value=!0}),Re(async()=>{await y(),await c().postInterrupt(),M!==null&&clearInterval(M)}),(o,i)=>{const K=Qe,be=Le,X=Ze,k=We,f=Ve,L=Me,Q=Oe,V=qe,Ie=Fe,Z=Ae,d=Ue,Pe=He,ee=Ge,Se=Ye,Te=et;return n(),S("div",ot,[t(L,{justify:"center",gap:[8,28],split:E},{default:a(()=>[(n(!0),S(W,null,se(e(l),(_,g)=>(n(),s(Q,{key:`pageOutput-item-generate-${g}`,justify:"center",gap:"10"},{default:a(()=>[t(X,{per:e(G)},{default:a(()=>[t(be,{onClick:te=>$e(g)},{default:a(()=>[t(K,{class:"pageOutput-img",src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(L,{justify:"center",gap:"20"},{default:a(()=>[t(f,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ye(g)},{default:a(()=>[t(k,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(f,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ke(g)},{default:a(()=>[t(k,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(O)?$("",!0):(n(!0),S(W,{key:0},se(E-e(l).length%E,_=>(n(),s(X,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:e(G)},{default:a(()=>[_===1?(n(),s(d,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:g=>R.value=_,onMouseleave:i[0]||(i[0]=g=>R.value=-1)},{default:a(()=>[e(fe)?(n(),s(V,{key:0,w:"100%",h:"100%"})):e(x)?(n(),s(K,{key:2,src:e(x),cover:""},null,8,["src"])):(n(),s(V,{key:1,w:"100%",h:"100%",animation:""})),t(Pe,{duration:"100"},{default:a(()=>[e(R)===_||e(p)?(n(),s(d,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"text060"},{default:a(()=>[t(Z,null,{default:a(()=>[e(w)?(n(),s(f,{key:0,link:""},{default:a(()=>[t(Ie,{size:"2.2vw",color:"light"})]),_:1})):e(p)?(n(),s(f,{key:2,link:"",onClick:I},{default:a(()=>[t(k,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),s(f,{key:1,link:"",onClick:U},{default:a(()=>[t(k,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):$("",!0)]),_:2},1024),!e(m)&&!e(p)&&!e(w)?(n(),s(d,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark-090","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(pe)==="executing"&&e(x)&&e(b)?(n(),s(ee,{key:0,footnote:"",bold:"",center:"",color:"light","cap-height-baseline":""},{default:a(()=>[T(le(Math.round(e(h)*100))+"% ",1)]),_:1})):!e(B)||e(h)===0||!e(b)?(n(),s(ee,{key:1,footnote:"",bold:"",color:"light","cap-height-baseline":"",style:{width:"56px"}},{default:a(()=>[T(le(e(F)),1)]),_:1})):$("",!0)]),_:1})):$("",!0)]),_:2},1032,["onMouseover"])):(n(),s(V,{key:1,w:"100%",h:"100%",animation:!e(ge),delay:_/E*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(d,{h:"80"}),e(O)?(n(),s(Q,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(Je,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Se,null,{default:a(()=>[t(Q,{justify:"stretch",gap:"20"},{default:a(()=>[t(f,{onClick:we},{default:a(()=>i[1]||(i[1]=[T(" 内容を変更してやり直す ")])),_:1}),t(f,{info:"",onClick:ve},{default:a(()=>i[2]||(i[2]=[T(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),s(d,{key:1,fixed:"",bottom:"20",left:"0",right:"0"},{default:a(()=>[t(Z,null,{default:a(()=>[t(nt,{paused:e(p),processing:!e(l).length&&!e(h)&&!e(p)||e(w),progress:e(l).length+e(h),count:e(l).length,total:ue,onPause:U,onResume:I,onNext:Ce,onEnd:Y},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),je("div",{ref_key:"element",ref:D,class:"pageOutput-scrollTarget"},null,512),e(b)?(n(),S(W,{key:2},[(n(),s(oe,{to:"#headerWideCenter"},[t(L,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(at,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(tt,{class:Ke(["headerPrompt-list-inner",{_empty:e(J).length===0}]),name:"プロンプト",data:e(J),more:""},null,8,["class","data"])]),_:1}),t(d,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(f,{w:"100%",h:"100%",info:"",onClick:he},{default:a(()=>[t(k,{name:"edit",size:"20",gradation:"horizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(oe,{to:"#headerWideRightEnd"},[t(Te,{class:"headerEndBtn",link:"",xsmall:"",icon:{name:"cross",size:20},onClick:Y})]))],64)):$("",!0)])}}});export{ft as default};
