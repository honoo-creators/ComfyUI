import{d as be,aK as Ie,x as i,h as E,P as se,o as Te,a5 as _,aU as Pe,X as Re,f as n,g as b,z as e,w as t,F as M,G as oe,Y as a,l as w,i as o,ag as ze,A as I,k as Ne,p as Oe,aM as le,a0 as A,ay as ie,n as j,c as T,e as Se,aJ as G,D as xe,a2 as Be,t as Le,U as Ue,a6 as De,E as Me,V as Ae,aL as je,B as ue,as as Ge,a8 as Qe,aA as Ve,R as Fe,_ as He}from"./CfOtJ0CA.js";import{_ as We}from"./CahPzPsO.js";import{_ as qe}from"./BVK-pAG0.js";import{_ as Ye}from"./CzGRioaj.js";import{_ as Je}from"./RQ2n0RjS.js";import{_ as Ke}from"./BiE9LT1J.js";const Xe={class:"pageOutput",full:""},re=1e3,P=3,Q=99,lt=be({__name:"output",setup(Ze){const{isQueue:V,output:ce,isInitQueue:R,progress:y,previewImageUrl:F,state:H}=_(),u=Ie(),z=i(null),pe=i(0),me=i(0),_e=i(!1),r=i(!1),k=i(!1),N=i(!1),l=i([]),W=i(!1),q=i("Starting."),O=i(-1),f=i(!1);let S=1,x;const B=E(()=>l.value.length===Q),fe=E(()=>!R.value&&(y.value>=0||l.value.length>0)?!0:R.value),Y=E(()=>u.imageHeight/u.imageWidth*100),J=E(()=>u.prompt),de=async()=>{await A().open({name:"prompt"})||(await h(),await _().postInterrupt(),pe.value=0,me.value=0,_e.value=!1,l.value=[],await ie(),await u.setWorkflow(),u.incrementRetryCount(),C())},ge=()=>{u.incrementRetryCount(),j(T().GENERATE_UPLOAD)},ve=()=>{u.init(),j(T().GENERATE_LOOKSTYLE)},he=async s=>{f.value=!0,await A().open({name:"upscaleSelect",options:{src:l.value[s]}}),f.value=!1,$()},we=s=>{l.value.splice(s,1)},ye=async()=>{const s=await A().open({name:"uploadImage"});s&&s.base64&&s.file&&(u.continue(s.base64,s.file),j(T().GENERATE_CONFIRM))},K=()=>{l.value=[],Se().replace(T().dashboard())},ke=async s=>{await Ge().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>f.value=!0,onDownloadEnd:()=>f.value=!1}}),V.value||$()},C=async()=>{B.value||r.value||(V.value?(await G().wait(re),C()):(N.value=!0,await h(),r.value=!1,await _().queuePrompt({json:JSON.stringify(u.workflow),batchCount:Q-l.value.length}),N.value=!1))},L=async()=>{k.value=!0,N.value?(await G().wait(re),await L()):(await h(),await _().postInterrupt(),k.value=!1,r.value=!0)},$=()=>{r.value=!1,C()},h=async()=>{await _().queueClear(),await _().historyClear()};return se(()=>ce.value,async s=>{if(!f.value&&s&&s.length>0){const c=s[s.length-1];c.includes("upscale")||l.value.push(c),z.value&&(await ie(),await G().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),se(()=>H.value,async s=>{console.log("state",s)},{deep:!0}),Te(async()=>{await h(),await _().postInterrupt(),C(),x=Pe(()=>{S=S%3+1,q.value=" Starting "+".".repeat(S)},1e3),W.value=!0}),Re(()=>{h(),x!==null&&clearInterval(x)}),(s,c)=>{const X=Qe,Z=We,d=xe,p=Be,U=Le,D=Ue,ee=qe,Ce=Ve,te=De,g=Me,$e=Fe,ae=He,Ee=Ae;return n(),b("div",Xe,[e(U,{justify:"center",gap:[8,28],split:P},{default:t(()=>[(n(!0),b(M,null,oe(a(l),(m,v)=>(n(),o(D,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(Z,{per:a(Y)},{default:t(()=>[e(je,{onClick:ne=>ke(v)},{default:t(()=>[e(X,{src:m,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(U,{justify:"center",gap:"20"},{default:t(()=>[e(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ne=>he(v)},{default:t(()=>[e(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ne=>we(v)},{default:t(()=>[e(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(B)?w("",!0):(n(!0),b(M,{key:0},oe(P-a(l).length%P,m=>(n(),o(Z,{key:`pageOutput-item-${m}`,class:"pageOutput-img",per:a(Y)},{default:t(()=>[m===1?(n(),o(g,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:v=>O.value=m,onMouseleave:c[0]||(c[0]=v=>O.value=-1)},{default:t(()=>[a(F)?(n(),o(X,{key:1,src:a(F),cover:""},null,8,["src"])):(n(),o(ee,{key:0,w:"100%",h:"100%",animation:""})),e($e,{duration:"100"},{default:t(()=>[a(O)===m||a(r)?(n(),o(g,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(te,null,{default:t(()=>[a(k)?(n(),o(p,{key:0,link:""},{default:t(()=>[e(Ce,{size:"2.2vw",color:"light"})]),_:1})):a(r)?(n(),o(p,{key:2,link:"",onClick:$},{default:t(()=>[e(d,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(p,{key:1,link:"",onClick:L},{default:t(()=>[e(d,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):w("",!0)]),_:2},1024),!a(f)&&!a(r)?(n(),o(g,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(H)==="executing"?(n(),o(ae,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[I(ue(Math.round(a(y)*100))+"% ",1)]),_:1})):a(R)?w("",!0):(n(),o(ae,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[I(ue(a(q)),1)]),_:1}))]),_:1})):w("",!0)]),_:2},1032,["onMouseover"])):(n(),o(ee,{key:1,w:"100%",h:"100%",animation:!a(fe),delay:m/P*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(g,{h:"40"}),a(B)?(n(),o(D,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(ze,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(Ee,null,{default:t(()=>[e(D,{justify:"stretch",gap:"20"},{default:t(()=>[e(p,{onClick:ge},{default:t(()=>c[1]||(c[1]=[I(" 内容を変更してやり直す ")])),_:1}),e(p,{info:"",onClick:ve},{default:t(()=>c[2]||(c[2]=[I(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(g,{key:1,w:"100%",fixed:"",bottom:"20"},{default:t(()=>[e(te,null,{default:t(()=>[e(Ke,{paused:a(r),processing:!a(l).length&&!a(y)&&!a(r)||a(k),progress:a(l).length+a(y),count:a(l).length,total:Q,onPause:L,onResume:$,onNext:ye,onEnd:K},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),Ne("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),a(W)?(n(),b(M,{key:2},[(n(),o(le,{to:"#headerWideCenter"},[e(U,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Je,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:t(()=>[e(Ye,{class:Oe(["headerPrompt-list-inner",{_empty:a(J).length===0}]),name:"プロンプト",data:a(J),more:""},null,8,["class","data"])]),_:1}),e(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(p,{w:"100%",h:"100%",info:"",onClick:de},{default:t(()=>[e(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(le,{to:"#headerWideRightEnd"},[e(p,{class:"headerEndBtn",link:"",xsmall:"",onClick:K},{default:t(()=>[e(d,{name:"cross",size:"20"})]),_:1})]))],64)):w("",!0)])}}});export{lt as default};
