var A=o=>{throw TypeError(o)};var I=(o,i,r)=>i.has(o)||A("Cannot "+r);var E=(o,i,r)=>(I(o,i,"read from private field"),r?r.call(o):i.get(o)),_=(o,i,r)=>i.has(o)?A("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(o):i.set(o,r);var l=(o,i,r)=>(I(o,i,"access private method"),r);import{bg as D,ab as N,n as L,aD as U,ak as J,al as B,ae as q,b5 as M,aM as z,aj as H,e as V,p as Q,k as G,c as T,ac as y,u,az as F,w as p,H as W,D as K,b3 as X,o as w,a as m,G as Y,am as Z,v as ee,j as te,aE as se,b as ae,m as C,d as k}from"./CaE7RP7u.js";import{_ as ne}from"./BRfLd31d.js";const ie=()=>{var r,c,P,b,g;class o extends EventTarget{constructor(){super();_(this,c);_(this,r,new Set);this.api_host=location.host,this.api_base=location.pathname.split("/").slice(0,-1).join("/"),this.initialClientId=sessionStorage.getItem("clientId")}apiURL(e){return this.api_base+e}fetchApi(e,t){return t||(t={}),t.headers||(t.headers={}),t.headers["Comfy-User"]=this.user,fetch(this.apiURL(e),t)}addEventListener(e,t,s){super.addEventListener(e,t,s),E(this,r).add(e)}init(){l(this,c,b).call(this)}async getExtensions(){return await(await this.fetchApi("/extensions",{cache:"no-store"})).json()}async getEmbeddings(){return await(await this.fetchApi("/embeddings",{cache:"no-store"})).json()}async getNodeDefs(){return await(await this.fetchApi("/object_info",{cache:"no-store"})).json()}async queuePrompt(e,{output:t,workflow:s}){const a={client_id:this.clientId,prompt:t,extra_data:{extra_pnginfo:{workflow:s}}};e===-1?a.front=!0:e!=0&&(a.number=e);const n=await this.fetchApi("/prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(n.status!==200)throw{response:await n.json()};return await n.json()}async getItems(e){return e==="queue"?this.getQueue():this.getHistory()}async getQueue(){try{const t=await(await this.fetchApi("/queue")).json();return{Running:t.queue_running.map(s=>({prompt:s,remove:{name:"Cancel",cb:()=>i.interrupt()}})),Pending:t.queue_pending.map(s=>({prompt:s}))}}catch(e){return console.error(e),{Running:[],Pending:[]}}}async getHistory(e=200){try{const t=await this.fetchApi(`/history?max_items=${e}`);return{History:Object.values(await t.json())}}catch(t){return console.error(t),{History:[]}}}async getSystemStats(){return await(await this.fetchApi("/system_stats")).json()}async deleteItem(e,t){await l(this,c,g).call(this,e,{delete:[t]})}async clearItems(e){await l(this,c,g).call(this,e,{clear:!0})}async interrupt(){await l(this,c,g).call(this,"interrupt",null)}async getUserConfig(){return(await this.fetchApi("/users")).json()}createUser(e){return this.fetchApi("/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})})}async getSettings(){return(await this.fetchApi("/settings")).json()}async getSetting(e){return(await this.fetchApi(`/settings/${encodeURIComponent(e)}`)).json()}async storeSettings(e){return this.fetchApi("/settings",{method:"POST",body:JSON.stringify(e)})}async storeSetting(e,t){return this.fetchApi(`/settings/${encodeURIComponent(e)}`,{method:"POST",body:JSON.stringify(t)})}async getUserData(e,t){return this.fetchApi(`/userdata/${encodeURIComponent(e)}`,t)}async storeUserData(e,t,s={overwrite:!0,stringify:!0,throwOnError:!0}){const a=await this.fetchApi(`/userdata/${encodeURIComponent(e)}?overwrite=${s==null?void 0:s.overwrite}`,{method:"POST",body:s!=null&&s.stringify?JSON.stringify(t):t,...s});if(a.status!==200&&(s==null?void 0:s.throwOnError)!==!1)throw new Error(`Error storing user data file '${e}': ${a.status} ${(await a).statusText}`);return a}async deleteUserData(e){const t=await this.fetchApi(`/userdata/${encodeURIComponent(e)}`,{method:"DELETE"});if(t.status!==204)throw new Error(`Error removing user data file '${e}': ${t.status} ${t.statusText}`)}async moveUserData(e,t,s={overwrite:!1}){return await this.fetchApi(`/userdata/${encodeURIComponent(e)}/move/${encodeURIComponent(t)}?overwrite=${s==null?void 0:s.overwrite}`,{method:"POST"})}async listUserData(e,t,s){const a=await this.fetchApi(`/userdata?${new URLSearchParams({recurse:t,dir:e,split:s})}`);if(a.status===404)return[];if(a.status!==200)throw new Error(`Error getting user data list '${e}': ${a.status} ${a.statusText}`);return a.json()}}r=new WeakMap,c=new WeakSet,P=function(){D(async()=>{try{const t=await(await this.fetchApi("/prompt")).json();this.dispatchEvent(new CustomEvent("status",{detail:t}))}catch{this.dispatchEvent(new CustomEvent("status",{detail:null}))}},1e3)},b=function(e){if(console.log("createSocket 1"),this.socket)return;console.log("createSocket 2");let t=!1,s=window.name;s&&(s="?clientId="+s),console.log("createSocket 3"),this.socket=new WebSocket(`ws${window.location.protocol==="https:"?"s":""}://${this.api_host}${this.api_base}/ws${s}`),this.socket.binaryType="arraybuffer",console.log("createSocket 4"),this.socket.addEventListener("open",()=>{t=!0,e&&this.dispatchEvent(new CustomEvent("reconnected"))}),this.socket.addEventListener("error",()=>{this.socket&&this.socket.close(),!e&&!t&&l(this,c,P).call(this)}),this.socket.addEventListener("close",()=>{setTimeout(()=>{this.socket=null,l(this,c,b).call(this,!0)},300),t&&(this.dispatchEvent(new CustomEvent("status",{detail:null})),this.dispatchEvent(new CustomEvent("reconnecting")))}),this.socket.addEventListener("message",a=>{try{if(a.data instanceof ArrayBuffer){const $=new DataView(a.data).getUint32(0),x=a.data.slice(4);switch($){case 1:const O=new DataView(a.data).getUint32(0);let v;switch(O){case 1:default:v="image/jpeg";break;case 2:v="image/png"}const R=new Blob([x.slice(4)],{type:v});this.dispatchEvent(new CustomEvent("b_preview",{detail:R}));break;default:throw new Error(`Unknown binary websocket message of type ${$}`)}}else{const n=JSON.parse(a.data);switch(n.type){case"status":n.data.sid&&(this.clientId=n.data.sid,window.name=this.clientId,sessionStorage.setItem("clientId",this.clientId)),this.dispatchEvent(new CustomEvent("status",{detail:n.data.status}));break;case"progress":this.dispatchEvent(new CustomEvent("progress",{detail:n.data}));break;case"executing":this.dispatchEvent(new CustomEvent("executing",{detail:n.data.display_node}));break;case"executed":this.dispatchEvent(new CustomEvent("executed",{detail:n.data}));break;case"execution_start":this.dispatchEvent(new CustomEvent("execution_start",{detail:n.data}));break;case"execution_success":this.dispatchEvent(new CustomEvent("execution_success",{detail:n.data}));break;case"execution_error":this.dispatchEvent(new CustomEvent("execution_error",{detail:n.data}));break;case"execution_cached":this.dispatchEvent(new CustomEvent("execution_cached",{detail:n.data}));break;default:if(E(this,r).has(n.type))this.dispatchEvent(new CustomEvent(n.type,{detail:n.data}));else throw new Error(`Unknown message type ${n.type}`)}}}catch(n){console.warn("Unhandled message:",a.data,n)}})},g=async function(e,t){try{await this.fetchApi("/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0})}catch(s){console.error(s)}};const i=new o;return{init:()=>{i.init(),window.comfyAPI=window.comfyAPI||{},window.comfyAPI.api=window.comfyAPI.api||{},window.comfyAPI.api.api=i}}},re={class:"pageDashboard"},he=N({__name:"index",setup(o){const{list:i,active:r}=L(U()),c=J(!1),j=B(()=>X().design.page.spinner.size);return q(async()=>{c.value=!0,await M().profileUpdate(),await z(),H().query.showMenu==="true"&&V().open({name:"myMenu"}),Q().init(),await U().init(),ie().init(),G().init(),c.value=!1}),(d,h)=>{const S=ee,f=ae,e=Y,t=W,s=K;return w(),T("div",re,[u(c)?(w(),y(s,{key:1,size:u(j)},null,8,["size"])):(w(),T(F,{key:0},[u(i).length?(w(),y(t,{key:0,narrow:""},{default:p(()=>[m(e,{gap:"28"},{default:p(()=>[u(r)?(w(),y(S,{key:0,onClick:h[0]||(h[0]=a=>("useSheet"in d?d.useSheet:u(te))().open({name:"usageTypeSelect"}))},{default:p(()=>[m(se,{data:u(r)},null,8,["data"])]),_:1})):Z("",!0),m(f,{to:("useConstantsPath"in d?d.useConstantsPath:u(C))().generate("lookstyle")},{default:p(()=>h[1]||(h[1]=[k(" 背景美術生成を開始する ")])),_:1},8,["to"])]),_:1})]),_:1})):(w(),y(t,{key:1},{default:p(()=>[m(ne,{icon:"exclamation",title:"ご契約プランがありません",body:"プランにご加入いただくことで<br />生成サービスをご利用いただけます。"},{button:p(()=>[m(f,{to:`${("useConstantsPath"in d?d.useConstantsPath:u(C))().ROOT}#pricing`},{default:p(()=>h[2]||(h[2]=[k(" プランを詳しくみる ")])),_:1},8,["to"]),m(f,{info:"",to:("useConstantsPath"in d?d.useConstantsPath:u(C))().JOIN},{default:p(()=>h[3]||(h[3]=[k(" エンタープライズコードをお持ちの方はこちら ")])),_:1},8,["to"])]),_:1})]),_:1}))],64))])}}});export{he as default};
