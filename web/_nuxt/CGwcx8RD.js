import{ab as Pe,p as Se,m as Oe,bh as Re,ag as r,ah as I,aM as ne,ac as Ne,k as p,bi as ze,b4 as xe,c as C,a as t,ai as o,aG as Be,aj as E,w as a,u as e,aP as V,bg as se,a$ as F,I as De,F as Le,E as je,o as n,aO as oe,t as Me,x as Ue,b as Ae,v as Ge,A as Qe,a6 as Ve,al as Fe,B as We,D as qe,d as T,as as le,ar as He,G as Ye,aE as Ke,j as P,aR as ie,n as W,l as S,af as Je,f as Xe}from"./RFFUVrrq.js";import{_ as Ze}from"./CbHJWJxN.js";import{_ as et}from"./C0OzAUa2.js";import{_ as tt}from"./CmdaPMC_.js";import{_ as at}from"./BT1tEX-g.js";import{_ as nt}from"./DSXngIAA.js";const st={class:"pageOutput",full:""},ot={key:0},re=1e3,O=3,ue=99,ft=Pe({__name:"output",setup(lt){const{isQueue:q,output:ce,isInitQueue:R,progress:g,previewImageUrl:N,state:pe}=p(),u=Se(),{processing:me}=Oe(Re()),z=r(null),fe=r(0),_e=r(0),de=r(!1),c=r(!1),h=r(!1),x=r(!1),l=r([]),$=r(!1),H=r("Starting."),B=r(-1),m=r(!1);let D=1,L;const j=I(()=>l.value.length===ue),ge=I(()=>!R.value&&(g.value>=0||l.value.length>0)?!0:R.value),Y=I(()=>u.imageHeight/u.imageWidth*100),K=I(()=>u.prompt),he=async()=>{await P().open({name:"prompt"})||(await w(),await p().postInterrupt(),fe.value=0,_e.value=0,de.value=!1,l.value=[],await ie(),await u.setWorkflow(),u.incrementRetryCount(),v())},ve=()=>{u.incrementRetryCount(),W(S().GENERATE_UPLOAD)},we=()=>{u.init(),W(S().GENERATE_LOOKSTYLE)},ye=async s=>{m.value=!0,await P().open({name:"upscaleSelect",options:{src:l.value[s]}}),m.value=!1,b()},ke=s=>{l.value.splice(s,1)},Ce=async()=>{const s=await P().open({name:"uploadImage"});s&&s.base64&&s.file&&(u.continue(s.base64,s.file),W(S().GENERATE_CONFIRM))},J=async()=>{await P().open({name:"generateEndDialog"})&&(u.init(),Je().replace(S().GENERATE_LOOKSTYLE))},Ee=async s=>{await Xe().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>m.value=!0,onDownloadEnd:()=>m.value=!1}}),q.value||b()},v=async()=>{j.value||c.value||m.value||(q.value?(await F().wait(re),v()):(x.value=!0,await w(),c.value=!1,await p().queuePrompt({json:JSON.stringify(p().workflow.updateSeed(u.workflow)),batchCount:1}),x.value=!1))},M=async()=>{h.value=!0,x.value?(await F().wait(re),await M()):(await w(),await p().postInterrupt(),h.value=!1,c.value=!0)},b=()=>{c.value=!1,v()},w=async()=>{await p().queueClear(),await p().historyClear()};return ne(()=>ce.value,async s=>{if(!m.value&&s&&s.length>0){const i=s[s.length-1];i.includes("upscale")||l.value.push(i),z.value&&(await ie(),await F().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),ne(()=>l.value.length,async(s,i)=>{i!==void 0&&s>i&&v()},{immediate:!0}),Ne(async()=>{await w(),await p().postInterrupt(),v(),L=ze(()=>{D=D%3+1,H.value=" Starting "+".".repeat(D)},1e3),$.value=!0}),xe(async()=>{await w(),await p().postInterrupt(),L!==null&&clearInterval(L)}),(s,i)=>{const X=Ue,U=Me,Z=Ze,y=Ge,k=Ae,A=De,G=Le,Q=Qe,$e=We,ee=Fe,_=je,be=Ve,te=qe,Ie=Ye,Te=et;return n(),C("div",st,[t(A,{justify:"center",gap:[8,28],split:O},{default:a(()=>[(n(!0),C(V,null,oe(e(l),(f,d)=>(n(),o(G,{key:`pageOutput-item-generate-${d}`,justify:"center",gap:"10"},{default:a(()=>[t(Z,{per:e(Y)},{default:a(()=>[t(U,{onClick:ae=>Ee(d)},{default:a(()=>[t(X,{class:"pageOutput-img",src:f,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(A,{justify:"center",gap:"20"},{default:a(()=>[t(k,{w:"20",h:"20","no-padding":"",link:"",onClick:ae=>ye(d)},{default:a(()=>[t(y,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(k,{w:"20",h:"20","no-padding":"",link:"",onClick:ae=>ke(d)},{default:a(()=>[t(y,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(j)?E("",!0):(n(!0),C(V,{key:0},oe(O-e(l).length%O,f=>(n(),o(Z,{key:`pageOutput-item-${f}`,class:"pageOutput-img",per:e(Y)},{default:a(()=>[f===1?(n(),o(_,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:d=>B.value=f,onMouseleave:i[0]||(i[0]=d=>B.value=-1)},{default:a(()=>[e(me)?(n(),o(Q,{key:0,w:"100%",h:"100%"})):e(N)?(n(),o(X,{key:2,src:e(N),cover:""},null,8,["src"])):(n(),o(Q,{key:1,w:"100%",h:"100%",animation:""})),t(be,{duration:"100"},{default:a(()=>[e(B)===f||e(c)?(n(),o(_,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"text060"},{default:a(()=>[t(ee,null,{default:a(()=>[e(h)?(n(),C("div",ot,[t($e,{size:"2.2vw",color:"light"})])):e(c)?(n(),o(U,{key:2,onClick:b},{default:a(()=>[t(y,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(U,{key:1,onClick:M},{default:a(()=>[t(y,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):E("",!0)]),_:2},1024),!e(m)&&!e(c)&&!e(h)?(n(),o(_,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark-090","min-w":"32",h:"18",r:"4",pt:"3.7",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(pe)==="executing"&&e(N)&&e($)?(n(),o(te,{key:0,footnote:"",bold:"",center:"",color:"light","cap-height-baseline":""},{default:a(()=>[T(le(Math.round(e(g)*100))+"% ",1)]),_:1})):!e(R)||e(g)===0||!e($)?(n(),o(te,{key:1,footnote:"",bold:"",color:"light","cap-height-baseline":"",style:{width:"56px"}},{default:a(()=>[T(le(e(H)),1)]),_:1})):E("",!0)]),_:1})):E("",!0)]),_:2},1032,["onMouseover"])):(n(),o(Q,{key:1,w:"100%",h:"100%",animation:!e(ge),delay:f/O*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(_,{h:"80"}),e(j)?(n(),o(G,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(He,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Ie,null,{default:a(()=>[t(G,{justify:"stretch",gap:"20"},{default:a(()=>[t(k,{onClick:ve},{default:a(()=>i[1]||(i[1]=[T(" 内容を変更してやり直す ")])),_:1}),t(k,{info:"",onClick:we},{default:a(()=>i[2]||(i[2]=[T(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(_,{key:1,fixed:"",bottom:"20",left:"0",right:"0"},{default:a(()=>[t(ee,null,{default:a(()=>[t(nt,{paused:e(c),processing:!e(l).length&&!e(g)&&!e(c)||e(h),progress:e(l).length+e(g),count:e(l).length,total:ue,onPause:M,onResume:b,onNext:Ce,onEnd:J},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),Be("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),e($)?(n(),C(V,{key:2},[(n(),o(se,{to:"#headerWideCenter"},[t(A,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(at,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(tt,{class:Ke(["headerPrompt-list-inner",{_empty:e(K).length===0}]),name:"プロンプト",data:e(K),more:""},null,8,["class","data"])]),_:1}),t(_,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(k,{w:"100%",h:"100%",info:"",onClick:he},{default:a(()=>[t(y,{name:"edit",size:"20",gradation:"horizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(se,{to:"#headerWideRightEnd"},[t(Te,{class:"headerEndBtn",link:"",xsmall:"",icon:{name:"cross",size:20},onClick:J})]))],64)):E("",!0)])}}});export{ft as default};
