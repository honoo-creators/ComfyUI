import{d as he,aI as ke,x as c,h as A,P as K,o as we,ax as X,aS as ye,X as Ce,a5 as _,f as n,g as T,z as e,w as t,F as N,G as Z,Y as a,l as k,i as l,A as g,p as $e,aK as ee,a0 as te,n as ae,c as U,e as Ee,aH as ne,D as Te,a2 as Ie,t as be,U as Pe,E as Re,V as Se,aJ as Oe,B as oe,ar as De,a8 as Le,_ as ze,a6 as Be,R as Ae}from"./DRsjRDN1.js";import{_ as Ne}from"./BjR0ri3_.js";import{_ as Ue}from"./DeuysY3x.js";import{_ as je}from"./BNEt55qp.js";import{_ as Me}from"./B4y7y7Of.js";import{_ as xe}from"./Dqm2xNvm.js";import{_ as Ge}from"./CpQtuUmz.js";const qe=1e3,se=.1,I=3,j=99,Xe=he({__name:"output",setup(He){const{isQueue:b,output:le,isInitQueue:P,progress:w}=_(),r=ke(),R=c(null),y=c(0),h=c(0),S=c(!1),m=c(!1),u=c([]),M=c(!1),x=c("Starting."),O=c(-1);let D=1,L;const C=A(()=>u.value.length===j),ue=A(()=>!P.value&&(w.value>=0||u.value.length>0)?!0:P.value),G=A(()=>r.imageHeight/r.imageWidth*100),ie=async()=>{await te().open({name:"prompt"})||(b.value&&_().postInterrupt(),_().queueClear(),y.value=0,h.value=0,S.value=!1,u.value=[],await X(),await r.setWorkflow(),r.incrementRetryCount(),$())},re=()=>{r.incrementRetryCount(),ae(U().GENERATE_UPLOAD)},ce=()=>{r.init(),ae(U().GENERATE_LOOKSTYLE)},me=async o=>{await te().open({name:"upscaleSelect",options:{src:u.value[o]}})},_e=o=>{u.value.splice(o,1)},q=()=>{u.value=[],Ee().replace(U().dashboard())},H=async()=>{if(m.value)return;const o=1e3;await ne().wait(o),h.value-=o,h.value>=0?H():h.value=0},pe=o=>{De().open({name:"imagePreview",options:{index:o,list:u.value,onDownloadEnd:()=>V()}})},$=async()=>{C.value||m.value||(b.value?(await ne().wait(qe),$()):(m.value=!1,_().queuePrompt({json:JSON.stringify(r.workflow),batchCount:j-u.value.length})))},fe=()=>{m.value=!0,_().postInterrupt(),_().queueClear()},V=()=>{m.value=!1,$()};return K(()=>le.value,o=>{if(o&&o.length>0){const s=o[o.length-1];s.includes("upscale")||u.value.push(s),R.value&&R.value.scrollIntoView({behavior:"smooth",block:"end"})}},{deep:!0}),K(()=>w.value,(o,s)=>{if(!y.value&&s===0&&(y.value=Date.now()),o>=se&&!S.value){S.value=!0;const z=Date.now()-y.value;h.value=z*(1/se)*(j-u.value.length),H()}},{immediate:!0}),we(async()=>{await X(),$(),L=ye(()=>{D=D%3+1,x.value=" Starting "+".".repeat(D)},1e3),M.value=!0}),Ce(()=>{b.value&&_().postInterrupt(),_().queueClear(),L!==null&&clearInterval(L)}),(o,s)=>{const z=Le,F=Ne,f=Te,i=Ie,B=be,E=Pe,Q=Ue,W=ze,d=Re,de=Be,ve=Ae,Y=Se,ge=je;return n(),T("div",{ref_key:"element",ref:R,class:"pageOutput",full:""},[e(B,{gap:"8",split:I},{default:t(()=>[(n(!0),T(N,null,Z(a(u),(p,v)=>(n(),l(E,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(F,{per:a(G)},{default:t(()=>[e(Oe,{onClick:J=>pe(v)},{default:t(()=>[e(z,{src:p,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(B,{justify:"center",gap:"20"},{default:t(()=>[e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:J=>me(v)},{default:t(()=>[e(f,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:J=>_e(v)},{default:t(()=>[e(f,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(C)?k("",!0):(n(!0),T(N,{key:0},Z(I-a(u).length%I,p=>(n(),l(F,{key:`pageOutput-item-${p}`,class:"pageOutput-img",per:a(G)},{default:t(()=>[p===1?(n(),l(d,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"",onMouseover:v=>O.value=p,onMouseleave:s[0]||(s[0]=v=>O.value=-1)},{default:t(()=>[e(Q,{w:"100%",h:"100%",animation:""}),e(d,{absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[a(P)&&a(w)>0?(n(),l(W,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[g(oe(Math.round(a(w)*100))+"% ",1)]),_:1})):(n(),l(W,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[g(oe(a(x)),1)]),_:1}))]),_:1}),e(ve,{duration:"100"},{default:t(()=>[a(O)===p||a(m)?(n(),l(d,{key:0,absolute:"",top:"0",left:"0",w:"100%",h:"100%"},{default:t(()=>[e(de,null,{default:t(()=>[a(m)?(n(),l(i,{key:1,link:"",onClick:V},{default:t(()=>[e(f,{name:"play",size:"20"})]),_:1})):(n(),l(i,{key:0,link:"",onClick:fe},{default:t(()=>[e(f,{name:"pause",size:"20"})]),_:1}))]),_:1})]),_:1})):k("",!0)]),_:2},1024)]),_:2},1032,["onMouseover"])):(n(),l(Q,{key:1,w:"100%",h:"100%",animation:!a(ue),delay:p/I*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(d,{h:"36"}),a(C)?(n(),l(E,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Me,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(Y,null,{default:t(()=>[e(E,{justify:"stretch",gap:"20"},{default:t(()=>[e(i,{onClick:re},{default:t(()=>s[1]||(s[1]=[g(" 内容を変更してやり直す ")])),_:1}),e(i,{info:"",onClick:ce},{default:t(()=>s[2]||(s[2]=[g(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):k("",!0),e(ge,null,{default:t(()=>[!a(C)&&a(m)?(n(),l(Y,{key:0},{default:t(()=>[e(E,{justify:"center"},{default:t(()=>[e(i,{info:""},{default:t(()=>s[3]||(s[3]=[g(" 続けて他の原図を生成する ")])),_:1}),e(d,{h:"0"}),e(i,{minimal:"",onClick:q},{default:t(()=>s[4]||(s[4]=[g(" 終了する ")])),_:1})]),_:1})]),_:1})):k("",!0)]),_:1}),a(M)?(n(),T(N,{key:1},[(n(),l(ee,{to:"#headerWideCenter"},[e(B,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Ge,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(xe,{class:$e(["headerPrompt-list-inner",{_empty:a(r).prompt.length===0}]),name:"プロンプト",data:a(r).prompt},null,8,["class","data"])]),_:1}),e(d,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(i,{w:"100%",h:"100%",info:"",onClick:ie},{default:t(()=>[e(f,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),l(ee,{to:"#headerWideRightEnd"},[e(i,{class:"headerEndBtn",link:"",xsmall:"",onClick:q},{default:t(()=>[e(f,{name:"cross",size:"20"})]),_:1})]))],64)):k("",!0)],512)}}});export{Xe as default};
