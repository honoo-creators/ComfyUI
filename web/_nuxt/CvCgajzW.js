import{d as ae,r as d,c as E,R as I,o as ne,n as se,g as o,l as u,w as e,i as a,j as n,q as oe,aC as T,x as p,h as U,p as x,D as O,I as ue,H as le,e as L,f as N,aB as D,F as ie,ak as ce,G as re,_ as _e,a1 as pe,W as fe,A as me,X as de,al as ge,a4 as G,a5 as ve}from"./QWLheGxm.js";import{_ as ye}from"./Z7IVsS_Z.js";import{_ as ke}from"./WCttZgdM.js";import{_ as he}from"./DLFdnAhv.js";import{_ as H}from"./BQTQAAhM.js";import{u as Ce}from"./CBNVf8Es.js";import{u as M}from"./D2vpUSql.js";import"./DmolMG9N.js";const $e={key:0,class:"pageOutput-info-spinner"},we=["innerHTML"],Ee=["innerHTML"],j=1e3,V=3,f=9,Se=ae({__name:"output",setup(Te){const{isQueue:y,output:z}=M(),R=Ce(),k=d(0),i=d(0),c=d(!1),b=d(!1),l=d([]),h=E(()=>`${l.value.length}/${f}`),C=E(()=>{if(l.value.length===f)return"背景美術を生成しました。";const t=Math.floor(i.value/36e5),s=Math.floor(i.value%36e5/6e4),r=Math.floor(i.value%6e4/1e3);let _="";return t>0&&(_+=`${t}時間`),s>0&&(_+=`${s}分`),_+=`${r}秒`,y.value&&i.value<=0?"...":`あと ${_}`}),$=E(()=>l.value.length===f),q=()=>{A(),L(N().GENERATE_PROMPT_A)},F=()=>{L(N().GENERATE_UPLOAD)},Q=()=>{R.init(),L(N().GENERATE_LOOKSTYLE)},P=async()=>{if(c.value)return;const t=1e3;await D().wait(t),i.value-=t,i.value>=0?P():i.value=0},Y=t=>{ge().open({name:"imagePreview",options:{list:l.value,index:t}})},g=async()=>{$.value||c.value||(y.value?(await D().wait(j),g()):(c.value=!1,M().queuePrompt({json:JSON.stringify(R.workflow),batchCount:1})))},A=()=>{c.value=!0,M().postInterrupt()},J=()=>{c.value=!1,g()};return I(()=>z.value,t=>{t&&t.length>0&&(G().public.ENVIRONMENT==="local"?l.value.push(t[0].replace("http://127.0.0.1:8188",G().public.BASE_URL)):l.value.push(t[0]))},{deep:!0}),I(()=>l.value.length,(t,s)=>{if(k.value||(k.value=Date.now()),t===1&&s===0){const r=Date.now()-k.value;i.value=(r+j)*(f-1),P()}t!==s&&t<f&&g()},{immediate:!0}),ne(async()=>{await se(),!(b.value||y.value)&&(b.value=!0,g())}),(t,s)=>{const r=ie,_=ce,K=ye,W=re,B=_e,w=pe,v=fe,X=ve,Z=ke,ee=he,te=me,S=de;return o(),u(S,{class:"pageOutput",wide:""},{default:e(()=>[a(v,{gap:"36"},{default:e(()=>[n($)?(o(),u(H,oe({key:0},{title:n(h),body:n(C)},{icon:"shine"}),null,16)):(o(),u(v,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:e(()=>[a(W,{w:"48",h:"48",relative:""},{default:e(()=>[a(_,null,{default:e(()=>[n(c)?p("",!0):(o(),u(T,{key:0,onClick:A},{default:e(()=>[a(r,{name:"pause",size:"24"})]),_:1})),n(c)?(o(),u(T,{key:1,onClick:J},{default:e(()=>[a(r,{name:"play",size:"44"})]),_:1})):p("",!0)]),_:1}),n(c)?p("",!0):(o(),U("div",$e,[a(K,{size:"64",stroke:"4.4"})]))]),_:1}),n(h)?(o(),u(B,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:e(()=>[x("span",{innerHTML:n(h)},null,8,we)]),_:1})):p("",!0),n(C)?(o(),u(B,{key:1,class:"pageOutput-info-body",caption1:"",bold:"",center:""},{default:e(()=>[x("span",{innerHTML:n(C)},null,8,Ee)]),_:1})):p("",!0),a(w,{class:"pageOutput-info-edit",link:"",xsmall:"","no-padding":"",onClick:q},{default:e(()=>[a(r,{name:"edit",size:"16"}),s[0]||(s[0]=O(" プロンプトを変更 "))]),_:1})]),_:1})),a(te,{class:"pageOutput-list",gap:"2",split:V},{default:e(()=>[(o(),U(le,null,ue(f,m=>a(ee,{key:`pageOutput-item-${m}`},{default:e(()=>[n(l)[m-1]?(o(),u(T,{key:0,class:"pageOutput-img",onClick:Oe=>Y(m-1)},{default:e(()=>[a(X,{src:n(l)[m-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):(o(),u(Z,{key:1,w:"100%",h:"100%",animation:"",delay:m/V*150},null,8,["delay"]))]),_:2},1024)),64))]),_:1}),n($)?(o(),u(v,{key:2,justify:"center",gap:"40"},{default:e(()=>[a(H,{icon:"checkCircleLine",body:"生成画像は以上です"}),a(S,null,{default:e(()=>[a(v,{justify:"stretch",gap:"20"},{default:e(()=>[a(w,{onClick:F},{default:e(()=>s[1]||(s[1]=[O(" 設定を変更してやり直す ")])),_:1}),a(w,{info:"",onClick:Q},{default:e(()=>s[2]||(s[2]=[O(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})}}});export{Se as default};
