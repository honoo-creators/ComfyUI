import{d as Te,aN as Ie,aw as Pe,aY as be,x as i,h as T,P as Re,o as Ne,a5 as _,aZ as Oe,X as Se,f as n,g as I,z as t,w as a,F as Q,G as ne,Y as e,l as y,i as s,aa as ze,A as P,k as xe,p as Be,aP as se,a0 as b,aB as oe,n as V,c as R,e as De,aM as Y,D as Le,a2 as Ue,t as Me,U as Ae,a6 as je,E as Ge,V as Qe,aO as Ve,B as le,av as Ye,a8 as Fe,aD as He,R as We,_ as qe}from"./BosPpemA.js";import{_ as Ke}from"./DINgKqwp.js";import{_ as Je}from"./oWatyMjB.js";import{_ as Xe}from"./BK50QT9t.js";import{_ as Ze}from"./BkJh6neA.js";import{_ as et}from"./CH0D5tS4.js";const tt={class:"pageOutput",full:""},ie=1e3,N=3,F=99,rt=Te({__name:"output",setup(at){const{isQueue:H,output:ue,isInitQueue:O,progress:v,previewImageUrl:S,state:re}=_(),u=Ie(),{processing:ce}=Pe(be()),z=i(null),pe=i(0),_e=i(0),me=i(!1),r=i(!1),h=i(!1),x=i(!1),l=i([]),C=i(!1),W=i("Starting."),B=i(-1),f=i(!1);let D=1,L;const U=T(()=>l.value.length===F),fe=T(()=>!O.value&&(v.value>=0||l.value.length>0)?!0:O.value),q=T(()=>u.imageHeight/u.imageWidth*100),K=T(()=>u.prompt),de=async()=>{await b().open({name:"prompt"})||(await k(),await _().postInterrupt(),pe.value=0,_e.value=0,me.value=!1,l.value=[],await oe(),await u.setWorkflow(),u.incrementRetryCount(),E())},ge=()=>{u.incrementRetryCount(),V(R().GENERATE_UPLOAD)},we=()=>{u.init(),V(R().GENERATE_LOOKSTYLE)},ve=async o=>{f.value=!0,await b().open({name:"upscaleSelect",options:{src:l.value[o]}}),f.value=!1,$()},he=o=>{l.value.splice(o,1)},ke=async()=>{const o=await b().open({name:"uploadImage"});o&&o.base64&&o.file&&(u.continue(o.base64,o.file),V(R().GENERATE_CONFIRM))},J=async()=>{await b().open({name:"generateEndDialog"})&&(u.init(),De().replace(R().GENERATE_LOOKSTYLE))},ye=async o=>{await Ye().open({name:"imagePreview",options:{index:o,list:l.value,onDownloadStart:()=>f.value=!0,onDownloadEnd:()=>f.value=!1}}),H.value||$()},E=async()=>{U.value||r.value||(H.value?(await Y().wait(ie),E()):(x.value=!0,await k(),r.value=!1,await _().queuePrompt({json:JSON.stringify(_().workflow.updateSeed(u.workflow)),batchCount:F-l.value.length}),x.value=!1))},M=async()=>{h.value=!0,x.value?(await Y().wait(ie),await M()):(await k(),await _().postInterrupt(),h.value=!1,r.value=!0)},$=()=>{r.value=!1,E()},k=async()=>{await _().queueClear(),await _().historyClear()};return Re(()=>ue.value,async o=>{if(!f.value&&o&&o.length>0){const c=o[o.length-1];c.includes("upscale")||l.value.push(c),z.value&&(await oe(),await Y().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),Ne(async()=>{await k(),await _().postInterrupt(),E(),L=Oe(()=>{D=D%3+1,W.value=" Starting "+".".repeat(D)},1e3),C.value=!0}),Se(()=>{k(),L!==null&&clearInterval(L)}),(o,c)=>{const X=Fe,Z=Ke,d=Le,p=Ue,A=Me,j=Ae,G=Je,Ce=He,ee=je,g=Ge,Ee=We,te=qe,$e=Qe;return n(),I("div",tt,[t(A,{justify:"center",gap:[8,28],split:N},{default:a(()=>[(n(!0),I(Q,null,ne(e(l),(m,w)=>(n(),s(j,{key:`pageOutput-item-generate-${w}`,justify:"center",gap:"10"},{default:a(()=>[t(Z,{per:e(q)},{default:a(()=>[t(Ve,{onClick:ae=>ye(w)},{default:a(()=>[t(X,{class:"pageOutput-img",src:m,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(A,{justify:"center",gap:"20"},{default:a(()=>[t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ae=>ve(w)},{default:a(()=>[t(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ae=>he(w)},{default:a(()=>[t(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(U)?y("",!0):(n(!0),I(Q,{key:0},ne(N-e(l).length%N,m=>(n(),s(Z,{key:`pageOutput-item-${m}`,class:"pageOutput-img",per:e(q)},{default:a(()=>[m===1?(n(),s(g,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:w=>B.value=m,onMouseleave:c[0]||(c[0]=w=>B.value=-1)},{default:a(()=>[e(ce)?(n(),s(G,{key:0,w:"100%",h:"100%"})):e(S)?(n(),s(X,{key:2,src:e(S),cover:""},null,8,["src"])):(n(),s(G,{key:1,w:"100%",h:"100%",animation:""})),t(Ee,{duration:"100"},{default:a(()=>[e(B)===m||e(r)?(n(),s(g,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:a(()=>[t(ee,null,{default:a(()=>[e(h)?(n(),s(p,{key:0,link:""},{default:a(()=>[t(Ce,{size:"2.2vw",color:"light"})]),_:1})):e(r)?(n(),s(p,{key:2,link:"",onClick:$},{default:a(()=>[t(d,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),s(p,{key:1,link:"",onClick:M},{default:a(()=>[t(d,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):y("",!0)]),_:2},1024),!e(f)&&!e(r)&&!e(h)?(n(),s(g,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(re)==="executing"&&e(S)&&e(C)?(n(),s(te,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:a(()=>[P(le(Math.round(e(v)*100))+"% ",1)]),_:1})):!e(O)||e(v)===0||!e(C)?(n(),s(te,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:a(()=>[P(le(e(W)),1)]),_:1})):y("",!0)]),_:1})):y("",!0)]),_:2},1032,["onMouseover"])):(n(),s(G,{key:1,w:"100%",h:"100%",animation:!e(fe),delay:m/N*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(g,{h:"40"}),e(U)?(n(),s(j,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(ze,{icon:"checkCircleLine",body:"生成画像は以上です"}),t($e,null,{default:a(()=>[t(j,{justify:"stretch",gap:"20"},{default:a(()=>[t(p,{onClick:ge},{default:a(()=>c[1]||(c[1]=[P(" 内容を変更してやり直す ")])),_:1}),t(p,{info:"",onClick:we},{default:a(()=>c[2]||(c[2]=[P(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),s(g,{key:1,w:"100%",fixed:"",bottom:"20"},{default:a(()=>[t(ee,null,{default:a(()=>[t(et,{paused:e(r),processing:!e(l).length&&!e(v)&&!e(r)||e(h),progress:e(l).length+e(v),count:e(l).length,total:F,onPause:M,onResume:$,onNext:ke,onEnd:J},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),xe("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),e(C)?(n(),I(Q,{key:2},[(n(),s(se,{to:"#headerWideCenter"},[t(A,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(Ze,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(Xe,{class:Be(["headerPrompt-list-inner",{_empty:e(K).length===0}]),name:"プロンプト",data:e(K),more:""},null,8,["class","data"])]),_:1}),t(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(p,{w:"100%",h:"100%",info:"",onClick:de},{default:a(()=>[t(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(se,{to:"#headerWideRightEnd"},[t(p,{class:"headerEndBtn",link:"",xsmall:"",onClick:J},{default:a(()=>[t(d,{name:"cross",size:"20"})]),_:1})]))],64)):y("",!0)])}}});export{rt as default};
