import{d as B,aC as $,x as L,h as R,f as i,i as r,w as s,z as n,Y as t,l as u,A as v,ah as E,aF as V,$ as j,e as O,c as A,ai as P,C as z,n as F,V as W,U as M,a2 as Q,a as Y,a5 as q}from"./CcndUWmQ.js";import{_ as H}from"./BvigDbDz.js";import{_ as J}from"./DM4q-V_T.js";import{_ as K,a as w}from"./C3kXl7ay.js";import"./Dymu-S3k.js";import"./DcrIQbSQ.js";const ne=B({__name:"confirm",setup(X){const{lookStyle:_,base64:y,imageFile:I,promptA:d,promptB:c,promptC:m,promptD:f,customWorkflow:k,retryCount:N}=$(),h=Y(),U=q(),g=L(!1),D=R(()=>j().public.COMFYUI_GENERATE_ENABLED),T=()=>{E().alert({title:"ComfyUI Queue Disabled",message:"この環境では画像生成が許可されていません。",icon:"prohibited"})},x=async()=>{g.value=!0;try{const p=await V().optimize(y,512e3),{original_image_id:l}=await h.upload.originalImage(p);let a;if(k)a=k,a&&typeof a=="object"&&"nodes"in a&&a.nodes.forEach(e=>{e.type==="CLIPTextEncode"&&Array.isArray(e.widgets_values)&&e.widgets_values.length>0&&(d.length>0&&(e.widgets_values[0]=`${String(e.widgets_values[0])},What to draw,${d.join(",")}`),c.length>0&&(e.widgets_values[0]=`${String(e.widgets_values[0])},Environment around,${c.join(",")}`),m.length>0&&(e.widgets_values[0]=`${String(e.widgets_values[0])},Color tone and mood,${m.join(",")}`),f.length>0&&(e.widgets_values[0]=`${String(e.widgets_values[0])},Lighting,${f.join(",")}`))});else{if(!_)throw new Error("背景美術スタイルが選択されていません");const{workflow:o}=await h.template.workflow({backgroundArtStyleId:_.id,prompt:[d,c,m,f].join(" "),retry_count:N,original_image_id:l});a=o}if(j().public.ENVIRONMENT==="local"){const{name:o}=await U.upload.image(I);typeof a=="object"&&a!==null&&"nodes"in a&&a.nodes.forEach(S=>{const C=S;C.type==="LoadImage"&&(C.widgets_values=C.widgets_values.map(b=>typeof b=="string"?o:b))})}$().setWorkflow(a),O().push(A().OUTPUT)}catch(p){g.value=!1,p instanceof P?E().error(p):E().error({title:"Generate Error",message:"生成に失敗しました。",icon:"exclamation",button:"閉じる",code:z.UnknownError,name:"UnknownError"})}},G=()=>{F(A().GENERATE_UPLOAD)};return(p,l)=>{const a=W,o=M,e=Q;return i(),r(o,{class:"pageGenerateConfirm",gap:"28"},{default:s(()=>[n(a,null,{default:s(()=>[n(H,{icon:"document",title:"設定内容の確認",body:"設定内容をご確認ください"})]),_:1}),n(a,null,{default:s(()=>[n(o,{justify:"stretch",gap:"32"},{default:s(()=>[n(o,{justify:"stretch",gap:"8"},{default:s(()=>[t(_)?(i(),r(J,{key:0,class:"pageGenerateConfirm-lookstyle",data:t(_)},null,8,["data"])):u("",!0),t(y)?(i(),r(K,{key:1,data:t(y)},null,8,["data"])):u("",!0),t(d)?(i(),r(w,{key:2,data:t(d),name:"何を描くか"},null,8,["data"])):u("",!0),t(c)?(i(),r(w,{key:3,data:t(c),name:"周りの環境"},null,8,["data"])):u("",!0),t(m)?(i(),r(w,{key:4,data:t(m),name:"色調・ムード"},null,8,["data"])):u("",!0),t(f)?(i(),r(w,{key:5,data:t(f),name:"ライティング"},null,8,["data"])):u("",!0)]),_:1}),n(o,{justify:"stretch",gap:"8"},{default:s(()=>[n(e,{loading:t(g),disabled:!t(D),onClick:x,onDisabledClick:T},{default:s(()=>l[0]||(l[0]=[v(" 生成する ")])),_:1},8,["loading","disabled"]),n(e,{minimal:"",disabled:t(g),onClick:G},{default:s(()=>l[1]||(l[1]=[v(" 設定を変更する ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{ne as default};
