import{d as te,h as d,c as T,G as U,H as ae,aa as ne,o,a as u,w as e,k as a,Q as n,m as se,am as E,f,j as G,e as H,l as O,s as oe,F as ue,X as L,au as M,T as N,as as j,p as ie,ag as le,q as ce,_ as re,U as _e,M as fe,g as pe,N as me,ak as de,$ as ge}from"./CbE87QEY.js";import{_ as ve}from"./eyn72uY-.js";import{_ as ke}from"./DgQ7wtJN.js";import{_ as ye}from"./NJgW8Qz8.js";import{_ as x}from"./Du-WGbJ-.js";import{u as he}from"./90kl7JVD.js";import"./DmolMG9N.js";const $e={key:0,class:"pageOutput-info-spinner"},we=["innerHTML"],Ce=["innerHTML"],D=1e3,I=3,p=9,Be=te({__name:"output",setup(Te){const{isQueue:k,output:z}=L(),P=he(),y=d(0),i=d(0),l=d(!1),b=d(!1),c=d([]),h=T(()=>`${c.value.length}/${p}`),$=T(()=>{if(c.value.length===p)return"背景美術を生成しました。";const t=Math.floor(i.value/36e5),s=Math.floor(i.value%36e5/6e4),r=Math.floor(i.value%6e4/1e3);let _="";return t>0&&(_+=`${t}時間`),s>0&&(_+=`${s}分`),_+=`${r}秒`,k.value&&i.value<=0?"...":`あと ${_}`}),w=T(()=>c.value.length===p),V=()=>{B(),M(N().GENERATE_PROMPT_A)},q=()=>{M(N().GENERATE_UPLOAD)},Q=()=>{P.init(),M(N().GENERATE_LOOKSTYLE)},A=async()=>{if(l.value)return;const t=1e3;await j().wait(t),i.value-=t,i.value>=0?A():i.value=0},F=t=>{de().open({name:"imagePreview",options:{list:c.value,index:t}})},g=async()=>{w.value||l.value||(k.value?(await j().wait(D),g()):(l.value=!1,L().queuePrompt({json:JSON.stringify(P.workflow),batchCount:1})))},B=()=>{l.value=!0,L().postInterrupt()},Y=()=>{l.value=!1,g()};return U(()=>z.value,t=>{t&&t.length>0&&c.value.push(t[0])},{deep:!0}),U(()=>c.value.length,(t,s)=>{if(y.value||(y.value=Date.now()),t===1&&s===0){const r=Date.now()-y.value;i.value=(r+D)*(p-1),A()}t!==s&&t<p&&g()},{immediate:!0}),ae(async()=>{await ne(),!(b.value||k.value)&&(b.value=!0,g())}),(t,s)=>{const r=ie,_=le,J=ve,K=ce,R=re,C=_e,v=fe,X=ge,W=ke,Z=ye,ee=pe,S=me;return o(),u(S,{class:"pageOutput",wide:""},{default:e(()=>[a(v,{gap:"36"},{default:e(()=>[n(w)?(o(),u(x,se({key:0},{title:n(h),body:n($)},{icon:"shine"}),null,16)):(o(),u(v,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:e(()=>[a(K,{w:"48",h:"48",relative:""},{default:e(()=>[a(_,null,{default:e(()=>[n(l)?f("",!0):(o(),u(E,{key:0,onClick:B},{default:e(()=>[a(r,{name:"pause",size:"24"})]),_:1})),n(l)?(o(),u(E,{key:1,onClick:Y},{default:e(()=>[a(r,{name:"play",size:"44"})]),_:1})):f("",!0)]),_:1}),n(l)?f("",!0):(o(),G("div",$e,[a(J,{size:"64",stroke:"4.4"})]))]),_:1}),n(h)?(o(),u(R,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:e(()=>[H("span",{innerHTML:n(h)},null,8,we)]),_:1})):f("",!0),n($)?(o(),u(R,{key:1,class:"pageOutput-info-body",caption1:"",bold:"",center:""},{default:e(()=>[H("span",{innerHTML:n($)},null,8,Ce)]),_:1})):f("",!0),a(C,{class:"pageOutput-info-edit",link:"",xsmall:"","no-padding":"",onClick:V},{default:e(()=>[a(r,{name:"edit",size:"16"}),s[0]||(s[0]=O(" プロンプトを変更 "))]),_:1})]),_:1})),a(ee,{class:"pageOutput-list",gap:"2",split:I},{default:e(()=>[(o(),G(ue,null,oe(p,m=>a(Z,{key:`pageOutput-item-${m}`},{default:e(()=>[n(c)[m-1]?(o(),u(E,{key:0,class:"pageOutput-img",onClick:Ee=>F(m-1)},{default:e(()=>[a(X,{src:n(c)[m-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):(o(),u(W,{key:1,w:"100%",h:"100%",animation:"",delay:m/I*150},null,8,["delay"]))]),_:2},1024)),64))]),_:1}),n(w)?(o(),u(v,{key:2,justify:"center",gap:"40"},{default:e(()=>[a(x,{icon:"checkCircleLine",body:"生成画像は以上です"}),a(S,null,{default:e(()=>[a(v,{justify:"stretch",gap:"20"},{default:e(()=>[a(C,{onClick:q},{default:e(()=>s[1]||(s[1]=[O(" 設定を変更してやり直す ")])),_:1}),a(C,{info:"",onClick:Q},{default:e(()=>s[2]||(s[2]=[O(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1})}}});export{Be as default};
