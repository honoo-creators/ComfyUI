import{ac as Ee,k as m,p as Se,n as xe,be as ze,ai as r,aj as I,aI as ae,af as Be,bf as je,b9 as De,c as P,a as t,ad as o,ar as Re,ak as C,w as a,u as e,aw as q,b3 as ne,b0 as H,J as Ne,G as Ue,F as Me,o as n,aV as se,v as Oe,y as Le,b as Qe,x as Ve,B as qe,a7 as He,am as We,D as Fe,E as Ge,d as T,ax as oe,ay as Ae,H as Je,aK as Ke,j as E,aL as le,q as W,m as S,l as Ye,f as Xe}from"./BGF4MUq3.js";import{_ as Ze}from"./YTRC3v4f.js";import{_ as et}from"./RAQfg7Er.js";import{_ as tt}from"./utDl_mGM.js";import{_ as at}from"./DBk2hNHm.js";import{_ as nt}from"./DX0sNGfI.js";const st={class:"pageOutput",full:""},ie=1e3,x=3,re=99,mt=Ee({__name:"output",setup(ot){const{isQueue:F,output:ue,isInitQueue:z,progress:h,previewImageUrl:B,state:ce}=m(),u=Se(),{processing:pe}=xe(ze()),j=r(null),me=r(0),fe=r(0),_e=r(!1),c=r(!1),v=r(!1),D=r(!1),l=r([]),$=r(!1),G=r("Starting."),R=r(-1),f=r(!1);let N=1,U;const M=I(()=>l.value.length===re),de=I(()=>!z.value&&(h.value>=0||l.value.length>0)?!0:z.value),A=I(()=>u.imageHeight/u.imageWidth*100),J=I(()=>u.prompt),ge=async()=>{await E().open({name:"prompt"})||(await y(),await m().postInterrupt(),me.value=0,fe.value=0,_e.value=!1,l.value=[],await le(),await u.setWorkflow(),u.incrementRetryCount(),w())},he=()=>{u.incrementRetryCount(),W(S().generate("upload"))},ve=()=>{u.init(),W(S().generate("lookstyle"))},we=async s=>{f.value=!0,await E().open({name:"upscaleSelect",options:{seed:l.value[s].seed}}),f.value=!1,b()},ye=s=>{l.value.splice(s,1)},ke=async()=>{const s=await E().open({name:"uploadImage"});s&&s.base64&&s.file&&(u.continue(s.base64,s.file),W(S().generate("confirm")))},K=async()=>{await E().open({name:"generateEndDialog"})&&(u.init(),Ye().replace(S().generate("lookstyle")))},Ce=async s=>{await Xe().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>f.value=!0,onDownloadEnd:()=>f.value=!1}}),F.value||b()},w=async()=>{M.value||c.value||f.value||(F.value?(await H().wait(ie),w()):(D.value=!0,await y(),c.value=!1,await m().queuePrompt({json:u.workflow,batchCount:1}),D.value=!1))},O=async()=>{v.value=!0,D.value?(await H().wait(ie),await O()):(await y(),await m().postInterrupt(),v.value=!1,c.value=!0)},b=()=>{c.value=!1,w()},y=async()=>{await m().queueClear(),await m().historyClear()};return ae(()=>ue.value,async s=>{if(!f.value&&s&&s.length>0){const i=s[s.length-1];i.src.includes("upscale")||l.value.push(i),j.value&&(await le(),await H().wait(250),j.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),ae(()=>l.value.length,async(s,i)=>{i!==void 0&&s>i&&w()},{immediate:!0}),Be(async()=>{await y(),await m().postInterrupt(),w(),U=je(()=>{N=N%3+1,G.value=" Starting "+".".repeat(N)},1e3),$.value=!0}),De(async()=>{await y(),await m().postInterrupt(),U!==null&&clearInterval(U)}),(s,i)=>{const Y=Le,$e=Oe,X=Ze,k=Ve,p=Qe,L=Ne,Q=Ue,V=qe,be=Fe,Z=We,d=Me,Ie=He,ee=Ge,Pe=Je,Te=et;return n(),P("div",st,[t(L,{justify:"center",gap:[8,28],split:x},{default:a(()=>[(n(!0),P(q,null,se(e(l),(_,g)=>(n(),o(Q,{key:`pageOutput-item-generate-${g}`,justify:"center",gap:"10"},{default:a(()=>[t(X,{per:e(A)},{default:a(()=>[t($e,{onClick:te=>Ce(g)},{default:a(()=>[t(Y,{class:"pageOutput-img",src:_.src,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(L,{justify:"center",gap:"20"},{default:a(()=>[t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>we(g)},{default:a(()=>[t(k,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ye(g)},{default:a(()=>[t(k,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(M)?C("",!0):(n(!0),P(q,{key:0},se(x-e(l).length%x,_=>(n(),o(X,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:e(A)},{default:a(()=>[_===1?(n(),o(d,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:g=>R.value=_,onMouseleave:i[0]||(i[0]=g=>R.value=-1)},{default:a(()=>[e(pe)?(n(),o(V,{key:0,w:"100%",h:"100%"})):e(B)?(n(),o(Y,{key:2,src:e(B),cover:""},null,8,["src"])):(n(),o(V,{key:1,w:"100%",h:"100%",animation:""})),t(Ie,{duration:"100"},{default:a(()=>[e(R)===_||e(c)?(n(),o(d,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"text060"},{default:a(()=>[t(Z,null,{default:a(()=>[e(v)?(n(),o(p,{key:0,link:""},{default:a(()=>[t(be,{size:"2.2vw",color:"light"})]),_:1})):e(c)?(n(),o(p,{key:2,link:"",onClick:b},{default:a(()=>[t(k,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(p,{key:1,link:"",onClick:O},{default:a(()=>[t(k,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):C("",!0)]),_:2},1024),!e(f)&&!e(c)&&!e(v)?(n(),o(d,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark-090","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(ce)==="executing"&&e(B)&&e($)?(n(),o(ee,{key:0,footnote:"",bold:"",center:"",color:"light","cap-height-baseline":""},{default:a(()=>[T(oe(Math.round(e(h)*100))+"% ",1)]),_:1})):!e(z)||e(h)===0||!e($)?(n(),o(ee,{key:1,footnote:"",bold:"",color:"light","cap-height-baseline":"",style:{width:"56px"}},{default:a(()=>[T(oe(e(G)),1)]),_:1})):C("",!0)]),_:1})):C("",!0)]),_:2},1032,["onMouseover"])):(n(),o(V,{key:1,w:"100%",h:"100%",animation:!e(de),delay:_/x*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(d,{h:"80"}),e(M)?(n(),o(Q,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(Ae,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Pe,null,{default:a(()=>[t(Q,{justify:"stretch",gap:"20"},{default:a(()=>[t(p,{onClick:he},{default:a(()=>i[1]||(i[1]=[T(" 内容を変更してやり直す ")])),_:1}),t(p,{info:"",onClick:ve},{default:a(()=>i[2]||(i[2]=[T(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(d,{key:1,fixed:"",bottom:"20",left:"0",right:"0"},{default:a(()=>[t(Z,null,{default:a(()=>[t(nt,{paused:e(c),processing:!e(l).length&&!e(h)&&!e(c)||e(v),progress:e(l).length+e(h),count:e(l).length,total:re,onPause:O,onResume:b,onNext:ke,onEnd:K},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),Re("div",{ref_key:"element",ref:j,class:"pageOutput-scrollTarget"},null,512),e($)?(n(),P(q,{key:2},[(n(),o(ne,{to:"#headerWideCenter"},[t(L,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(at,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(tt,{class:Ke(["headerPrompt-list-inner",{_empty:e(J).length===0}]),name:"プロンプト",data:e(J),more:""},null,8,["class","data"])]),_:1}),t(d,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(p,{w:"100%",h:"100%",info:"",onClick:ge},{default:a(()=>[t(k,{name:"edit",size:"20",gradation:"horizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(ne,{to:"#headerWideRightEnd"},[t(Te,{class:"headerEndBtn",link:"",xsmall:"",icon:{name:"cross",size:20},onClick:K})]))],64)):C("",!0)])}}});export{mt as default};
