import{d as Pe,aN as Ie,aw as be,aX as Oe,x as i,h as $,P as se,o as Re,a5 as _,aY as Ne,X as Se,f as n,g as T,z as t,w as a,F as G,G as oe,Y as e,l as y,i as o,aa as ze,A as P,k as xe,p as Be,aP as le,a0 as I,aB as ie,n as Q,c as b,e as De,aM as V,D as Le,a2 as Ue,t as Me,U as Ae,a6 as je,E as Ge,V as Qe,aO as Ve,B as ue,av as Ye,a8 as Fe,aD as He,R as We,_ as qe}from"./CAKlC2Ui.js";import{_ as Ke}from"./BFEPY4sZ.js";import{_ as Xe}from"./CHtjVyWs.js";import{_ as Je}from"./DMM6-Dos.js";import{_ as Ze}from"./CikxdW1q.js";import{_ as et}from"./CSvM-mC8.js";const tt={class:"pageOutput",full:""},re=1e3,O=3,Y=99,rt=Pe({__name:"output",setup(at){const{isQueue:F,output:ce,isInitQueue:R,progress:w,previewImageUrl:N,state:pe}=_(),u=Ie(),{processing:H}=be(Oe()),S=i(null),me=i(0),_e=i(0),fe=i(!1),r=i(!1),k=i(!1),z=i(!1),l=i([]),W=i(!1),q=i("Starting."),x=i(-1),f=i(!1);let B=1,D;const L=$(()=>l.value.length===Y),de=$(()=>!R.value&&(w.value>=0||l.value.length>0)?!0:R.value),K=$(()=>u.imageHeight/u.imageWidth*100),X=$(()=>u.prompt),ge=async()=>{await I().open({name:"prompt"})||(await h(),await _().postInterrupt(),me.value=0,_e.value=0,fe.value=!1,l.value=[],await ie(),await u.setWorkflow(),u.incrementRetryCount(),C())},ve=()=>{u.incrementRetryCount(),Q(b().GENERATE_UPLOAD)},we=()=>{u.init(),Q(b().GENERATE_LOOKSTYLE)},he=async s=>{f.value=!0,await I().open({name:"upscaleSelect",options:{src:l.value[s]}}),f.value=!1,E()},ye=s=>{l.value.splice(s,1)},ke=async()=>{const s=await I().open({name:"uploadImage"});s&&s.base64&&s.file&&(u.continue(s.base64,s.file),Q(b().GENERATE_CONFIRM))},J=async()=>{await I().open({name:"generateEndDialog"})&&(u.init(),De().replace(b().GENERATE_LOOKSTYLE))},Ce=async s=>{await Ye().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>f.value=!0,onDownloadEnd:()=>f.value=!1}}),F.value||E()},C=async()=>{L.value||r.value||(F.value?(await V().wait(re),C()):(z.value=!0,await h(),r.value=!1,await _().queuePrompt({json:JSON.stringify(u.workflow),batchCount:Y-l.value.length}),z.value=!1))},U=async()=>{k.value=!0,z.value?(await V().wait(re),await U()):(await h(),await _().postInterrupt(),k.value=!1,r.value=!0)},E=()=>{r.value=!1,C()},h=async()=>{await _().queueClear(),await _().historyClear()};return se(()=>ce.value,async s=>{if(!f.value&&s&&s.length>0){const c=s[s.length-1];c.includes("upscale")||l.value.push(c),S.value&&(await ie(),await V().wait(250),S.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),se(()=>H.value,s=>{console.log("upscaleProcessing",s)}),Re(async()=>{await h(),await _().postInterrupt(),C(),D=Ne(()=>{B=B%3+1,q.value=" Starting "+".".repeat(B)},1e3),W.value=!0}),Se(()=>{h(),D!==null&&clearInterval(D)}),(s,c)=>{const Z=Fe,ee=Ke,d=Le,p=Ue,M=Me,A=Ae,j=Xe,Ee=He,te=je,g=Ge,$e=We,ae=qe,Te=Qe;return n(),T("div",tt,[t(M,{justify:"center",gap:[8,28],split:O},{default:a(()=>[(n(!0),T(G,null,oe(e(l),(m,v)=>(n(),o(A,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:a(()=>[t(ee,{per:e(K)},{default:a(()=>[t(Ve,{onClick:ne=>Ce(v)},{default:a(()=>[t(Z,{src:m,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(M,{justify:"center",gap:"20"},{default:a(()=>[t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ne=>he(v)},{default:a(()=>[t(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ne=>ye(v)},{default:a(()=>[t(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(L)?y("",!0):(n(!0),T(G,{key:0},oe(O-e(l).length%O,m=>(n(),o(ee,{key:`pageOutput-item-${m}`,class:"pageOutput-img",per:e(K)},{default:a(()=>[m===1?(n(),o(g,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:v=>x.value=m,onMouseleave:c[0]||(c[0]=v=>x.value=-1)},{default:a(()=>[e(H)?(n(),o(j,{key:0,w:"100%",h:"100%"})):e(N)?(n(),o(Z,{key:2,src:e(N),cover:""},null,8,["src"])):(n(),o(j,{key:1,w:"100%",h:"100%",animation:""})),t($e,{duration:"100"},{default:a(()=>[e(x)===m||e(r)?(n(),o(g,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:a(()=>[t(te,null,{default:a(()=>[e(k)?(n(),o(p,{key:0,link:""},{default:a(()=>[t(Ee,{size:"2.2vw",color:"light"})]),_:1})):e(r)?(n(),o(p,{key:2,link:"",onClick:E},{default:a(()=>[t(d,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(p,{key:1,link:"",onClick:U},{default:a(()=>[t(d,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):y("",!0)]),_:2},1024),!e(f)&&!e(r)?(n(),o(g,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(pe)==="executing"&&e(N)?(n(),o(ae,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:a(()=>[P(ue(Math.round(e(w)*100))+"% ",1)]),_:1})):!e(R)||e(w)===0?(n(),o(ae,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:a(()=>[P(ue(e(q)),1)]),_:1})):y("",!0)]),_:1})):y("",!0)]),_:2},1032,["onMouseover"])):(n(),o(j,{key:1,w:"100%",h:"100%",animation:!e(de),delay:m/O*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(g,{h:"40"}),e(L)?(n(),o(A,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(ze,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Te,null,{default:a(()=>[t(A,{justify:"stretch",gap:"20"},{default:a(()=>[t(p,{onClick:ve},{default:a(()=>c[1]||(c[1]=[P(" 内容を変更してやり直す ")])),_:1}),t(p,{info:"",onClick:we},{default:a(()=>c[2]||(c[2]=[P(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(g,{key:1,w:"100%",fixed:"",bottom:"20"},{default:a(()=>[t(te,null,{default:a(()=>[t(et,{paused:e(r),processing:!e(l).length&&!e(w)&&!e(r)||e(k),progress:e(l).length+e(w),count:e(l).length,total:Y,onPause:U,onResume:E,onNext:ke,onEnd:J},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),xe("div",{ref_key:"element",ref:S,class:"pageOutput-scrollTarget"},null,512),e(W)?(n(),T(G,{key:2},[(n(),o(le,{to:"#headerWideCenter"},[t(M,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(Ze,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(Je,{class:Be(["headerPrompt-list-inner",{_empty:e(X).length===0}]),name:"プロンプト",data:e(X),more:""},null,8,["class","data"])]),_:1}),t(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(p,{w:"100%",h:"100%",info:"",onClick:ge},{default:a(()=>[t(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(le,{to:"#headerWideRightEnd"},[t(p,{class:"headerEndBtn",link:"",xsmall:"",onClick:J},{default:a(()=>[t(d,{name:"cross",size:"20"})]),_:1})]))],64)):y("",!0)])}}});export{rt as default};
