import{d as ve,aH as he,x as c,h as A,P as K,o as ke,aw as X,aR as we,X as Ce,a5 as _,f as o,g as T,z as e,w as t,F as U,G as Z,Y as a,l as k,i as l,A as v,p as ye,aJ as ee,a0 as $e,n as te,c as N,e as Ee,aG as ae,D as Te,a2 as Re,t as be,U as Ie,E as Pe,V as Se,aI as Oe,B as ne,aS as Le,aq as Be,$ as De,a8 as ze,_ as Ae,a6 as Ue,R as Ne}from"./CrK6v5fJ.js";import{_ as je}from"./DjW3Z0_V.js";import{_ as Ge}from"./CRpUYKzS.js";import{_ as Me}from"./Bg6VvwJl.js";import{_ as qe}from"./COWQ-uvU.js";import{_ as He}from"./DqU5MqFc.js";import{_ as Ve}from"./BWhITg0J.js";const Fe=1e3,oe=.1,R=3,j=99,et=ve({__name:"output",setup(Qe){const{isQueue:b,output:se,isInitQueue:I,progress:w}=_(),r=he(),P=c(null),C=c(0),h=c(0),S=c(!1),m=c(!1),s=c([]),G=c(!1),M=c("Starting."),O=c(-1);let L=1,B;const y=A(()=>s.value.length===j),le=A(()=>!I.value&&(w.value>=0||s.value.length>0)?!0:I.value),q=A(()=>r.imageHeight/r.imageWidth*100),ue=async()=>{await $e().open({name:"prompt"})||(b.value&&_().postInterrupt(),_().queueClear(),C.value=0,h.value=0,S.value=!1,s.value=[],await X(),await r.setWorkflow(),r.incrementRetryCount(),$())},ie=()=>{r.incrementRetryCount(),te(N().GENERATE_UPLOAD)},re=()=>{r.init(),te(N().GENERATE_LOOKSTYLE)},ce=n=>{Le().download(s.value[n],`${s.value[n].split(".")[0]}_${n}.png`)},me=n=>{s.value.splice(n,1)},H=()=>{s.value=[],Ee().replace(N().dashboard())},V=async()=>{if(m.value)return;const n=1e3;await ae().wait(n),h.value-=n,h.value>=0?V():h.value=0},_e=n=>{Be().open({name:"imagePreview",options:{index:n,list:s.value,onDownloadEnd:()=>F()}})},$=async()=>{y.value||m.value||(b.value?(await ae().wait(Fe),$()):(m.value=!1,_().queuePrompt({json:JSON.stringify(r.workflow),batchCount:j-s.value.length})))},pe=()=>{m.value=!0,_().postInterrupt(),_().queueClear()},F=()=>{m.value=!1,$()};return K(()=>se.value,n=>{n&&n.length>0&&(s.value.push(n[n.length-1].replace("http://127.0.0.1:8188",De().public.BASE_URL)),P.value&&P.value.scrollIntoView({behavior:"smooth",block:"end"}))},{deep:!0}),K(()=>w.value,(n,u)=>{if(!C.value&&u===0&&(C.value=Date.now()),n>=oe&&!S.value){S.value=!0;const D=Date.now()-C.value;h.value=D*(1/oe)*(j-s.value.length),V()}},{immediate:!0}),ke(async()=>{await X(),$(),B=we(()=>{L=L%3+1,M.value=" Starting "+".".repeat(L)},1e3),G.value=!0}),Ce(()=>{b.value&&_().postInterrupt(),_().queueClear(),B!==null&&clearInterval(B)}),(n,u)=>{const D=ze,Q=je,f=Te,i=Re,z=be,E=Ie,W=Ge,x=Ae,d=Pe,fe=Ue,de=Ne,Y=Se,ge=Me;return o(),T("div",{ref_key:"element",ref:P,class:"pageOutput",full:""},[e(z,{gap:"8",split:R},{default:t(()=>[(o(!0),T(U,null,Z(a(s),(p,g)=>(o(),l(E,{key:`pageOutput-item-generate-${g}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(Q,{per:a(q)},{default:t(()=>[e(Oe,{onClick:J=>_e(g)},{default:t(()=>[e(D,{src:p,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(z,{justify:"center",gap:"20"},{default:t(()=>[e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:J=>ce(g)},{default:t(()=>[e(f,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:J=>me(g)},{default:t(()=>[e(f,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(y)?k("",!0):(o(!0),T(U,{key:0},Z(R-a(s).length%R,p=>(o(),l(Q,{key:`pageOutput-item-${p}`,class:"pageOutput-img",per:a(q)},{default:t(()=>[p===1?(o(),l(d,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"",onMouseover:g=>O.value=p,onMouseleave:u[0]||(u[0]=g=>O.value=-1)},{default:t(()=>[e(W,{w:"100%",h:"100%",animation:""}),e(d,{absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[a(I)&&a(w)>0?(o(),l(x,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[v(ne(Math.round(a(w)*100))+"% ",1)]),_:1})):(o(),l(x,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[v(ne(a(M)),1)]),_:1}))]),_:1}),e(de,{duration:"100"},{default:t(()=>[a(O)===p||a(m)?(o(),l(d,{key:0,absolute:"",top:"0",left:"0",w:"100%",h:"100%"},{default:t(()=>[e(fe,null,{default:t(()=>[a(m)?(o(),l(i,{key:1,link:"",onClick:F},{default:t(()=>[e(f,{name:"play",size:"20"})]),_:1})):(o(),l(i,{key:0,link:"",onClick:pe},{default:t(()=>[e(f,{name:"pause",size:"20"})]),_:1}))]),_:1})]),_:1})):k("",!0)]),_:2},1024)]),_:2},1032,["onMouseover"])):(o(),l(W,{key:1,w:"100%",h:"100%",animation:!a(le),delay:p/R*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(d,{h:"36"}),a(y)?(o(),l(E,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(qe,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(Y,null,{default:t(()=>[e(E,{justify:"stretch",gap:"20"},{default:t(()=>[e(i,{onClick:ie},{default:t(()=>u[1]||(u[1]=[v(" 内容を変更してやり直す ")])),_:1}),e(i,{info:"",onClick:re},{default:t(()=>u[2]||(u[2]=[v(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):k("",!0),e(ge,null,{default:t(()=>[!a(y)&&a(m)?(o(),l(Y,{key:0},{default:t(()=>[e(E,{justify:"center"},{default:t(()=>[e(i,{info:""},{default:t(()=>u[3]||(u[3]=[v(" 続けて他の原図を生成する ")])),_:1}),e(d,{h:"0"}),e(i,{minimal:"",onClick:H},{default:t(()=>u[4]||(u[4]=[v(" 終了する ")])),_:1})]),_:1})]),_:1})):k("",!0)]),_:1}),a(G)?(o(),T(U,{key:1},[(o(),l(ee,{to:"#headerWideCenter"},[e(z,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Ve,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(He,{class:ye(["headerPrompt-list-inner",{_empty:a(r).prompt.length===0}]),name:"プロンプト",data:a(r).prompt},null,8,["class","data"])]),_:1}),e(d,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(i,{w:"100%",h:"100%",info:"",onClick:ue},{default:t(()=>[e(f,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(o(),l(ee,{to:"#headerWideRightEnd"},[e(i,{class:"headerEndBtn",link:"",xsmall:"",onClick:H},{default:t(()=>[e(f,{name:"cross",size:"20"})]),_:1})]))],64)):k("",!0)],512)}}});export{et as default};
