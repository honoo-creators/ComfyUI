import{d as _e,ac as de,r as f,k,a0 as F,o as ge,U as Y,ap as he,a1 as ve,a6 as d,p as s,w as t,a7 as J,F as ye,g as a,h as n,l as e,m as K,ad as X,t as u,f as w,G as Z,v as ke,M as ee,N as L,q as g,af as te,c as A,O as we,n as ae,ag as Ce,K as $e,Y as Se,_ as Ee,z as Pe,J as Te,B as be,D as Le,H as ne,aq as Oe,W as Re}from"./WHSOQWA4.js";import{_ as Me}from"./z4BbKwUn.js";import{_ as Be}from"./DfZwukZZ.js";import{_ as oe}from"./DDdCgteD.js";import{_ as Ie}from"./BcNIklcX.js";const Ne={key:1,class:"pageOutput-info-spinner"},Ue=["innerHTML"],De=["innerHTML"],Ae=1e3,se=.1,le=4,h=40,xe=_e({__name:"output",setup(He){const{isQueue:O,output:re,isInitQueue:R,progress:C}=d(),l=de(),M=f(0),m=f(0),H=f(!1),_=f(!1),r=f([]),j=f(!1),q=f("Starting.");let B=1,I;const N=k(()=>`${r.value.length}/${h}`),U=k(()=>{if(r.value.length===h)return"背景美術を生成しました。";const o=Math.floor(m.value/36e5),i=Math.floor(m.value%36e5/6e4),c=Math.floor(m.value%6e4/1e3);let v="";return o===0&&i===0&&c===0?v="-- : -- : --":v=`${String(o).padStart(2,"0")} : ${String(i).padStart(2,"0")} : ${String(c).padStart(2,"0")}`,D.value?`${v}`:" "}),$=k(()=>r.value.length===h),D=k(()=>!R.value&&(C.value>=0||r.value.length>0)?!0:R.value),ie=k(()=>l.imageHeight/l.imageWidth*100),z=async()=>{await we().open({name:"prompt"})||(O.value&&d().postInterrupt(),d().queueClear(),r.value=[],await Y(),await l.setWorkflow(),l.incrementRetryCount(),S())},ue=()=>{l.incrementRetryCount(),ae(A().GENERATE_UPLOAD)},ce=()=>{l.init(),ae(A().GENERATE_LOOKSTYLE)},G=async()=>{if(_.value)return;const o=1e3;await J().wait(o),m.value-=o,m.value>=0?G():m.value=0},pe=o=>{Oe().open({name:"imagePreview",options:{index:o,list:r.value,onDownloadEnd:()=>W()}})},S=async()=>{$.value||_.value||(O.value?(await J().wait(Ae),S()):(_.value=!1,d().queuePrompt({json:JSON.stringify(l.workflow),batchCount:h-r.value.length})))},W=()=>{_.value=!1,S()};return F(()=>re.value,o=>{o&&o.length>0&&r.value.push(o[o.length-1].replace("http://127.0.0.1:8188",Ce().public.BASE_URL))},{deep:!0}),F(()=>C.value,(o,i)=>{if(!M.value&&i===0&&(M.value=Date.now()),o>=se&&!H.value){H.value=!0;const c=Date.now()-M.value;m.value=c*(1/se)*(h-r.value.length),G()}},{immediate:!0}),ge(async()=>{await Y(),S(),I=he(()=>{B=B%3+1,q.value=" Starting "+".".repeat(B)},1e3),j.value=!0}),ve(()=>{O.value&&d().postInterrupt(),d().queueClear(),I!==null&&clearInterval(I)}),(o,i)=>{const c=$e,v=Se,E=Ee,P=Pe,T=Te,me=Re,x=Me,fe=Be,b=be,y=Le,Q=ye;return a(),s(Q,{class:"pageOutput",wide:""},{default:t(()=>[n(T,{gap:"36"},{default:t(()=>[e($)?(a(),s(oe,K({key:0},{title:e(N),body:e(U)},{icon:"shine"}),null,16)):(a(),s(T,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:t(()=>[n(E,{w:"48",h:"48",mt:"20",relative:""},{default:t(()=>[e(_)?(a(),s(X,{key:0,onClick:W},{default:t(()=>[n(c,{name:"play",size:"44"})]),_:1})):u("",!0),e(_)?u("",!0):(a(),w("div",Ne,[n(v,{size:"48",stroke:"4.4"})]))]),_:1}),e(N)?(a(),s(P,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:t(()=>[Z("span",{innerHTML:e(N)},null,8,Ue)]),_:1})):u("",!0),e(U)?(a(),s(P,{key:1,class:ke(["pageOutput-info-body",{_animation:!e(D)}]),caption1:"",bold:"",center:""},{default:t(()=>[Z("span",{innerHTML:e(U)},null,8,De)]),_:1},8,["class"])):u("",!0)]),_:1})),n(b,{gap:"8",split:le},{default:t(()=>[(a(),w(L,null,ee(h,p=>n(fe,{key:`pageOutput-item-${p}`,class:"pageOutput-img",per:e(ie)},{default:t(()=>[e(r)[p-1]?(a(),s(X,{key:0,onClick:V=>pe(p-1)},{default:t(()=>[n(me,{src:e(r)[p-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):u("",!0),!e($)&&p-1===e(r).length?(a(),s(E,{key:1,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:""},{default:t(()=>[n(x,{w:"100%",h:"100%",animation:""}),n(E,{absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[e(R)&&e(C)>0?(a(),s(P,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[g(ne(Math.round(e(C)*100))+"% ",1)]),_:1})):(a(),s(P,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[g(ne(e(q)),1)]),_:1}))]),_:1})]),_:1})):(a(),s(x,{key:2,w:"100%",h:"100%",animation:!e(D),delay:p/le*150},null,8,["animation","delay"]))]),_:2},1032,["per"])),64))]),_:1}),e($)?(a(),s(T,{key:2,justify:"center",gap:"40"},{default:t(()=>[n(oe,{icon:"checkCircleLine",body:"生成画像は以上です"}),n(Q,null,{default:t(()=>[n(T,{justify:"stretch",gap:"20"},{default:t(()=>[n(y,{onClick:ue},{default:t(()=>i[0]||(i[0]=[g(" 設定を変更してやり直す ")])),_:1}),n(y,{info:"",onClick:ce},{default:t(()=>i[1]||(i[1]=[g(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):u("",!0)]),_:1}),e(j)?(a(),w(L,{key:0},[(a(),s(te,{to:"#headerWideCenter"},[e(l).prompt&&e(l).prompt.length>0?(a(),s(b,{key:0,class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[n(b,{class:"headerPrompt-list",align:"center",gap:"2",fit:""},{default:t(()=>[(a(!0),w(L,null,ee(e(l).prompt,(p,V)=>(a(),s(Ie,K({key:`headerPrompt-item-${V}`,ref_for:!0},{text:p}),null,16))),128))]),_:1}),n(E,{class:"headerPrompt-btn",w:"40","min-w":"40",h:"40","min-h":"40"},{default:t(()=>[n(y,{class:"headerPrompt-btn-inner",w:"100%",h:"100%",onClick:z},{default:t(()=>[n(c,{name:"edit",size:"16",color:"light"})]),_:1})]),_:1})]),_:1})):!e(l).prompt||!e(l).prompt.length?(a(),s(b,{key:1,class:"headerPromptEmpty",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[n(y,{xsmall:"",rounded:"",w:"160",onClick:z},{default:t(()=>[n(c,{name:"edit",size:"16",color:"light"}),!e(l).prompt||!e(l).prompt.length?(a(),w(L,{key:0},[g(" プロンプトを設定する ")],64)):u("",!0)]),_:1})]),_:1})):u("",!0)])),(a(),s(te,{to:"#headerWideRightEnd"},[n(y,{class:"headerEndBtn",minimal:"",xsmall:"",to:("useConstantsPath"in o?o.useConstantsPath:e(A))().dashboard()},{default:t(()=>i[2]||(i[2]=[g(" 終了する ")])),_:1},8,["to"])]))],64)):u("",!0)]),_:1})}}});export{xe as default};
