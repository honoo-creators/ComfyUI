import{d as ee,aC as te,x as y,h as O,P as D,o as ne,X as ae,a5 as p,f as o,i as u,w as e,z as t,Y as a,m as oe,aD as L,l as f,g as S,k as G,A as P,G as se,F as ue,n as R,c as B,aB as I,D as le,aj as ie,E as ce,_ as re,a2 as _e,U as pe,t as fe,V as me,ak as de,$ as ge,ar as ve}from"./D8FECLYr.js";import{_ as ye}from"./CpYQ0e1V.js";import{_ as ke}from"./D5WO6Pr_.js";import{_ as he}from"./BGeTqhJx.js";import{_ as j}from"./KoVatLDu.js";const Ce={key:0,class:"pageOutput-info-spinner"},$e=["innerHTML"],we=["innerHTML"],x=1e3,z=3,m=9,Me=ee({__name:"output",setup(Ee){const{isQueue:k,output:H}=p(),g=te(),h=y(0),i=y(0),c=y(!1),l=y([]),C=O(()=>`${l.value.length}/${m}`),$=O(()=>{if(l.value.length===m)return"背景美術を生成しました。";const n=Math.floor(i.value/36e5),s=Math.floor(i.value%36e5/6e4),r=Math.floor(i.value%6e4/1e3);let _="";return n>0&&(_+=`${n}時間`),s>0&&(_+=`${s}分`),_+=`${r}秒`,k.value&&i.value<=0?"...":`あと ${_}`}),w=O(()=>l.value.length===m),V=()=>{N(),g.incrementRetryCount(),R(B().GENERATE_PROMPT_A)},q=()=>{g.incrementRetryCount(),R(B().GENERATE_UPLOAD)},Y=()=>{g.init(),R(B().GENERATE_LOOKSTYLE)},M=async()=>{if(c.value)return;const n=1e3;await I().wait(n),i.value-=n,i.value>=0?M():i.value=0},F=n=>{de().open({name:"imagePreview",options:{index:n,list:l.value,onDownloadEnd:()=>b()}})},E=async()=>{w.value||c.value||(k.value?(await I().wait(x),E()):(c.value=!1,p().queuePrompt({json:JSON.stringify(g.workflow),batchCount:m-l.value.length})))},N=()=>{c.value=!0,p().postInterrupt(),p().queueClear()},b=()=>{c.value=!1,E()};return D(()=>H.value,n=>{n&&n.length>0&&l.value.push(n[n.length-1].replace("http://127.0.0.1:8188",ge().public.BASE_URL))},{deep:!0}),D(()=>l.value.length,(n,s)=>{if(h.value||(h.value=Date.now()),n===1&&s===0){const r=Date.now()-h.value;i.value=(r+x)*(m-1),M()}},{immediate:!0}),ne(async()=>{E()}),ae(()=>{k.value&&p().postInterrupt(),p().queueClear()}),(n,s)=>{const r=le,_=ie,Q=ye,J=ce,A=re,T=_e,v=pe,K=ve,X=ke,W=he,Z=fe,U=me;return o(),u(U,{class:"pageOutput",wide:""},{default:e(()=>[t(v,{gap:"36"},{default:e(()=>[a(w)?(o(),u(j,oe({key:0},{title:a(C),body:a($)},{icon:"shine"}),null,16)):(o(),u(v,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:e(()=>[t(J,{w:"48",h:"48",mt:"20",relative:""},{default:e(()=>[t(_,null,{default:e(()=>[a(c)?f("",!0):(o(),u(L,{key:0,onClick:N},{default:e(()=>[t(r,{name:"pause",size:"24"})]),_:1})),a(c)?(o(),u(L,{key:1,onClick:b},{default:e(()=>[t(r,{name:"play",size:"44"})]),_:1})):f("",!0)]),_:1}),a(c)?f("",!0):(o(),S("div",Ce,[t(Q,{size:"64",stroke:"4.4"})]))]),_:1}),a(C)?(o(),u(A,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(C)},null,8,$e)]),_:1})):f("",!0),a($)?(o(),u(A,{key:1,class:"pageOutput-info-body",caption1:"",bold:"",center:""},{default:e(()=>[G("span",{innerHTML:a($)},null,8,we)]),_:1})):f("",!0),t(T,{class:"pageOutput-info-edit",link:"",xsmall:"","no-padding":"",onClick:V},{default:e(()=>[t(r,{name:"edit",size:"16"}),s[0]||(s[0]=P(" プロンプトを変更 "))]),_:1})]),_:1})),t(Z,{class:"pageOutput-list",gap:"2",split:z},{default:e(()=>[(o(),S(ue,null,se(m,d=>t(W,{key:`pageOutput-item-${d}`},{default:e(()=>[a(l)[d-1]?(o(),u(L,{key:0,class:"pageOutput-img",onClick:Te=>F(d-1)},{default:e(()=>[t(K,{src:a(l)[d-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):(o(),u(X,{key:1,w:"100%",h:"100%",animation:"",delay:d/z*150},null,8,["delay"]))]),_:2},1024)),64))]),_:1}),a(w)?(o(),u(v,{key:2,justify:"center",gap:"40"},{default:e(()=>[t(j,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(U,null,{default:e(()=>[t(v,{justify:"stretch",gap:"20"},{default:e(()=>[t(T,{onClick:q},{default:e(()=>s[1]||(s[1]=[P(" 設定を変更してやり直す ")])),_:1}),t(T,{info:"",onClick:Y},{default:e(()=>s[2]||(s[2]=[P(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1})}}});export{Me as default};
