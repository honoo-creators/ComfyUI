import{d as ee,aC as te,x as k,h as E,P as S,o as ne,f as o,i as u,w as e,z as n,Y as a,m as ae,aD as T,l as p,g as U,k as G,A as O,G as se,F as oe,n as L,c as P,aB as j,a5 as R,D as ue,aj as ie,E as le,_ as ce,a2 as re,U as _e,t as pe,V as fe,ak as me,$ as de,ar as ge}from"./CoUwSzTU.js";import{_ as ye}from"./8ERO6ok4.js";import{_ as ke}from"./BmrAIc45.js";import{_ as ve}from"./BJ0u1K-4.js";import{_ as x}from"./BTx_67QK.js";const he={key:0,class:"pageOutput-info-spinner"},Ce=["innerHTML"],$e=["innerHTML"],z=1e3,H=3,f=9,Me=ee({__name:"output",setup(we){const{isQueue:M,output:I}=R(),d=te(),v=k(0),i=k(0),l=k(!1),c=k([]),h=E(()=>`${c.value.length}/${f}`),C=E(()=>{if(c.value.length===f)return"背景美術を生成しました。";const t=Math.floor(i.value/36e5),s=Math.floor(i.value%36e5/6e4),r=Math.floor(i.value%6e4/1e3);let _="";return t>0&&(_+=`${t}時間`),s>0&&(_+=`${s}分`),_+=`${r}秒`,M.value&&i.value<=0?"...":`あと ${_}`}),$=E(()=>c.value.length===f),V=()=>{b(),d.incrementRetryCount(),L(P().GENERATE_PROMPT_A)},Y=()=>{d.incrementRetryCount(),L(P().GENERATE_UPLOAD)},q=()=>{d.init(),L(P().GENERATE_LOOKSTYLE)},N=async()=>{if(l.value)return;const t=1e3;await j().wait(t),i.value-=t,i.value>=0?N():i.value=0},F=t=>{me().open({name:"imagePreview",options:{index:t,list:c.value,onDownloadEnd:()=>A()}})},g=async()=>{$.value||l.value||(M.value?(await j().wait(z),g()):(l.value=!1,R().queuePrompt({json:JSON.stringify(d.workflow),batchCount:1})))},b=()=>{l.value=!0,R().postInterrupt()},A=()=>{l.value=!1,g()};return S(()=>I.value,t=>{t&&t.length>0&&c.value.push(t[t.length-1].replace("http://127.0.0.1:8188",de().public.BASE_URL))},{deep:!0}),S(()=>c.value.length,(t,s)=>{if(v.value||(v.value=Date.now()),t===1&&s===0){const r=Date.now()-v.value;i.value=(r+z)*(f-1),N()}t!==s&&t<f&&g()},{immediate:!0}),ne(async()=>{g()}),(t,s)=>{const r=ue,_=ie,Q=ye,J=le,B=ce,w=re,y=_e,K=ge,W=ke,X=ve,Z=pe,D=fe;return o(),u(D,{class:"pageOutput",wide:""},{default:e(()=>[n(y,{gap:"36"},{default:e(()=>[a($)?(o(),u(x,ae({key:0},{title:a(h),body:a(C)},{icon:"shine"}),null,16)):(o(),u(y,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:e(()=>[n(J,{w:"48",h:"48",mt:"20",relative:""},{default:e(()=>[n(_,null,{default:e(()=>[a(l)?p("",!0):(o(),u(T,{key:0,onClick:b},{default:e(()=>[n(r,{name:"pause",size:"24"})]),_:1})),a(l)?(o(),u(T,{key:1,onClick:A},{default:e(()=>[n(r,{name:"play",size:"44"})]),_:1})):p("",!0)]),_:1}),a(l)?p("",!0):(o(),U("div",he,[n(Q,{size:"64",stroke:"4.4"})]))]),_:1}),a(h)?(o(),u(B,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(h)},null,8,Ce)]),_:1})):p("",!0),a(C)?(o(),u(B,{key:1,class:"pageOutput-info-body",caption1:"",bold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(C)},null,8,$e)]),_:1})):p("",!0),n(w,{class:"pageOutput-info-edit",link:"",xsmall:"","no-padding":"",onClick:V},{default:e(()=>[n(r,{name:"edit",size:"16"}),s[0]||(s[0]=O(" プロンプトを変更 "))]),_:1})]),_:1})),n(Z,{class:"pageOutput-list",gap:"2",split:H},{default:e(()=>[(o(),U(oe,null,se(f,m=>n(X,{key:`pageOutput-item-${m}`},{default:e(()=>[a(c)[m-1]?(o(),u(T,{key:0,class:"pageOutput-img",onClick:Ee=>F(m-1)},{default:e(()=>[n(K,{src:a(c)[m-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):(o(),u(W,{key:1,w:"100%",h:"100%",animation:"",delay:m/H*150},null,8,["delay"]))]),_:2},1024)),64))]),_:1}),a($)?(o(),u(y,{key:2,justify:"center",gap:"40"},{default:e(()=>[n(x,{icon:"checkCircleLine",body:"生成画像は以上です"}),n(D,null,{default:e(()=>[n(y,{justify:"stretch",gap:"20"},{default:e(()=>[n(w,{onClick:Y},{default:e(()=>s[1]||(s[1]=[O(" 設定を変更してやり直す ")])),_:1}),n(w,{info:"",onClick:q},{default:e(()=>s[2]||(s[2]=[O(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})}}});export{Me as default};
