import{d as $e,aK as Ee,x as i,h as E,P as be,o as Ie,a5 as _,aU as Te,X as Pe,f as n,g as b,z as t,w as a,F as M,G as ne,Y as e,l as y,i as o,ag as Re,A as I,k as ze,p as Ne,aM as se,a0 as A,ay as oe,n as j,c as T,e as Oe,aJ as G,D as Se,a2 as xe,t as Be,U as Le,a6 as Ue,E as De,V as Me,aL as Ae,B as le,as as je,a8 as Ge,aA as Qe,R as Ve,_ as qe}from"./Dp_jrS8B.js";import{_ as Fe}from"./BG3yr8x8.js";import{_ as He}from"./C17dvCMh.js";import{_ as We}from"./B3QSYTJU.js";import{_ as Ye}from"./CXMyra83.js";import{_ as Je}from"./BP9tJSMU.js";const Ke={class:"pageOutput",full:""},ie=1e3,P=3,Q=99,lt=$e({__name:"output",setup(Xe){const{isQueue:V,output:ue,isInitQueue:R,progress:f,previewImageUrl:q,queueRemaining:Ze}=_(),u=Ee(),z=i(null),re=i(0),ce=i(0),pe=i(!1),r=i(!1),k=i(!1),N=i(!1),l=i([]),F=i(!1),H=i("Starting."),O=i(-1),d=i(!1);let S=1,x;const B=E(()=>l.value.length===Q),me=E(()=>!R.value&&(f.value>=0||l.value.length>0)?!0:R.value),W=E(()=>u.imageHeight/u.imageWidth*100),Y=E(()=>u.prompt),_e=async()=>{await A().open({name:"prompt"})||(await w(),await _().postInterrupt(),re.value=0,ce.value=0,pe.value=!1,l.value=[],await oe(),await u.setWorkflow(),u.incrementRetryCount(),C())},fe=()=>{u.incrementRetryCount(),j(T().GENERATE_UPLOAD)},de=()=>{u.init(),j(T().GENERATE_LOOKSTYLE)},ge=async s=>{d.value=!0,await A().open({name:"upscaleSelect",options:{src:l.value[s]}}),d.value=!1,$()},ve=s=>{l.value.splice(s,1)},he=async()=>{const s=await A().open({name:"uploadImage"});s&&s.base64&&s.file&&(u.continue(s.base64,s.file),j(T().GENERATE_CONFIRM))},J=()=>{l.value=[],Oe().replace(T().dashboard())},we=async s=>{await je().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>d.value=!0,onDownloadEnd:()=>d.value=!1}}),V.value||$()},C=async()=>{B.value||r.value||(V.value?(await G().wait(ie),C()):(N.value=!0,await w(),r.value=!1,await _().queuePrompt({json:JSON.stringify(u.workflow),batchCount:Q-l.value.length}),N.value=!1))},L=async()=>{k.value=!0,N.value?(await G().wait(ie),await L()):(await w(),await _().postInterrupt(),k.value=!1,r.value=!0)},$=()=>{r.value=!1,C()},w=async()=>{await _().queueClear(),await _().historyClear()};return be(()=>ue.value,async s=>{if(!d.value&&s&&s.length>0){const c=s[s.length-1];c.includes("upscale")||l.value.push(c),z.value&&(await oe(),await G().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),Ie(async()=>{await w(),await _().postInterrupt(),C(),x=Te(()=>{S=S%3+1,H.value=" Starting "+".".repeat(S)},1e3),F.value=!0}),Pe(()=>{w(),x!==null&&clearInterval(x)}),(s,c)=>{const K=Ge,X=Fe,g=Se,p=xe,U=Be,D=Le,Z=He,ye=Qe,ee=Ue,v=De,ke=Ve,te=qe,Ce=Me;return n(),b("div",Ke,[t(U,{justify:"center",gap:[8,28],split:P},{default:a(()=>[(n(!0),b(M,null,ne(e(l),(m,h)=>(n(),o(D,{key:`pageOutput-item-generate-${h}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:a(()=>[t(X,{per:e(W)},{default:a(()=>[t(Ae,{onClick:ae=>we(h)},{default:a(()=>[t(K,{src:m,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(U,{justify:"center",gap:"20"},{default:a(()=>[t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ae=>ge(h)},{default:a(()=>[t(g,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:ae=>ve(h)},{default:a(()=>[t(g,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(B)?y("",!0):(n(!0),b(M,{key:0},ne(P-e(l).length%P,m=>(n(),o(X,{key:`pageOutput-item-${m}`,class:"pageOutput-img",per:e(W)},{default:a(()=>[m===1?(n(),o(v,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:h=>O.value=m,onMouseleave:c[0]||(c[0]=h=>O.value=-1)},{default:a(()=>[e(q)?(n(),o(K,{key:1,src:e(q),cover:""},null,8,["src"])):(n(),o(Z,{key:0,w:"100%",h:"100%",animation:""})),t(ke,{duration:"100"},{default:a(()=>[e(O)===m||e(r)?(n(),o(v,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:a(()=>[t(ee,null,{default:a(()=>[e(k)?(n(),o(p,{key:0,link:""},{default:a(()=>[t(ye,{size:"2.2vw",color:"light"})]),_:1})):e(r)?(n(),o(p,{key:2,link:"",onClick:$},{default:a(()=>[t(g,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(p,{key:1,link:"",onClick:L},{default:a(()=>[t(g,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):y("",!0)]),_:2},1024),!e(d)&&!e(r)?(n(),o(v,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(R)&&e(f)>0?(n(),o(te,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:a(()=>[I(le(Math.round(e(f)*100))+"% ",1)]),_:1})):e(f)!==0?(n(),o(te,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:a(()=>[I(le(e(H)),1)]),_:1})):y("",!0)]),_:1})):y("",!0)]),_:2},1032,["onMouseover"])):(n(),o(Z,{key:1,w:"100%",h:"100%",animation:!e(me),delay:m/P*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(v,{h:"40"}),e(B)?(n(),o(D,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(Re,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Ce,null,{default:a(()=>[t(D,{justify:"stretch",gap:"20"},{default:a(()=>[t(p,{onClick:fe},{default:a(()=>c[1]||(c[1]=[I(" 内容を変更してやり直す ")])),_:1}),t(p,{info:"",onClick:de},{default:a(()=>c[2]||(c[2]=[I(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(v,{key:1,w:"100%",fixed:"",bottom:"20"},{default:a(()=>[t(ee,null,{default:a(()=>[t(Je,{paused:e(r),processing:!e(l).length&&!e(f)&&!e(r)||e(k),progress:e(l).length+e(f),count:e(l).length,total:Q,onPause:L,onResume:$,onNext:he,onEnd:J},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),ze("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),e(F)?(n(),b(M,{key:2},[(n(),o(se,{to:"#headerWideCenter"},[t(U,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(Ye,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(We,{class:Ne(["headerPrompt-list-inner",{_empty:e(Y).length===0}]),name:"プロンプト",data:e(Y),more:""},null,8,["class","data"])]),_:1}),t(v,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(p,{w:"100%",h:"100%",info:"",onClick:_e},{default:a(()=>[t(g,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(se,{to:"#headerWideRightEnd"},[t(p,{class:"headerEndBtn",link:"",xsmall:"",onClick:J},{default:a(()=>[t(g,{name:"cross",size:"20"})]),_:1})]))],64)):y("",!0)])}}});export{lt as default};
