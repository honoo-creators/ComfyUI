import{d as Ee,aK as Te,x as r,h as E,P as be,o as Ie,aU as ze,X as Pe,f as n,g as T,z as e,w as t,F as x,G as ae,Y as a,l as h,i as s,ag as Re,A as k,k as Oe,p as Ne,aM as ne,a0 as A,a5 as m,az as oe,n as Q,c as b,e as Se,aJ as I,D as Be,a2 as Le,t as Ue,U as De,E as Me,V as je,aL as xe,B as se,at as Ae,a8 as Qe,aB as Ge,a6 as Ve,R as qe,_ as Fe}from"./C7X0qSQ_.js";import{_ as He}from"./fUPzmCE3.js";import{_ as We}from"./DOl5CTbB.js";import{_ as Ye}from"./BPdk4A5Z.js";import{_ as Je}from"./Cr5NhlWl.js";import{_ as Ke}from"./BWdqfO6I.js";const Xe={class:"pageOutput",full:""},le=1e3,z=3,P=99,lt=Ee({__name:"output",setup(Ze){const{isQueue:R,output:ie,isInitQueue:O,progress:N,previewImageUrl:G,queueRemaining:V}=m(),c=Te(),S=r(null),ue=r(0),re=r(0),ce=r(!1),_=r(!1),B=r(!1),l=r([]),q=r(!1),F=r("Starting."),L=r(-1),d=r(!1);let U=1,D;const w=E(()=>l.value.length===P),me=E(()=>!O.value&&(N.value>=0||l.value.length>0)?!0:O.value),H=E(()=>c.imageHeight/c.imageWidth*100),W=E(()=>c.prompt),_e=async()=>{await A().open({name:"prompt"})||(R.value&&m().postInterrupt(),m().queueClear(),m().historyClear(),ue.value=0,re.value=0,ce.value=!1,l.value=[],await oe(),await c.setWorkflow(),c.incrementRetryCount(),y())},fe=()=>{c.incrementRetryCount(),Q(b().GENERATE_UPLOAD)},pe=()=>{c.init(),Q(b().GENERATE_LOOKSTYLE)},de=async o=>{d.value=!0,await A().open({name:"upscaleSelect",options:{src:l.value[o]}}),d.value=!1,M()},ge=o=>{l.value.splice(o,1)},ve=async()=>{const o=await A().open({name:"uploadImage"});o&&o.base64&&o.file&&(c.continue(o.base64,o.file),Q(b().GENERATE_CONFIRM))},Y=()=>{l.value=[],Se().replace(b().dashboard())},he=async o=>{await Ae().open({name:"imagePreview",options:{index:o,list:l.value,onDownloadStart:()=>d.value=!0,onDownloadEnd:()=>d.value=!1}}),R.value||M()},y=async()=>{w.value||_.value||(R.value?(await I().wait(le),y()):(_.value=!1,m().queuePrompt({json:JSON.stringify(c.workflow),batchCount:P-l.value.length})))},ke=async()=>{B.value=!0,await C(),B.value=!1,_.value=!0},M=()=>{_.value=!1,y()},C=async()=>{console.log("clearQueue",V.value,P-l.value.length),V.value<P-l.value.length?(await I().wait(le),C()):(await m().postInterrupt(),await I().wait(250),m().queueClear(),m().historyClear()),console.log("clearQueue done")};return be(()=>ie.value,async o=>{if(!d.value&&o&&o.length>0){const i=o[o.length-1];i.includes("upscale")||l.value.push(i),S.value&&(await oe(),await I().wait(250),S.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),Ie(async()=>{await C(),y(),D=ze(()=>{U=U%3+1,F.value=" Starting "+".".repeat(U)},1e3),q.value=!0}),Pe(()=>{C(),D!==null&&clearInterval(D)}),(o,i)=>{const J=Qe,K=He,g=Be,u=Le,j=Ue,$=De,X=We,we=Ge,ye=Ve,f=Me,Ce=qe,Z=Fe,ee=je,$e=Ye;return n(),T("div",Xe,[e(j,{justify:"center",gap:[8,28],split:z},{default:t(()=>[(n(!0),T(x,null,ae(a(l),(p,v)=>(n(),s($,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(K,{per:a(H)},{default:t(()=>[e(xe,{onClick:te=>he(v)},{default:t(()=>[e(J,{src:p,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(j,{justify:"center",gap:"20"},{default:t(()=>[e(u,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>de(v)},{default:t(()=>[e(g,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(u,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ge(v)},{default:t(()=>[e(g,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(w)?h("",!0):(n(!0),T(x,{key:0},ae(z-a(l).length%z,p=>(n(),s(K,{key:`pageOutput-item-${p}`,class:"pageOutput-img",per:a(H)},{default:t(()=>[p===1?(n(),s(f,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:v=>L.value=p,onMouseleave:i[0]||(i[0]=v=>L.value=-1)},{default:t(()=>[a(G)?(n(),s(J,{key:1,src:a(G),cover:""},null,8,["src"])):(n(),s(X,{key:0,w:"100%",h:"100%",animation:""})),e(Ce,{duration:"100"},{default:t(()=>[a(L)===p||a(_)?(n(),s(f,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(ye,null,{default:t(()=>[a(B)?(n(),s(u,{key:0,link:""},{default:t(()=>[e(we,{size:"20",color:"light"})]),_:1})):a(_)?(n(),s(u,{key:2,link:"",onClick:M},{default:t(()=>[e(g,{name:"play",size:"20",color:"light"})]),_:1})):(n(),s(u,{key:1,link:"",onClick:ke},{default:t(()=>[e(g,{name:"pause",size:"20",color:"light"})]),_:1}))]),_:1})]),_:1})):h("",!0)]),_:2},1024),a(d)?h("",!0):(n(),s(f,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(O)&&a(N)>0?(n(),s(Z,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[k(se(Math.round(a(N)*100))+"% ",1)]),_:1})):(n(),s(Z,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[k(se(a(F)),1)]),_:1}))]),_:1}))]),_:2},1032,["onMouseover"])):(n(),s(X,{key:1,w:"100%",h:"100%",animation:!a(me),delay:p/z*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(f,{h:"20"}),a(w)?(n(),s($,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Re,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(ee,null,{default:t(()=>[e($,{justify:"stretch",gap:"20"},{default:t(()=>[e(u,{onClick:fe},{default:t(()=>i[1]||(i[1]=[k(" 内容を変更してやり直す ")])),_:1}),e(u,{info:"",onClick:pe},{default:t(()=>i[2]||(i[2]=[k(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),e($e,null,{default:t(()=>[!a(w)&&a(_)?(n(),s(ee,{key:0},{default:t(()=>[e($,{justify:"center"},{default:t(()=>[e(u,{info:"",onClick:ve},{default:t(()=>i[3]||(i[3]=[k(" 続けて他の原図を生成する ")])),_:1}),e(f,{h:"0"}),e(u,{minimal:"",onClick:Y},{default:t(()=>i[4]||(i[4]=[k(" 終了する ")])),_:1}),e(f,{h:"40"})]),_:1})]),_:1})):h("",!0)]),_:1}),Oe("div",{ref_key:"element",ref:S,class:"pageOutput-scrollTarget"},null,512),a(q)?(n(),T(x,{key:1},[(n(),s(ne,{to:"#headerWideCenter"},[e(j,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Ke,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:t(()=>[e(Je,{class:Ne(["headerPrompt-list-inner",{_empty:a(W).length===0}]),name:"プロンプト",data:a(W),more:""},null,8,["class","data"])]),_:1}),e(f,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(u,{w:"100%",h:"100%",info:"",onClick:_e},{default:t(()=>[e(g,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(ne,{to:"#headerWideRightEnd"},[e(u,{class:"headerEndBtn",link:"",xsmall:"",onClick:Y},{default:t(()=>[e(g,{name:"cross",size:"20"})]),_:1})]))],64)):h("",!0)])}}});export{lt as default};
