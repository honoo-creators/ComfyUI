import{d as Ie,aM as be,av as Pe,aX as Re,x as u,h as T,P as ae,o as Ne,a5 as f,aY as Oe,X as Se,f as n,g as I,z as t,w as a,F as Q,G as ne,Y as e,l as C,i as o,aa as ze,A as b,k as Le,p as xe,aO as se,a0 as P,aA as oe,n as V,c as R,e as Be,aL as Y,D as De,a2 as Ue,t as Ae,U as Me,a6 as je,E as Ge,V as Qe,aN as Ve,B as le,au as Ye,a8 as Fe,aC as He,R as We,_ as qe}from"./DIrwYNX2.js";import{_ as Ke}from"./DKxVs-ke.js";import{_ as Xe}from"./C8IchNo1.js";import{_ as Je}from"./BfEaji3t.js";import{_ as Ze}from"./DoikVvds.js";import{_ as et}from"./fm_5Ri41.js";const tt={class:"pageOutput",full:""},ie=1e3,N=3,ue=99,rt=Ie({__name:"output",setup(at){const{isQueue:F,output:re,isInitQueue:O,progress:h,previewImageUrl:S,state:ce}=f(),r=be(),{processing:pe}=Pe(Re()),z=u(null),fe=u(0),me=u(0),_e=u(!1),c=u(!1),w=u(!1),L=u(!1),l=u([]),E=u(!1),H=u("Starting."),x=u(-1),m=u(!1);let B=1,D;const U=T(()=>l.value.length===ue),de=T(()=>!O.value&&(h.value>=0||l.value.length>0)?!0:O.value),W=T(()=>r.imageHeight/r.imageWidth*100),q=T(()=>r.prompt),ge=async()=>{await P().open({name:"prompt"})||(await k(),await f().postInterrupt(),fe.value=0,me.value=0,_e.value=!1,l.value=[],await oe(),await r.setWorkflow(),r.incrementRetryCount(),y())},ve=()=>{r.incrementRetryCount(),V(R().GENERATE_UPLOAD)},he=()=>{r.init(),V(R().GENERATE_LOOKSTYLE)},we=async s=>{m.value=!0,await P().open({name:"upscaleSelect",options:{src:l.value[s]}}),m.value=!1,$()},ye=s=>{l.value.splice(s,1)},ke=async()=>{const s=await P().open({name:"uploadImage"});s&&s.base64&&s.file&&(r.continue(s.base64,s.file),V(R().GENERATE_CONFIRM))},K=async()=>{await P().open({name:"generateEndDialog"})&&(r.init(),Be().replace(R().GENERATE_LOOKSTYLE))},Ce=async s=>{await Ye().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>m.value=!0,onDownloadEnd:()=>m.value=!1}}),F.value||$()},y=async()=>{U.value||c.value||m.value||(F.value?(await Y().wait(ie),y()):(L.value=!0,await k(),c.value=!1,await f().queuePrompt({json:JSON.stringify(f().workflow.updateSeed(r.workflow)),batchCount:1}),L.value=!1))},A=async()=>{w.value=!0,L.value?(await Y().wait(ie),await A()):(await k(),await f().postInterrupt(),w.value=!1,c.value=!0)},$=()=>{c.value=!1,y()},k=async()=>{await f().queueClear(),await f().historyClear()};return ae(()=>re.value,async s=>{if(!m.value&&s&&s.length>0){const i=s[s.length-1];i.includes("upscale")||l.value.push(i),z.value&&(await oe(),await Y().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),ae(()=>l.value.length,async(s,i)=>{i!==void 0&&s>i&&y()},{immediate:!0}),Ne(async()=>{await k(),await f().postInterrupt(),y(),D=Oe(()=>{B=B%3+1,H.value=" Starting "+".".repeat(B)},1e3),E.value=!0}),Se(()=>{k(),D!==null&&clearInterval(D)}),(s,i)=>{const X=Fe,J=Ke,d=De,p=Ue,M=Ae,j=Me,G=Xe,Ee=He,Z=je,g=Ge,$e=We,ee=qe,Te=Qe;return n(),I("div",tt,[t(M,{justify:"center",gap:[8,28],split:N},{default:a(()=>[(n(!0),I(Q,null,ne(e(l),(_,v)=>(n(),o(j,{key:`pageOutput-item-generate-${v}`,justify:"center",gap:"10"},{default:a(()=>[t(J,{per:e(W)},{default:a(()=>[t(Ve,{onClick:te=>Ce(v)},{default:a(()=>[t(X,{class:"pageOutput-img",src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(M,{justify:"center",gap:"20"},{default:a(()=>[t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>we(v)},{default:a(()=>[t(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(p,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ye(v)},{default:a(()=>[t(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(U)?C("",!0):(n(!0),I(Q,{key:0},ne(N-e(l).length%N,_=>(n(),o(J,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:e(W)},{default:a(()=>[_===1?(n(),o(g,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:v=>x.value=_,onMouseleave:i[0]||(i[0]=v=>x.value=-1)},{default:a(()=>[e(pe)?(n(),o(G,{key:0,w:"100%",h:"100%"})):e(S)?(n(),o(X,{key:2,src:e(S),cover:""},null,8,["src"])):(n(),o(G,{key:1,w:"100%",h:"100%",animation:""})),t($e,{duration:"100"},{default:a(()=>[e(x)===_||e(c)?(n(),o(g,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:a(()=>[t(Z,null,{default:a(()=>[e(w)?(n(),o(p,{key:0,link:""},{default:a(()=>[t(Ee,{size:"2.2vw",color:"light"})]),_:1})):e(c)?(n(),o(p,{key:2,link:"",onClick:$},{default:a(()=>[t(d,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(p,{key:1,link:"",onClick:A},{default:a(()=>[t(d,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):C("",!0)]),_:2},1024),!e(m)&&!e(c)&&!e(w)?(n(),o(g,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(ce)==="executing"&&e(S)&&e(E)?(n(),o(ee,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:a(()=>[b(le(Math.round(e(h)*100))+"% ",1)]),_:1})):!e(O)||e(h)===0||!e(E)?(n(),o(ee,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:a(()=>[b(le(e(H)),1)]),_:1})):C("",!0)]),_:1})):C("",!0)]),_:2},1032,["onMouseover"])):(n(),o(G,{key:1,w:"100%",h:"100%",animation:!e(de),delay:_/N*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(g,{h:"40"}),e(U)?(n(),o(j,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(ze,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Te,null,{default:a(()=>[t(j,{justify:"stretch",gap:"20"},{default:a(()=>[t(p,{onClick:ve},{default:a(()=>i[1]||(i[1]=[b(" 内容を変更してやり直す ")])),_:1}),t(p,{info:"",onClick:he},{default:a(()=>i[2]||(i[2]=[b(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(g,{key:1,fixed:"",bottom:"20",left:"0",right:"0"},{default:a(()=>[t(Z,null,{default:a(()=>[t(et,{paused:e(c),processing:!e(l).length&&!e(h)&&!e(c)||e(w),progress:e(l).length+e(h),count:e(l).length,total:ue,onPause:A,onResume:$,onNext:ke,onEnd:K},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),Le("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),e(E)?(n(),I(Q,{key:2},[(n(),o(se,{to:"#headerWideCenter"},[t(M,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(Ze,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(Je,{class:xe(["headerPrompt-list-inner",{_empty:e(q).length===0}]),name:"プロンプト",data:e(q),more:""},null,8,["class","data"])]),_:1}),t(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(p,{w:"100%",h:"100%",info:"",onClick:ge},{default:a(()=>[t(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(se,{to:"#headerWideRightEnd"},[t(p,{class:"headerEndBtn",link:"",xsmall:"",onClick:K},{default:a(()=>[t(d,{name:"cross",size:"20"})]),_:1})]))],64)):C("",!0)])}}});export{rt as default};
