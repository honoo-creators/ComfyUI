import{d as ee,aC as te,x as v,h as E,P as S,o as ne,f as s,i as u,w as e,z as t,Y as a,m as ae,aD as T,l as m,g as U,k as G,A as O,G as se,F as oe,n as L,c as P,aB as j,a5 as R,D as ue,aj as le,E as ie,_ as ce,a2 as re,U as _e,t as me,V as pe,ak as fe,$ as de,ar as ge}from"./MswBvSI2.js";import{_ as ve}from"./DPEzT2fp.js";import{_ as ye}from"./R15novYw.js";import{_ as ke}from"./DTOeklOL.js";import{_ as x}from"./Db_6kbwT.js";const he={key:0,class:"pageOutput-info-spinner"},Ce=["innerHTML"],$e=["innerHTML"],z=1e3,H=3,p=9,Me=ee({__name:"output",setup(we){const{isQueue:M,output:V}=R(),d=te(),y=v(0),i=v(0),c=v(!1),l=v([]),k=E(()=>`${l.value.length}/${p}`),h=E(()=>{if(l.value.length===p)return"背景美術を生成しました。";const n=Math.floor(i.value/36e5),o=Math.floor(i.value%36e5/6e4),r=Math.floor(i.value%6e4/1e3);let _="";return n>0&&(_+=`${n}時間`),o>0&&(_+=`${o}分`),_+=`${r}秒`,M.value&&i.value<=0?"...":`あと ${_}`}),C=E(()=>l.value.length===p),I=()=>{b(),d.incrementRetryCount(),L(P().GENERATE_PROMPT_A)},q=()=>{d.incrementRetryCount(),L(P().GENERATE_UPLOAD)},Y=()=>{d.init(),L(P().GENERATE_LOOKSTYLE)},N=async()=>{if(c.value)return;const n=1e3;await j().wait(n),i.value-=n,i.value>=0?N():i.value=0},F=n=>{fe().open({name:"imagePreview",options:{index:n,list:l.value,onDownloadEnd:()=>A()}})},$=async()=>{C.value||c.value||(M.value?(await j().wait(z),$()):(c.value=!1,R().queuePrompt({json:JSON.stringify(d.workflow),batchCount:p-l.value.length})))},b=()=>{c.value=!0,R().queueClear()},A=()=>{c.value=!1,$()};return S(()=>V.value,n=>{n&&n.length>0&&l.value.push(n[n.length-1].replace("http://127.0.0.1:8188",de().public.BASE_URL))},{deep:!0}),S(()=>l.value.length,(n,o)=>{if(y.value||(y.value=Date.now()),n===1&&o===0){const r=Date.now()-y.value;i.value=(r+z)*(p-1),N()}},{immediate:!0}),ne(async()=>{$()}),(n,o)=>{const r=ue,_=le,Q=ve,J=ie,B=ce,w=re,g=_e,K=ge,W=ye,X=ke,Z=me,D=pe;return s(),u(D,{class:"pageOutput",wide:""},{default:e(()=>[t(g,{gap:"36"},{default:e(()=>[a(C)?(s(),u(x,ae({key:0},{title:a(k),body:a(h)},{icon:"shine"}),null,16)):(s(),u(g,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:e(()=>[t(J,{w:"48",h:"48",mt:"20",relative:""},{default:e(()=>[t(_,null,{default:e(()=>[a(c)?m("",!0):(s(),u(T,{key:0,onClick:b},{default:e(()=>[t(r,{name:"pause",size:"24"})]),_:1})),a(c)?(s(),u(T,{key:1,onClick:A},{default:e(()=>[t(r,{name:"play",size:"44"})]),_:1})):m("",!0)]),_:1}),a(c)?m("",!0):(s(),U("div",he,[t(Q,{size:"64",stroke:"4.4"})]))]),_:1}),a(k)?(s(),u(B,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(k)},null,8,Ce)]),_:1})):m("",!0),a(h)?(s(),u(B,{key:1,class:"pageOutput-info-body",caption1:"",bold:"",center:""},{default:e(()=>[G("span",{innerHTML:a(h)},null,8,$e)]),_:1})):m("",!0),t(w,{class:"pageOutput-info-edit",link:"",xsmall:"","no-padding":"",onClick:I},{default:e(()=>[t(r,{name:"edit",size:"16"}),o[0]||(o[0]=O(" プロンプトを変更 "))]),_:1})]),_:1})),t(Z,{class:"pageOutput-list",gap:"2",split:H},{default:e(()=>[(s(),U(oe,null,se(p,f=>t(X,{key:`pageOutput-item-${f}`},{default:e(()=>[a(l)[f-1]?(s(),u(T,{key:0,class:"pageOutput-img",onClick:Ee=>F(f-1)},{default:e(()=>[t(K,{src:a(l)[f-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):(s(),u(W,{key:1,w:"100%",h:"100%",animation:"",delay:f/H*150},null,8,["delay"]))]),_:2},1024)),64))]),_:1}),a(C)?(s(),u(g,{key:2,justify:"center",gap:"40"},{default:e(()=>[t(x,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(D,null,{default:e(()=>[t(g,{justify:"stretch",gap:"20"},{default:e(()=>[t(w,{onClick:q},{default:e(()=>o[1]||(o[1]=[O(" 設定を変更してやり直す ")])),_:1}),t(w,{info:"",onClick:Y},{default:e(()=>o[2]||(o[2]=[O(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):m("",!0)]),_:1})]),_:1})}}});export{Me as default};
