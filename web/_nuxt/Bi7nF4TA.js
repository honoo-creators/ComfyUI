import{d as ge,aK as ve,x as c,h as B,P as he,o as ke,az as W,aU as ye,X as we,a5 as m,f as n,g as E,z as e,w as t,F as D,G as Y,Y as a,l as h,i as s,ag as Ce,A as k,p as $e,aM as J,a0 as M,n as U,c as T,e as Ee,aJ as Te,D as Ie,a2 as be,t as Re,U as Oe,E as Pe,V as Ne,aL as Se,B as K,at as ze,a8 as Le,_ as Be,a6 as De,R as Me}from"./tT-4R-vW.js";import{_ as Ue}from"./D2QfYuTx.js";import{_ as Ae}from"./jYvHtS4K.js";import{_ as je}from"./vp9RTVMm.js";import{_ as Ge}from"./4shpeVe9.js";import{_ as qe}from"./ak1wmHqI.js";const xe=1e3,I=3,X=99,Ke=ge({__name:"output",setup(Ve){const{isQueue:y,output:Z,isInitQueue:b,progress:R}=m(),u=ve(),O=c(null),ee=c(0),te=c(0),ae=c(!1),p=c(!1),i=c([]),A=c(!1),j=c("Starting."),P=c(-1),_=c(!1);let N=1,S;const w=B(()=>i.value.length===X),ne=B(()=>!b.value&&(R.value>=0||i.value.length>0)?!0:b.value),G=B(()=>u.imageHeight/u.imageWidth*100),oe=async()=>{await M().open({name:"prompt"})||(y.value&&m().postInterrupt(),m().queueClear(),ee.value=0,te.value=0,ae.value=!1,i.value=[],await W(),await u.setWorkflow(),u.incrementRetryCount(),C())},se=()=>{u.incrementRetryCount(),U(T().GENERATE_UPLOAD)},le=()=>{u.init(),U(T().GENERATE_LOOKSTYLE)},ie=async o=>{_.value=!0,await M().open({name:"upscaleSelect",options:{src:i.value[o]}}),_.value=!1,z()},ue=o=>{i.value.splice(o,1)},re=async()=>{const o=await M().open({name:"uploadImage"});o&&o.base64&&o.file&&(u.continue(o.base64,o.file),U(T().GENERATE_CONFIRM))},q=()=>{i.value=[],Ee().replace(T().dashboard())},ce=async o=>{await ze().open({name:"imagePreview",options:{index:o,list:i.value,onDownloadStart:()=>_.value=!0,onDownloadEnd:()=>_.value=!1}}),y.value||z()},C=async()=>{w.value||p.value||(y.value?(await Te().wait(xe),C()):(p.value=!1,m().queuePrompt({json:JSON.stringify(u.workflow),batchCount:X-i.value.length})))},me=()=>{p.value=!0,m().postInterrupt(),m().queueClear()},z=()=>{p.value=!1,C()};return he(()=>Z.value,o=>{if(!_.value&&o&&o.length>0){const l=o[o.length-1];l.includes("upscale")||i.value.push(l),O.value&&O.value.scrollIntoView({behavior:"smooth",block:"end"})}},{deep:!0}),ke(async()=>{await W(),C(),S=ye(()=>{N=N%3+1,j.value=" Starting "+".".repeat(N)},1e3),A.value=!0}),we(()=>{y.value&&m().postInterrupt(),m().queueClear(),S!==null&&clearInterval(S)}),(o,l)=>{const pe=Le,x=Ue,d=Ie,r=be,L=Re,$=Oe,V=Ae,F=Be,g=Pe,fe=De,_e=Me,H=Ne,de=je;return n(),E("div",{ref_key:"element",ref:O,class:"pageOutput",full:""},[e(L,{gap:[8,28],split:I},{default:t(()=>[(n(!0),E(D,null,Y(a(i),(f,v)=>(n(),s($,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(x,{per:a(G)},{default:t(()=>[e(Se,{onClick:Q=>ce(v)},{default:t(()=>[e(pe,{src:f,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(L,{justify:"center",gap:"20"},{default:t(()=>[e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:Q=>ie(v)},{default:t(()=>[e(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:Q=>ue(v)},{default:t(()=>[e(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(w)?h("",!0):(n(!0),E(D,{key:0},Y(I-a(i).length%I,f=>(n(),s(x,{key:`pageOutput-item-${f}`,class:"pageOutput-img",per:a(G)},{default:t(()=>[f===1?(n(),s(g,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"",onMouseover:v=>P.value=f,onMouseleave:l[0]||(l[0]=v=>P.value=-1)},{default:t(()=>[e(V,{w:"100%",h:"100%",animation:""}),a(_)?h("",!0):(n(),s(g,{key:0,absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[a(b)&&a(R)>0?(n(),s(F,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[k(K(Math.round(a(R)*100))+"% ",1)]),_:1})):(n(),s(F,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[k(K(a(j)),1)]),_:1}))]),_:1})),e(_e,{duration:"100"},{default:t(()=>[a(P)===f||a(p)?(n(),s(g,{key:0,absolute:"",top:"0",left:"0",w:"100%",h:"100%"},{default:t(()=>[e(fe,null,{default:t(()=>[a(p)?(n(),s(r,{key:1,link:"",onClick:z},{default:t(()=>[e(d,{name:"play",size:"20"})]),_:1})):(n(),s(r,{key:0,link:"",onClick:me},{default:t(()=>[e(d,{name:"pause",size:"20"})]),_:1}))]),_:1})]),_:1})):h("",!0)]),_:2},1024)]),_:2},1032,["onMouseover"])):(n(),s(V,{key:1,w:"100%",h:"100%",animation:!a(ne),delay:f/I*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(g,{h:"36"}),a(w)?(n(),s($,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Ce,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(H,null,{default:t(()=>[e($,{justify:"stretch",gap:"20"},{default:t(()=>[e(r,{onClick:se},{default:t(()=>l[1]||(l[1]=[k(" 内容を変更してやり直す ")])),_:1}),e(r,{info:"",onClick:le},{default:t(()=>l[2]||(l[2]=[k(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),e(de,null,{default:t(()=>[!a(w)&&a(p)?(n(),s(H,{key:0},{default:t(()=>[e($,{justify:"center"},{default:t(()=>[e(r,{info:"",onClick:re},{default:t(()=>l[3]||(l[3]=[k(" 続けて他の原図を生成する ")])),_:1}),e(g,{h:"0"}),e(r,{minimal:"",onClick:q},{default:t(()=>l[4]||(l[4]=[k(" 終了する ")])),_:1})]),_:1})]),_:1})):h("",!0)]),_:1}),a(A)?(n(),E(D,{key:1},[(n(),s(J,{to:"#headerWideCenter"},[e(L,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(qe,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(Ge,{class:$e(["headerPrompt-list-inner",{_empty:a(u).prompt.length===0}]),name:"プロンプト",data:a(u).prompt},null,8,["class","data"])]),_:1}),e(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(r,{w:"100%",h:"100%",info:"",onClick:oe},{default:t(()=>[e(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(J,{to:"#headerWideRightEnd"},[e(r,{class:"headerEndBtn",link:"",xsmall:"",onClick:q},{default:t(()=>[e(d,{name:"cross",size:"20"})]),_:1})]))],64)):h("",!0)],512)}}});export{Ke as default};
