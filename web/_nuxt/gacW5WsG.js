import{ab as y,ak as a,aJ as r,c as E,a as d,w as u,G as k,o as A,aB as h,b as L,d as M,b6 as T,bh as m,k as G,bi as S}from"./Dc-E6pfJ.js";const x=1565,w=3819,C=[{id:1556,type:"CLIPTextEncode",pos:{0:-384.56561279296875,1:723.5852661132812},size:{0:210,1:70},flags:{collapsed:!1},order:9,mode:0,inputs:[{name:"clip",type:"CLIP",link:3791},{name:"text",type:"STRING",link:3793,widget:{name:"text"}}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[3795,3810],slot_index:0,shape:3}],properties:{"Node name for S&R":"CLIPTextEncode"},widgets_values:["(Accordion cable:1.4). (mechanical details:1.5), (outlines:1.2),  fog, photorealism, worst quality, (trees, plants, green, grass:1.3), text, watermark, nude"],color:"#232",bgcolor:"#353",shape:1},{id:1565,type:"VAEDecode",pos:{0:255.43438720703125,1:603.5852661132812},size:{0:210,1:50},flags:{collapsed:!1},order:13,mode:0,inputs:[{name:"samples",type:"LATENT",link:3806},{name:"vae",type:"VAE",link:3819}],outputs:[{name:"IMAGE",type:"IMAGE",links:[3807],slot_index:0,shape:3}],properties:{"Node name for S&R":"VAEDecode"},widgets_values:[],color:"#223",bgcolor:"#335",shape:1},{id:1552,type:"KSampler",pos:{0:-104.5655746459961,1:613.5852661132812},size:{0:320,1:474},flags:{},order:12,mode:0,inputs:[{name:"model",type:"MODEL",link:3789},{name:"positive",type:"CONDITIONING",link:3794},{name:"negative",type:"CONDITIONING",link:3795},{name:"latent_image",type:"LATENT",link:3805}],outputs:[{name:"LATENT",type:"LATENT",links:[3806],slot_index:0}],properties:{"Node name for S&R":"KSampler"},widgets_values:[783387352776393,"randomize",40,7,"euler_ancestral","karras",.02]},{id:1554,type:"CR Prompt Text",pos:{0:-694.565673828125,1:603.5852661132812},size:{0:260,1:96},flags:{},order:0,mode:0,inputs:[],outputs:[{name:"prompt",type:"STRING",links:[3792],slot_index:0,shape:3},{name:"show_help",type:"STRING",links:null,shape:3}],title:"Positive Prompt",properties:{"Node name for S&R":"CR Prompt Text"},widgets_values:[""],color:"#232",bgcolor:"#353",shape:1},{id:1555,type:"CLIPTextEncode",pos:{0:-384.56561279296875,1:583.5852661132812},size:{0:210,1:80},flags:{collapsed:!1},order:8,mode:0,inputs:[{name:"clip",type:"CLIP",link:3790},{name:"text",type:"STRING",link:3792,widget:{name:"text"}}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[3794,3809],slot_index:0,shape:3}],properties:{"Node name for S&R":"CLIPTextEncode"},widgets_values:["(Accordion cable:1.4). (mechanical details:1.5), (outlines:1.2),  fog, photorealism, worst quality, (trees, plants, green, grass:1.3), text, watermark, nude"],color:"#232",bgcolor:"#353",shape:1},{id:1553,type:"CR Prompt Text",pos:{0:-684.565673828125,1:753.5852661132812},size:{0:260,1:100},flags:{},order:1,mode:0,inputs:[],outputs:[{name:"prompt",type:"STRING",links:[3793],slot_index:0,shape:3},{name:"show_help",type:"STRING",links:null,shape:3}],title:"Negative Prompt",properties:{"Node name for S&R":"CR Prompt Text"},widgets_values:[""],color:"#232",bgcolor:"#353",shape:1},{id:1198,type:"CLIPSetLastLayer",pos:{0:-674.565673828125,1:473.5853271484375},size:{0:240,1:60},flags:{},order:6,mode:0,inputs:[{name:"clip",type:"CLIP",link:3693}],outputs:[{name:"CLIP",type:"CLIP",links:[3790,3791],slot_index:0,shape:3}],properties:{"Node name for S&R":"CLIPSetLastLayer"},widgets_values:[-1],color:"#232",bgcolor:"#353",shape:1},{id:639,type:"VAELoader",pos:{0:-1124.5653076171875,1:643.5852661132812},size:{0:370,1:60},flags:{},order:2,mode:0,inputs:[],outputs:[{name:"VAE",type:"VAE",links:[3785,3804,3819],slot_index:0,shape:3}],properties:{"Node name for S&R":"VAELoader"},widgets_values:["sdxl_vae.safetensors"],color:"#232",bgcolor:"#353",shape:1},{id:794,type:"CheckpointLoaderSimple",pos:{0:-1124.5653076171875,1:483.58526611328125},size:{0:370,1:100},flags:{},order:3,mode:0,inputs:[],outputs:[{name:"MODEL",type:"MODEL",links:[3789,3808],slot_index:0,shape:3},{name:"CLIP",type:"CLIP",links:[3693],slot_index:1,shape:3},{name:"VAE",type:"VAE",links:[],slot_index:2,shape:3}],properties:{"Node name for S&R":"CheckpointLoaderSimple"},widgets_values:["HONOO-anime-BG_01_.safetensors"],color:"#232",bgcolor:"#353",shape:1},{id:1562,type:"DF_Image_scale_to_side",pos:{0:-918.1722412109375,1:1217.9945068359375},size:{0:260,1:130},flags:{collapsed:!1},order:7,mode:0,inputs:[{name:"image",type:"IMAGE",link:3802}],outputs:[{name:"IMAGE",type:"IMAGE",links:[3796],slot_index:0,shape:3}],properties:{"Node name for S&R":"DF_Image_scale_to_side"},widgets_values:[1216,"Longest","nearest-exact","disabled"],color:"#323",bgcolor:"#535",shape:1},{id:1559,type:"VAEEncode",pos:{0:-628.1723022460938,1:1217.9945068359375},size:{0:210,1:50},flags:{collapsed:!1},order:10,mode:0,inputs:[{name:"pixels",type:"IMAGE",link:3796},{name:"vae",type:"VAE",link:3804}],outputs:[{name:"LATENT",type:"LATENT",links:[3803],slot_index:0,shape:3}],properties:{"Node name for S&R":"VAEEncode"},widgets_values:[],color:"#323",bgcolor:"#535",shape:1},{id:1557,type:"PrimitiveNode",pos:{0:-908.1722412109375,1:1417.9945068359375},size:{0:210,1:82},flags:{},order:4,mode:0,inputs:[],outputs:[{name:"INT",type:"INT",links:[3801],slot_index:0,widget:{name:"batch_size"}}],title:"Batch size（描画数）",properties:{"Run widget replace on values":!1},widgets_values:[1,"fixed"],color:"#323",bgcolor:"#535",shape:1},{id:1561,type:"CR Latent Batch Size",pos:{0:-388.1724853515625,1:1217.9945068359375},size:{0:210,1:60},flags:{collapsed:!1},order:11,mode:0,inputs:[{name:"latent",type:"LATENT",link:3803},{name:"batch_size",type:"INT",link:3801,widget:{name:"batch_size"}}],outputs:[{name:"LATENT",type:"LATENT",links:[3805],slot_index:0,shape:3}],properties:{"Node name for S&R":"CR Latent Batch Size"},widgets_values:[1],color:"#323",bgcolor:"#535",shape:1},{id:312,type:"SaveImage",pos:{0:1250,1:470},size:{0:1430,1:1490},flags:{},order:16,mode:0,inputs:[{name:"images",type:"IMAGE",link:3818}],outputs:[],properties:{"Node name for S&R":"SaveImage"},widgets_values:["upscale/us"],color:"#322",bgcolor:"#533",shape:1},{id:465,type:"workflow>Ultimate SD Upscale with Model",pos:{0:540.8002319335938,1:475.005615234375},size:{0:320,1:830},flags:{},order:14,mode:0,inputs:[{name:"image",type:"IMAGE",link:3807},{name:"model",type:"MODEL",link:3808},{name:"positive",type:"CONDITIONING",link:3809},{name:"negative",type:"CONDITIONING",link:3810},{name:"vae",type:"VAE",link:3785}],outputs:[{name:"IMAGE",type:"IMAGE",links:[2843],slot_index:0,shape:3}],properties:{"Node name for S&R":"workflow/Ultimate SD Upscale with Model"},widgets_values:["4x_IllustrationJaNai_V1_ESRGAN_135k.pth",1,0x3d9223ae386bc,"randomize",40,7,"euler_ancestral","exponential",.02,"Linear",1216,1216,8,32,"None",.5,64,8,16,!1,!1],color:"#322",bgcolor:"#533",shape:1},{id:467,type:"workflow>2nd Upscale",pos:{0:900.80029296875,1:475.005615234375},size:{0:320,1:110},flags:{},order:15,mode:0,inputs:[{name:"image",type:"IMAGE",link:2843}],outputs:[{name:"IMAGE",type:"IMAGE",links:[3818],slot_index:0,shape:3}],properties:{"Node name for S&R":"workflow/2nd Upscale"},widgets_values:["4x_NickelbackFS_72000_G.pth","nearest-exact",2],color:"#322",bgcolor:"#533",shape:1},{id:1558,type:"LoadImage",pos:{0:-1320.563232421875,1:1225.5181884765625},size:{0:370,1:550},flags:{pinned:!1},order:5,mode:0,inputs:[],outputs:[{name:"IMAGE",type:"IMAGE",links:[3802],slot_index:0,shape:3},{name:"MASK",type:"MASK",links:[],slot_index:1,shape:3}],title:"Img2Img",properties:{"Node name for S&R":"LoadImage_i2i"},widgets_values:[".DS_Store","image"],color:"#323",bgcolor:"#535",shape:1}],O=[[2843,465,0,467,0,"IMAGE"],[3693,794,1,1198,0,"CLIP"],[3785,639,0,465,4,"VAE"],[3789,794,0,1552,0,"MODEL"],[3790,1198,0,1555,0,"CLIP"],[3791,1198,0,1556,0,"CLIP"],[3792,1554,0,1555,1,"STRING"],[3793,1553,0,1556,1,"STRING"],[3794,1555,0,1552,1,"CONDITIONING"],[3795,1556,0,1552,2,"CONDITIONING"],[3796,1562,0,1559,0,"IMAGE"],[3801,1557,0,1561,1,"INT"],[3802,1558,0,1562,0,"IMAGE"],[3803,1559,0,1561,0,"LATENT"],[3804,639,0,1559,1,"VAE"],[3805,1561,0,1552,3,"LATENT"],[3806,1552,0,1565,0,"LATENT"],[3807,1565,0,465,0,"IMAGE"],[3808,794,0,465,1,"MODEL"],[3809,1555,0,465,2,"CONDITIONING"],[3810,1556,0,465,3,"CONDITIONING"],[3818,467,0,312,0,"IMAGE"],[3819,639,0,1565,1,"VAE"]],v=[{title:"Upscale（画像のアップスケール）",bounding:[531,397,2160,1574],color:"#b0b0b0",font_size:24,flags:{}},{title:"KSampler（描画）",bounding:[-1135,400,1610,694],color:"#b0b0b0",font_size:24,flags:{}},{title:"Group",bounding:[-1331,1144,1162,641],color:"#3f789e",font_size:24,flags:{}}],D={},b={ds:{scale:.6884904623031617,offset:[-78.88635766654626,-106.62371621341043]},groupNodes:{"Ultimate SD Upscale with Model":{nodes:[{type:"UpscaleModelLoader",pos:[2590,270],size:{0:310,1:60},flags:{},order:23,mode:0,outputs:[{name:"UPSCALE_MODEL",type:"UPSCALE_MODEL",links:[],shape:3,slot_index:0}],properties:{"Node name for S&R":"UpscaleModelLoader"},widgets_values:["4x_NickelbackFS_72000_G.pth"],color:"#322",bgcolor:"#533",shape:1,index:0,inputs:[]},{type:"UltimateSDUpscale",pos:[2589.5446438004788,370],size:{0:310,1:614},flags:{},order:37,mode:0,inputs:[{name:"image",type:"IMAGE",link:null},{name:"model",type:"MODEL",link:null},{name:"positive",type:"CONDITIONING",link:null},{name:"negative",type:"CONDITIONING",link:null},{name:"vae",type:"VAE",link:null},{name:"upscale_model",type:"UPSCALE_MODEL",link:null}],outputs:[{name:"IMAGE",type:"IMAGE",links:[],shape:3,slot_index:0}],properties:{"Node name for S&R":"UltimateSDUpscale"},widgets_values:[2,0x3de8d4858c29b,"randomize",30,8,"dpmpp_2m_sde_gpu","karras",.05,"Linear",1024,1024,8,32,"None",.5,64,8,16,!1,!1],color:"#322",bgcolor:"#533",shape:1,index:1}],links:[[null,5,1,0,134,"IMAGE"],[null,0,1,1,134,"MODEL"],[null,1,1,2,134,"CONDITIONING"],[null,2,1,3,134,"CONDITIONING"],[null,4,1,4,134,"VAE"],[0,0,1,5,375,"UPSCALE_MODEL"]],external:[[1,0,"IMAGE"]]},"2nd Upscale":{nodes:[{type:"UpscaleModelLoader",pos:[2930,260],size:{0:279.5331115722656,1:71.67201232910156},flags:{collapsed:!1},order:22,mode:0,outputs:[{name:"UPSCALE_MODEL",type:"UPSCALE_MODEL",links:[],shape:3,slot_index:0}],properties:{"Node name for S&R":"UpscaleModelLoader"},widgets_values:["4x_NMKD-Siax_200k.pth"],color:"#322",bgcolor:"#533",shape:1,index:0,inputs:[]},{type:"ImageUpscaleWithModel",pos:[2930,402.33331298828125],size:{0:280.7541198730469,1:56.27325439453125},flags:{collapsed:!1},order:37,mode:0,inputs:[{name:"upscale_model",type:"UPSCALE_MODEL",link:null,slot_index:0},{name:"image",type:"IMAGE",link:null}],outputs:[{name:"IMAGE",type:"IMAGE",links:[],shape:3,slot_index:0}],properties:{"Node name for S&R":"ImageUpscaleWithModel"},color:"#322",bgcolor:"#533",shape:1,index:1},{type:"ImageScaleBy",pos:[2930,510],size:{0:280,1:82},flags:{},order:38,mode:0,inputs:[{name:"image",type:"IMAGE",link:null}],outputs:[{name:"IMAGE",type:"IMAGE",links:[],shape:3,slot_index:0}],properties:{"Node name for S&R":"ImageScaleBy"},widgets_values:["nearest-exact",.5],color:"#322",bgcolor:"#533",shape:1,index:2}],links:[[0,0,1,0,372,"UPSCALE_MODEL"],[null,0,1,1,465,"IMAGE"],[1,0,2,0,371,"IMAGE"]],external:[[2,0,"IMAGE"]]}}},U=.4,R={last_node_id:x,last_link_id:w,nodes:C,links:O,groups:v,config:D,extra:b,version:U},z={class:"pageDevComfyUITestUpscale"},l=3,B=y({__name:"test-upscale",setup(P){const o=G(),I=T(),c=a(0),t=a(0),g=a(""),n=a(!1);r(()=>o.output.value,async e=>{console.log("comfyUI.output:",e,"count:",t.value,"MAX_COUNT:",l,"isDownloaded:",n.value),t.value===l&&!n.value&&(await S().download(e[0],g.value),n.value=!0,m().close(),close())},{immediate:!0,deep:!0}),r(()=>o.progress.value,async e=>{const s=Math.round(e/l*100+t.value*(100/l));c.value=Math.min(s,100),e>=1&&t.value++},{immediate:!0,deep:!0});const _=async()=>{const e=await I.select(["image"]);if(e){m().open({message:"Now Upscaling...",spinner:!0});const s=e.file,i=new File([s],`${s.name.split(".")[0]}_upscale.${s.name.split(".")[1]}.png`,{type:s.type}),{name:p}=await o.upload.image(i),N=o.workflow.replaceLoadImage(R,p);o.queuePrompt({json:JSON.stringify(N)}),r(()=>c.value,async f=>{m().update({message:`${f}%`,spinner:!0})},{immediate:!0,deep:!0})}};return(e,s)=>{const i=L,p=k;return A(),E("div",z,[d(p,{justify:"center",align:"center",gap:"40"},{default:u(()=>[d(h,{icon:"shaps",title:"Test Upscale",body:"ComfyUI のアップスケールワークフローをテストします。"}),d(i,{w:"160",onClick:_},{default:u(()=>s[0]||(s[0]=[M(" Test ")])),_:1})]),_:1})])}}});export{B as default};
