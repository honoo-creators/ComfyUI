import{d as re,aE as le,x as k,h as b,P as q,o as ie,ar as x,X as ue,a5 as g,f as n,i as o,w as t,z as a,Y as e,m as Q,aF as F,l as u,g as L,k as Y,p as ce,G as W,F as R,A as O,aG as pe,a0 as me,n as J,c as K,aD as X,D as fe,au as _e,E as de,_ as ge,U as he,t as ye,a2 as ve,V as ke,B as we,al as Ce,$ as $e,as as Pe}from"./CVjm8Pq9.js";import{_ as Te}from"./B7cQzEF0.js";import{_ as Ee}from"./CmMSoR0i.js";import{_ as Z}from"./kcRfV08M.js";import{_ as be}from"./BRW9EF2_.js";const Le={key:1,class:"pageOutput-info-spinner"},Oe=["innerHTML"],De=["innerHTML"],Me=1e3,ee=4,h=40,Ae=re({__name:"output",setup(Se){const{isQueue:D,output:te,isInitQueue:U,progress:w}=g(),r=le(),I=k(0),f=k(0),_=k(!1),l=k([]),N=k(!1),M=b(()=>`${l.value.length}/${h}`),S=b(()=>{if(l.value.length===h)return"背景美術を生成しました。";const s=Math.floor(f.value/36e5),i=Math.floor(f.value%36e5/6e4),c=Math.floor(f.value%6e4/1e3);let p="";return s>0&&(p+=`${s}時間`),i>0&&(p+=`${i}分`),p+=`${c}秒`,$.value?`あと ${p}`:"AI Starting Up..."}),C=b(()=>l.value.length===h),$=b(()=>!U.value&&(w.value>=0&&w.value<1||l.value.length>0)?!0:U.value),A=async()=>{await me().open({name:"prompt"})||(D.value&&g().postInterrupt(),g().queueClear(),l.value=[],await x(),await r.setWorkflow(),r.incrementRetryCount(),P())},ae=()=>{r.incrementRetryCount(),J(K().GENERATE_UPLOAD)},ne=()=>{r.init(),J(K().GENERATE_LOOKSTYLE)},j=async()=>{if(_.value)return;const s=1e3;await X().wait(s),f.value-=s,f.value>=0?j():f.value=0},se=s=>{Ce().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadEnd:()=>z()}})},P=async()=>{C.value||_.value||(D.value?(await X().wait(Me),P()):(_.value=!1,g().queuePrompt({json:JSON.stringify(r.workflow),batchCount:h-l.value.length}),j()))},z=()=>{_.value=!1,P()};return q(()=>te.value,s=>{s&&s.length>0&&l.value.push(s[s.length-1].replace("http://127.0.0.1:8188",$e().public.BASE_URL))},{deep:!0}),q(()=>w.value,(s,i)=>{const c=Date.now();if(i!==void 0&&s>i){const p=s-i,v=(c-I.value)/p,d=1-s,B=v*d;f.value=B*(h-l.value.length)}I.value=c},{immediate:!0}),ie(async()=>{await x(),P(),N.value=!0}),ue(()=>{D.value&&g().postInterrupt(),g().queueClear()}),(s,i)=>{const c=fe,p=_e,y=de,v=ge,d=he,B=Pe,G=Te,oe=Ee,T=ye,E=ve,H=ke;return n(),o(H,{class:"pageOutput",wide:""},{default:t(()=>[a(d,{gap:"36"},{default:t(()=>[e(C)?(n(),o(Z,Q({key:0},{title:e(M),body:e(S)},{icon:"shine"}),null,16)):(n(),o(d,{key:1,class:"pageOutput-info",justify:"center",gap:"24"},{default:t(()=>[a(y,{w:"48",h:"48",mt:"20",relative:""},{default:t(()=>[e(_)?(n(),o(F,{key:0,onClick:z},{default:t(()=>[a(c,{name:"play",size:"44"})]),_:1})):u("",!0),e(_)?u("",!0):(n(),L("div",Le,[a(p,{size:"48",stroke:"4.4"})]))]),_:1}),e(M)?(n(),o(v,{key:0,class:"pageOutput-info-title",title2:"",extrabold:"",center:""},{default:t(()=>[Y("span",{innerHTML:e(M)},null,8,Oe)]),_:1})):u("",!0),e(S)?(n(),o(v,{key:1,class:ce(["pageOutput-info-body",{_animation:!e($)}]),caption1:"",bold:"",center:""},{default:t(()=>[Y("span",{innerHTML:e(S)},null,8,De)]),_:1},8,["class"])):u("",!0)]),_:1})),a(T,{gap:"8",split:ee},{default:t(()=>[(n(),L(R,null,W(h,m=>a(oe,{key:`pageOutput-item-${m}`,class:"pageOutput-img"},{default:t(()=>[e(l)[m-1]?(n(),o(F,{key:0,onClick:V=>se(m-1)},{default:t(()=>[a(B,{src:e(l)[m-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):u("",!0),e($)&&!e(C)&&m-1===e(l).length?(n(),o(y,{key:1,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:""},{default:t(()=>[a(G,{w:"100%",h:"100%",animation:""}),a(y,{absolute:"",top:"8",left:"8",color:"dark",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[a(v,{callout:"",bold:"",color:"light","baseline-height":""},{default:t(()=>[O(we(Math.round(e(w)*100))+"% ",1)]),_:1})]),_:1})]),_:1})):(n(),o(G,{key:2,w:"100%",h:"100%",animation:!e($),delay:m/ee*150},null,8,["animation","delay"]))]),_:2},1024)),64))]),_:1}),e(C)?(n(),o(d,{key:2,justify:"center",gap:"40"},{default:t(()=>[a(Z,{icon:"checkCircleLine",body:"生成画像は以上です"}),a(H,null,{default:t(()=>[a(d,{justify:"stretch",gap:"20"},{default:t(()=>[a(E,{onClick:ae},{default:t(()=>i[0]||(i[0]=[O(" 設定を変更してやり直す ")])),_:1}),a(E,{info:"",onClick:ne},{default:t(()=>i[1]||(i[1]=[O(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):u("",!0)]),_:1}),e(N)?(n(),o(pe,{key:0,to:"#headerWideCenter"},[e(r).prompt&&e(r).prompt.length>0?(n(),o(T,{key:0,class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[a(T,{class:"headerPrompt-list",align:"center",gap:"2",fit:""},{default:t(()=>[(n(!0),L(R,null,W(e(r).prompt,(m,V)=>(n(),o(be,Q({key:`headerPrompt-item-${V}`,ref_for:!0},{text:m}),null,16))),128))]),_:1}),a(y,{class:"headerPrompt-btn",w:"40","min-w":"40",h:"40","min-h":"40"},{default:t(()=>[a(E,{class:"headerPrompt-btn-inner",w:"100%",h:"100%",onClick:A},{default:t(()=>[a(c,{name:"edit",size:"16",color:"light"})]),_:1})]),_:1})]),_:1})):!e(r).prompt||!e(r).prompt.length?(n(),o(T,{key:1,class:"headerPromptEmpty",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[a(E,{xsmall:"",rounded:"",w:"160",onClick:A},{default:t(()=>[a(c,{name:"edit",size:"16",color:"light"}),!e(r).prompt||!e(r).prompt.length?(n(),L(R,{key:0},[O(" プロンプトを設定する ")],64)):u("",!0)]),_:1})]),_:1})):u("",!0)])):u("",!0)]),_:1})}}});export{Ae as default};
