import{d as ye,aK as we,x as u,h as $,P as Ce,o as $e,aU as Ee,X as Te,f as n,g as E,z as e,w as t,F as D,G as X,Y as a,l as v,i as s,ag as be,A as k,k as Ie,p as ze,aM as Z,a0 as M,a5 as m,az as ee,n as j,c as T,e as Oe,aJ as te,D as Re,a2 as Ne,t as Pe,U as Se,E as Be,V as Le,aL as Ue,B as ae,at as De,a8 as Me,a6 as je,R as xe,_ as Ae}from"./CQvh_919.js";import{_ as Ge}from"./0qaB1g5_.js";import{_ as Ve}from"./D94_Zr88.js";import{_ as Qe}from"./mq0OmvMl.js";import{_ as qe}from"./BKvXmL74.js";import{_ as Fe}from"./CIJ2CgOz.js";const He={class:"pageOutput",full:""},We=1e3,b=3,ne=99,at=ye({__name:"output",setup(Ye){const{isQueue:I,output:oe,isInitQueue:z,progress:O,previewImageUrl:x}=m(),c=we(),R=u(null),se=u(0),le=u(0),ie=u(!1),p=u(!1),i=u([]),A=u(!1),G=u("Starting."),N=u(-1),d=u(!1);let P=1,S;const y=$(()=>i.value.length===ne),re=$(()=>!z.value&&(O.value>=0||i.value.length>0)?!0:z.value),V=$(()=>c.imageHeight/c.imageWidth*100),Q=$(()=>c.prompt),ue=async()=>{await M().open({name:"prompt"})||(I.value&&m().postInterrupt(),m().queueClear(),m().historyClear(),se.value=0,le.value=0,ie.value=!1,i.value=[],await ee(),await c.setWorkflow(),c.incrementRetryCount(),w())},ce=()=>{c.incrementRetryCount(),j(T().GENERATE_UPLOAD)},me=()=>{c.init(),j(T().GENERATE_LOOKSTYLE)},pe=async o=>{d.value=!0,await M().open({name:"upscaleSelect",options:{src:i.value[o]}}),d.value=!1,B()},_e=o=>{i.value.splice(o,1)},fe=async()=>{const o=await M().open({name:"uploadImage"});o&&o.base64&&o.file&&(c.continue(o.base64,o.file),j(T().GENERATE_CONFIRM))},q=()=>{i.value=[],Oe().replace(T().dashboard())},de=async o=>{await De().open({name:"imagePreview",options:{index:o,list:i.value,onDownloadStart:()=>d.value=!0,onDownloadEnd:()=>d.value=!1}}),I.value||B()},w=async()=>{y.value||p.value||(I.value?(await te().wait(We),w()):(p.value=!1,m().queuePrompt({json:JSON.stringify(c.workflow),batchCount:ne-i.value.length})))},ge=()=>{p.value=!0,L()},B=()=>{p.value=!1,w()},L=()=>{m().postInterrupt(),m().queueClear(),m().historyClear()};return Ce(()=>oe.value,async o=>{if(!d.value&&o&&o.length>0){const l=o[o.length-1];l.includes("upscale")||i.value.push(l),R.value&&(await ee(),await te().wait(250),R.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),$e(async()=>{L(),w(),S=Ee(()=>{P=P%3+1,G.value=" Starting "+".".repeat(P)},1e3),A.value=!0}),Te(()=>{L(),S!==null&&clearInterval(S)}),(o,l)=>{const F=Me,H=Ge,g=Re,r=Ne,U=Pe,C=Se,W=Ve,he=je,_=Be,ve=xe,Y=Ae,J=Le,ke=Qe;return n(),E("div",He,[e(U,{justify:"center",gap:[8,28],split:b},{default:t(()=>[(n(!0),E(D,null,X(a(i),(f,h)=>(n(),s(C,{key:`pageOutput-item-generate-${h}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(H,{per:a(V)},{default:t(()=>[e(Ue,{onClick:K=>de(h)},{default:t(()=>[e(F,{src:f,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(U,{justify:"center",gap:"20"},{default:t(()=>[e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:K=>pe(h)},{default:t(()=>[e(g,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:K=>_e(h)},{default:t(()=>[e(g,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(y)?v("",!0):(n(!0),E(D,{key:0},X(b-a(i).length%b,f=>(n(),s(H,{key:`pageOutput-item-${f}`,class:"pageOutput-img",per:a(V)},{default:t(()=>[f===1?(n(),s(_,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:h=>N.value=f,onMouseleave:l[0]||(l[0]=h=>N.value=-1)},{default:t(()=>[a(x)?(n(),s(F,{key:1,src:a(x),cover:""},null,8,["src"])):(n(),s(W,{key:0,w:"100%",h:"100%",animation:""})),e(ve,{duration:"100"},{default:t(()=>[a(N)===f||a(p)?(n(),s(_,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(he,null,{default:t(()=>[a(p)?(n(),s(r,{key:1,link:"",onClick:B},{default:t(()=>[e(g,{name:"play",size:"20",color:"light"})]),_:1})):(n(),s(r,{key:0,link:"",onClick:ge},{default:t(()=>[e(g,{name:"pause",size:"20",color:"light"})]),_:1}))]),_:1})]),_:1})):v("",!0)]),_:2},1024),a(d)?v("",!0):(n(),s(_,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(z)&&a(O)>0?(n(),s(Y,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[k(ae(Math.round(a(O)*100))+"% ",1)]),_:1})):(n(),s(Y,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[k(ae(a(G)),1)]),_:1}))]),_:1}))]),_:2},1032,["onMouseover"])):(n(),s(W,{key:1,w:"100%",h:"100%",animation:!a(re),delay:f/b*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(_,{h:"20"}),a(y)?(n(),s(C,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(be,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(J,null,{default:t(()=>[e(C,{justify:"stretch",gap:"20"},{default:t(()=>[e(r,{onClick:ce},{default:t(()=>l[1]||(l[1]=[k(" 内容を変更してやり直す ")])),_:1}),e(r,{info:"",onClick:me},{default:t(()=>l[2]||(l[2]=[k(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):v("",!0),e(ke,null,{default:t(()=>[!a(y)&&a(p)?(n(),s(J,{key:0},{default:t(()=>[e(C,{justify:"center"},{default:t(()=>[e(r,{info:"",onClick:fe},{default:t(()=>l[3]||(l[3]=[k(" 続けて他の原図を生成する ")])),_:1}),e(_,{h:"0"}),e(r,{minimal:"",onClick:q},{default:t(()=>l[4]||(l[4]=[k(" 終了する ")])),_:1}),e(_,{h:"40"})]),_:1})]),_:1})):v("",!0)]),_:1}),Ie("div",{ref_key:"element",ref:R,class:"pageOutput-scrollTarget"},null,512),a(A)?(n(),E(D,{key:1},[(n(),s(Z,{to:"#headerWideCenter"},[e(U,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Fe,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:t(()=>[e(qe,{class:ze(["headerPrompt-list-inner",{_empty:a(Q).length===0}]),name:"プロンプト",data:a(Q),more:""},null,8,["class","data"])]),_:1}),e(_,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(r,{w:"100%",h:"100%",info:"",onClick:ue},{default:t(()=>[e(g,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(Z,{to:"#headerWideRightEnd"},[e(r,{class:"headerEndBtn",link:"",xsmall:"",onClick:q},{default:t(()=>[e(g,{name:"cross",size:"20"})]),_:1})]))],64)):v("",!0)])}}});export{at as default};
