import{d as re,k as y,g as t,f as c,G as T,as as Y,l as e,ac as ge,r as f,a0 as J,o as he,U as K,at as ye,a1 as ve,a6 as h,p as s,w as a,a7 as X,F as ke,h as n,ad as Z,t as m,H as $,q as _,M as ee,N as M,af as te,c as A,O as we,n as ae,ah as Ce,K as Se,Y as $e,_ as Pe,z as Te,J as be,B as Ee,D as Oe,m as Le,au as Ne,W as Re}from"./CWZ8UILv.js";import{_ as Be}from"./Bl7gFmoX.js";import{_ as ze}from"./DfwfIJQD.js";import{_ as ne}from"./CokEUrg8.js";import{_ as Ie}from"./oQDVEu3p.js";const Me={class:"pieLoader"},Ue=["width","height"],De=["stroke-dasharray"],xe=re({__name:"PieLoader",props:{progress:{type:Number,default:0},size:{type:[String,Number],default:100},stroke:{type:[String,Number],default:2.8}},setup(v){const k=v,b=y(()=>({"stroke-width":k.stroke}));return(E,g)=>(t(),c("div",Me,[(t(),c("svg",{width:v.size,height:v.size,viewBox:"0 0 36 36",class:"pieLoader-chart"},[T("path",{class:"pieLoader-chart-bg",style:Y(e(b)),d:`M18 2.0845
         a 15.9155 15.9155 0 0 1 0 31.831
         a 15.9155 15.9155 0 0 1 0 -31.831`},null,4),T("path",{class:"pieLoader-chart-stroke",style:Y(e(b)),"stroke-dasharray":`${v.progress}, 100`,d:`M18 2.0845
         a 15.9155 15.9155 0 0 1 0 31.831
         a 15.9155 15.9155 0 0 1 0 -31.831`},null,12,De)],8,Ue))]))}}),Ae={key:1,class:"pageOutput-info-spinner"},je={key:0},Ge={key:1,class:"pageOutput-info-leftTime-seperate"},qe=1e3,se=.1,oe=4,P=40,Ye=re({__name:"output",setup(v){const{isQueue:k,output:b,isInitQueue:E,progress:g}=h(),r=ge(),O=f(0),u=f(0),U=f(!1),w=f(!1),i=f([]),j=f(!1),G=f("Starting.");let D=1,x;const C=y(()=>{const o=Math.floor(u.value/36e5),l=Math.floor(u.value%36e5/6e4),d=Math.floor(u.value%6e4/1e3);return{hours:o,minutes:l,seconds:d}}),le=y(()=>(i.value.length+g.value)/P*100),L=y(()=>i.value.length===P),ie=y(()=>!E.value&&(g.value>=0||i.value.length>0)?!0:E.value),ue=y(()=>r.imageHeight/r.imageWidth*100),q=async()=>{await we().open({name:"prompt"})||(k.value&&h().postInterrupt(),h().queueClear(),O.value=0,u.value=0,U.value=!1,i.value=[],await K(),await r.setWorkflow(),r.incrementRetryCount(),N())},ce=()=>{r.incrementRetryCount(),ae(A().GENERATE_UPLOAD)},pe=()=>{r.init(),ae(A().GENERATE_LOOKSTYLE)},W=async()=>{if(w.value)return;const o=1e3;await X().wait(o),u.value-=o,u.value>=0?W():u.value=0},me=o=>{Ne().open({name:"imagePreview",options:{index:o,list:i.value,onDownloadEnd:()=>Q()}})},N=async()=>{L.value||w.value||(k.value?(await X().wait(qe),N()):(w.value=!1,h().queuePrompt({json:JSON.stringify(r.workflow),batchCount:P-i.value.length})))},Q=()=>{w.value=!1,N()};return J(()=>b.value,o=>{o&&o.length>0&&i.value.push(o[o.length-1].replace("http://127.0.0.1:8188",Ce().public.BASE_URL))},{deep:!0}),J(()=>g.value,(o,l)=>{if(!O.value&&l===0&&(O.value=Date.now()),o>=se&&!U.value){U.value=!0;const d=Date.now()-O.value;u.value=d*(1/se)*(P-i.value.length),W()}},{immediate:!0}),he(async()=>{await K(),N(),x=ye(()=>{D=D%3+1,G.value=" Starting "+".".repeat(D)},1e3),j.value=!0}),ve(()=>{k.value&&h().postInterrupt(),h().queueClear(),x!==null&&clearInterval(x)}),(o,l)=>{const d=Se,de=$e,R=Pe,B=Te,z=be,fe=Re,V=Be,_e=ze,I=Ee,S=Oe,F=ke;return t(),s(F,{class:"pageOutput",wide:""},{default:a(()=>[n(z,{gap:"36"},{default:a(()=>[e(L)?(t(),s(ne,{key:0,title:"生成が完了しました",icon:"shine"})):(t(),s(z,{key:1,class:"pageOutput-info",justify:"center",gap:"20"},{default:a(()=>[n(R,{w:"48",h:"48",mt:"20",relative:""},{default:a(()=>[e(w)?(t(),s(Z,{key:0,onClick:Q},{default:a(()=>[n(d,{name:"play",size:"44"})]),_:1})):m("",!0),e(u)?(t(),s(xe,{key:2,progress:e(le),size:"48",stroke:"4"},null,8,["progress"])):(t(),c("div",Ae,[n(de,{size:"48",stroke:"4"})]))]),_:1}),e(u)?(t(),s(B,{key:0,class:"pageOutput-info-leftTime",title2:"",extrabold:"",center:""},{default:a(()=>[e(C).hours>0?(t(),c("span",je,$(String(e(C).hours).padStart(2,"0")),1)):m("",!0),e(C).hours>0?(t(),c("span",Ge,":")):m("",!0),T("span",null,$(String(e(C).minutes).padStart(2,"0")),1),l[0]||(l[0]=T("span",{class:"pageOutput-info-leftTime-seperate"},":",-1)),T("span",null,$(String(e(C).seconds).padStart(2,"0")),1)]),_:1})):(t(),s(B,{key:1,class:"pageOutput-info-leftTime",title2:"",extrabold:"",center:""},{default:a(()=>l[1]||(l[1]=[_(" -- : -- ")])),_:1}))]),_:1})),n(I,{gap:"8",split:oe},{default:a(()=>[(t(),c(M,null,ee(P,p=>n(_e,{key:`pageOutput-item-${p}`,class:"pageOutput-img",per:e(ue)},{default:a(()=>[e(i)[p-1]?(t(),s(Z,{key:0,onClick:H=>me(p-1)},{default:a(()=>[n(fe,{src:e(i)[p-1],cover:""},null,8,["src"])]),_:2},1032,["onClick"])):m("",!0),!e(L)&&p-1===e(i).length?(t(),s(R,{key:1,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:""},{default:a(()=>[n(V,{w:"100%",h:"100%",animation:""}),n(R,{absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:a(()=>[e(E)&&e(g)>0?(t(),s(B,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:a(()=>[_($(Math.round(e(g)*100))+"% ",1)]),_:1})):(t(),s(B,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:a(()=>[_($(e(G)),1)]),_:1}))]),_:1})]),_:1})):(t(),s(V,{key:2,w:"100%",h:"100%",animation:!e(ie),delay:p/oe*150},null,8,["animation","delay"]))]),_:2},1032,["per"])),64))]),_:1}),e(L)?(t(),s(z,{key:2,justify:"center",gap:"40"},{default:a(()=>[n(ne,{icon:"checkCircleLine",body:"生成画像は以上です"}),n(F,null,{default:a(()=>[n(z,{justify:"stretch",gap:"20"},{default:a(()=>[n(S,{onClick:ce},{default:a(()=>l[2]||(l[2]=[_(" 設定を変更してやり直す ")])),_:1}),n(S,{info:"",onClick:pe},{default:a(()=>l[3]||(l[3]=[_(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):m("",!0)]),_:1}),e(j)?(t(),c(M,{key:0},[(t(),s(te,{to:"#headerWideCenter"},[e(r).prompt&&e(r).prompt.length>0?(t(),s(I,{key:0,class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[n(I,{class:"headerPrompt-list",align:"center",gap:"2",fit:""},{default:a(()=>[(t(!0),c(M,null,ee(e(r).prompt,(p,H)=>(t(),s(Ie,Le({key:`headerPrompt-item-${H}`,ref_for:!0},{text:p}),null,16))),128))]),_:1}),n(R,{class:"headerPrompt-btn",w:"40","min-w":"40",h:"40","min-h":"40"},{default:a(()=>[n(S,{class:"headerPrompt-btn-inner",w:"100%",h:"100%",onClick:q},{default:a(()=>[n(d,{name:"edit",size:"16",color:"light"})]),_:1})]),_:1})]),_:1})):!e(r).prompt||!e(r).prompt.length?(t(),s(I,{key:1,class:"headerPromptEmpty",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[n(S,{xsmall:"",rounded:"",w:"160",onClick:q},{default:a(()=>[n(d,{name:"edit",size:"16",color:"light"}),!e(r).prompt||!e(r).prompt.length?(t(),c(M,{key:0},[_(" プロンプトを設定する ")],64)):m("",!0)]),_:1})]),_:1})):m("",!0)])),(t(),s(te,{to:"#headerWideRightEnd"},[n(S,{class:"headerEndBtn",minimal:"",xsmall:"",to:("useConstantsPath"in o?o.useConstantsPath:e(A))().dashboard()},{default:a(()=>l[4]||(l[4]=[_(" 終了する ")])),_:1},8,["to"])]))],64)):m("",!0)]),_:1})}}});export{Ye as default};
