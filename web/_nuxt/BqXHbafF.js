import{ab as Te,k as p,p as ze,n as Ee,bf as qe,ak as u,al as I,aJ as ae,ae as Be,bg as Me,ba as xe,c as P,a as t,ac as s,at as De,am as C,w as a,u as e,az as V,b4 as ne,ag as W,J as Ne,G as Re,F as je,o as n,aW as oe,v as Oe,y as Ue,b as Le,x as Qe,B as Ve,a7 as We,ao as He,D as Ae,E as Fe,d as S,aA as se,aB as Ge,H as Je,aL as Ye,j as T,aM as le,q as H,m as z,l as Ke,f as Xe}from"./BoXxDua1.js";import{_ as Ze}from"./yVG9rvwB.js";import{_ as et}from"./DHz6U5FY.js";import{_ as tt}from"./CdA601vQ.js";import{_ as at}from"./BRtmfF_l.js";import{_ as nt}from"./CwlMNbMA.js";const ot={class:"pageOutput",full:""},ie=1e3,E=3,ue=99,ft=Te({__name:"output",setup(st){const{isQueue:A,output:re,isInitQueue:q,progress:w,previewImageUrl:B,state:ce}=p(),r=ze(),{processing:pe}=Ee(qe()),M=u(null),fe=u(0),me=u(0),de=u(!1),c=u(!1),h=u(!1),x=u(!1),l=u([]),$=u(!1),F=u("Starting."),D=u(-1),m=u(!1);let N=1,R;const j=I(()=>l.value.length===ue),_e=I(()=>!q.value&&(w.value>=0||l.value.length>0)?!0:q.value),G=I(()=>r.imageHeight/r.imageWidth*100),J=I(()=>r.prompt),ge=async()=>{await T().open({name:"prompt"})||(await y(),await p().postInterrupt(),fe.value=0,me.value=0,de.value=!1,l.value=[],await le(),await r.setWorkflow(),r.incrementRetryCount(),v())},we=()=>{r.incrementRetryCount(),H(z().generate("upload"))},he=()=>{r.init(),H(z().generate("lookstyle"))},ve=async o=>{m.value=!0,await T().open({name:"upscaleSelect",options:{src:l.value[o]}}),m.value=!1,b()},ye=o=>{l.value.splice(o,1)},ke=async()=>{const o=await T().open({name:"uploadImage"});o&&o.base64&&o.file&&(r.continue(o.base64,o.file),H(z().generate("confirm")))},Y=async()=>{await T().open({name:"generateEndDialog"})&&(r.init(),Ke().replace(z().generate("lookstyle")))},Ce=async o=>{await Xe().open({name:"imagePreview",options:{index:o,list:l.value,onDownloadStart:()=>m.value=!0,onDownloadEnd:()=>m.value=!1}}),A.value||b()},v=async()=>{console.log("queue 1"),!j.value&&(console.log("queue 2"),!c.value&&(console.log("queue 3"),!m.value&&(console.log("queue 4"),A.value?(console.log("queue 5"),await W().wait(ie),v()):(console.log("queue 6"),x.value=!0,await y(),console.log("queue 7"),c.value=!1,await p().queuePrompt({json:JSON.stringify(p().workflow.updateSeed(r.workflow)),batchCount:1}),console.log("queue 8"),x.value=!1))))},O=async()=>{h.value=!0,x.value?(await W().wait(ie),await O()):(await y(),await p().postInterrupt(),h.value=!1,c.value=!0)},b=()=>{c.value=!1,v()},y=async()=>{await p().queueClear(),await p().historyClear()};return ae(()=>re.value,async o=>{if(!m.value&&o&&o.length>0){const i=o[o.length-1];i.includes("upscale")||l.value.push(i),M.value&&(await le(),await W().wait(250),M.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),ae(()=>l.value.length,async(o,i)=>{i!==void 0&&o>i&&v()},{immediate:!0}),Be(async()=>{console.log("onMounted 1"),await y(),console.log("onMounted 2"),await p().postInterrupt(),console.log("onMounted 3"),v(),console.log("onMounted 4"),R=Me(()=>{N=N%3+1,F.value=" Starting "+".".repeat(N)},1e3),$.value=!0}),xe(async()=>{await y(),await p().postInterrupt(),R!==null&&clearInterval(R)}),(o,i)=>{const K=Ue,$e=Oe,X=Ze,k=Qe,f=Le,U=Ne,L=Re,Q=Ve,be=Ae,Z=He,_=je,Ie=We,ee=Fe,Pe=Je,Se=et;return n(),P("div",ot,[t(U,{justify:"center",gap:[8,28],split:E},{default:a(()=>[(n(!0),P(V,null,oe(e(l),(d,g)=>(n(),s(L,{key:`pageOutput-item-generate-${g}`,justify:"center",gap:"10"},{default:a(()=>[t(X,{per:e(G)},{default:a(()=>[t($e,{onClick:te=>Ce(g)},{default:a(()=>[t(K,{class:"pageOutput-img",src:d,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(U,{justify:"center",gap:"20"},{default:a(()=>[t(f,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ve(g)},{default:a(()=>[t(k,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(f,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ye(g)},{default:a(()=>[t(k,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(j)?C("",!0):(n(!0),P(V,{key:0},oe(E-e(l).length%E,d=>(n(),s(X,{key:`pageOutput-item-${d}`,class:"pageOutput-img",per:e(G)},{default:a(()=>[d===1?(n(),s(_,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:g=>D.value=d,onMouseleave:i[0]||(i[0]=g=>D.value=-1)},{default:a(()=>[e(pe)?(n(),s(Q,{key:0,w:"100%",h:"100%"})):e(B)?(n(),s(K,{key:2,src:e(B),cover:""},null,8,["src"])):(n(),s(Q,{key:1,w:"100%",h:"100%",animation:""})),t(Ie,{duration:"100"},{default:a(()=>[e(D)===d||e(c)?(n(),s(_,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"text060"},{default:a(()=>[t(Z,null,{default:a(()=>[e(h)?(n(),s(f,{key:0,link:""},{default:a(()=>[t(be,{size:"2.2vw",color:"light"})]),_:1})):e(c)?(n(),s(f,{key:2,link:"",onClick:b},{default:a(()=>[t(k,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),s(f,{key:1,link:"",onClick:O},{default:a(()=>[t(k,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):C("",!0)]),_:2},1024),!e(m)&&!e(c)&&!e(h)?(n(),s(_,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark-090","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(ce)==="executing"&&e(B)&&e($)?(n(),s(ee,{key:0,footnote:"",bold:"",center:"",color:"light","cap-height-baseline":""},{default:a(()=>[S(se(Math.round(e(w)*100))+"% ",1)]),_:1})):!e(q)||e(w)===0||!e($)?(n(),s(ee,{key:1,footnote:"",bold:"",color:"light","cap-height-baseline":"",style:{width:"56px"}},{default:a(()=>[S(se(e(F)),1)]),_:1})):C("",!0)]),_:1})):C("",!0)]),_:2},1032,["onMouseover"])):(n(),s(Q,{key:1,w:"100%",h:"100%",animation:!e(_e),delay:d/E*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(_,{h:"80"}),e(j)?(n(),s(L,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(Ge,{icon:"checkCircleLine",body:"生成画像は以上です"}),t(Pe,null,{default:a(()=>[t(L,{justify:"stretch",gap:"20"},{default:a(()=>[t(f,{onClick:we},{default:a(()=>i[1]||(i[1]=[S(" 内容を変更してやり直す ")])),_:1}),t(f,{info:"",onClick:he},{default:a(()=>i[2]||(i[2]=[S(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),s(_,{key:1,fixed:"",bottom:"20",left:"0",right:"0"},{default:a(()=>[t(Z,null,{default:a(()=>[t(nt,{paused:e(c),processing:!e(l).length&&!e(w)&&!e(c)||e(h),progress:e(l).length+e(w),count:e(l).length,total:ue,onPause:O,onResume:b,onNext:ke,onEnd:Y},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),De("div",{ref_key:"element",ref:M,class:"pageOutput-scrollTarget"},null,512),e($)?(n(),P(V,{key:2},[(n(),s(ne,{to:"#headerWideCenter"},[t(U,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(at,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(tt,{class:Ye(["headerPrompt-list-inner",{_empty:e(J).length===0}]),name:"プロンプト",data:e(J),more:""},null,8,["class","data"])]),_:1}),t(_,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(f,{w:"100%",h:"100%",info:"",onClick:ge},{default:a(()=>[t(k,{name:"edit",size:"20",gradation:"horizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(ne,{to:"#headerWideRightEnd"},[t(Se,{class:"headerEndBtn",link:"",xsmall:"",icon:{name:"cross",size:20},onClick:Y})]))],64)):C("",!0)])}}});export{ft as default};
