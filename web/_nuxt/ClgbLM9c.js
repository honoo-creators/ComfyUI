import{d as Ce,aK as $e,x as u,h as $,P as Ee,o as Te,aU as be,X as Ie,f as n,g as E,z as e,w as t,F as D,G as te,Y as a,l as h,i as s,ag as Pe,A as y,k as Re,p as ze,aM as ae,a0 as M,a5 as m,az as ne,n as j,c as T,e as Oe,aJ as x,D as Ne,a2 as Se,t as Be,U as Le,E as Ue,V as De,aL as Me,B as oe,at as je,a8 as xe,a6 as Ae,R as Ge,_ as Qe}from"./CODnliH5.js";import{_ as Ve}from"./DIDdWfb0.js";import{_ as qe}from"./DRAiEZEi.js";import{_ as Fe}from"./CfejLLcE.js";import{_ as He}from"./CrzNUAE9.js";import{_ as We}from"./DVymPoa6.js";const Ye={class:"pageOutput",full:""},Je=1e3,b=3,A=99,ot=Ce({__name:"output",setup(Ke){const{isQueue:I,output:se,isInitQueue:P,progress:R,previewImageUrl:G,queueRemaining:le}=m(),c=$e(),z=u(null),ie=u(0),ue=u(0),re=u(!1),f=u(!1),Q=u(!1),i=u([]),V=u(!1),q=u("Starting."),O=u(-1),d=u(!1);let N=1,S;const k=$(()=>i.value.length===A),ce=$(()=>!P.value&&(R.value>=0||i.value.length>0)?!0:P.value),F=$(()=>c.imageHeight/c.imageWidth*100),H=$(()=>c.prompt),me=async()=>{await M().open({name:"prompt"})||(I.value&&m().postInterrupt(),m().queueClear(),m().historyClear(),ie.value=0,ue.value=0,re.value=!1,i.value=[],await ne(),await c.setWorkflow(),c.incrementRetryCount(),w())},fe=()=>{c.incrementRetryCount(),j(T().GENERATE_UPLOAD)},pe=()=>{c.init(),j(T().GENERATE_LOOKSTYLE)},_e=async o=>{d.value=!0,await M().open({name:"upscaleSelect",options:{src:i.value[o]}}),d.value=!1,B()},de=o=>{i.value.splice(o,1)},ge=async()=>{const o=await M().open({name:"uploadImage"});o&&o.base64&&o.file&&(c.continue(o.base64,o.file),j(T().GENERATE_CONFIRM))},W=()=>{i.value=[],Oe().replace(T().dashboard())},ve=async o=>{await je().open({name:"imagePreview",options:{index:o,list:i.value,onDownloadStart:()=>d.value=!0,onDownloadEnd:()=>d.value=!1}}),I.value||B()},w=async()=>{k.value||f.value||(I.value?(await x().wait(Je),w()):(f.value=!1,m().queuePrompt({json:JSON.stringify(c.workflow),batchCount:A-i.value.length})))},he=async()=>{Q.value=!0,await L(),Q.value=!1,f.value=!0},B=()=>{f.value=!1,w()},L=async()=>{console.log("clearQueue",le.value,A-i.value.length),await m().postInterrupt(),await x().wait(250),m().queueClear(),m().historyClear()};return Ee(()=>se.value,async o=>{if(!d.value&&o&&o.length>0){const l=o[o.length-1];l.includes("upscale")||i.value.push(l),z.value&&(await ne(),await x().wait(250),z.value.scrollIntoView({behavior:"smooth",block:"start"}))}},{deep:!0}),Te(async()=>{await L(),w(),S=be(()=>{N=N%3+1,q.value=" Starting "+".".repeat(N)},1e3),V.value=!0}),Ie(()=>{L(),S!==null&&clearInterval(S)}),(o,l)=>{const Y=xe,J=Ve,g=Ne,r=Se,U=Be,C=Le,K=qe,ye=Ae,p=Ue,ke=Ge,X=Qe,Z=De,we=Fe;return n(),E("div",Ye,[e(U,{justify:"center",gap:[8,28],split:b},{default:t(()=>[(n(!0),E(D,null,te(a(i),(_,v)=>(n(),s(C,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(J,{per:a(F)},{default:t(()=>[e(Me,{onClick:ee=>ve(v)},{default:t(()=>[e(Y,{src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(U,{justify:"center",gap:"20"},{default:t(()=>[e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:ee=>_e(v)},{default:t(()=>[e(g,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:ee=>de(v)},{default:t(()=>[e(g,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(k)?h("",!0):(n(!0),E(D,{key:0},te(b-a(i).length%b,_=>(n(),s(J,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:a(F)},{default:t(()=>[_===1?(n(),s(p,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:v=>O.value=_,onMouseleave:l[0]||(l[0]=v=>O.value=-1)},{default:t(()=>[a(G)?(n(),s(Y,{key:1,src:a(G),cover:""},null,8,["src"])):(n(),s(K,{key:0,w:"100%",h:"100%",animation:""})),e(ke,{duration:"100"},{default:t(()=>[a(O)===_||a(f)?(n(),s(p,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(ye,null,{default:t(()=>[a(f)?(n(),s(r,{key:1,link:"",onClick:B},{default:t(()=>[e(g,{name:"play",size:"20",color:"light"})]),_:1})):(n(),s(r,{key:0,link:"",onClick:he},{default:t(()=>[e(g,{name:"pause",size:"20",color:"light"})]),_:1}))]),_:1})]),_:1})):h("",!0)]),_:2},1024),a(d)?h("",!0):(n(),s(p,{key:2,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(P)&&a(R)>0?(n(),s(X,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[y(oe(Math.round(a(R)*100))+"% ",1)]),_:1})):(n(),s(X,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[y(oe(a(q)),1)]),_:1}))]),_:1}))]),_:2},1032,["onMouseover"])):(n(),s(K,{key:1,w:"100%",h:"100%",animation:!a(ce),delay:_/b*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(p,{h:"20"}),a(k)?(n(),s(C,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Pe,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(Z,null,{default:t(()=>[e(C,{justify:"stretch",gap:"20"},{default:t(()=>[e(r,{onClick:fe},{default:t(()=>l[1]||(l[1]=[y(" 内容を変更してやり直す ")])),_:1}),e(r,{info:"",onClick:pe},{default:t(()=>l[2]||(l[2]=[y(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),e(we,null,{default:t(()=>[!a(k)&&a(f)?(n(),s(Z,{key:0},{default:t(()=>[e(C,{justify:"center"},{default:t(()=>[e(r,{info:"",onClick:ge},{default:t(()=>l[3]||(l[3]=[y(" 続けて他の原図を生成する ")])),_:1}),e(p,{h:"0"}),e(r,{minimal:"",onClick:W},{default:t(()=>l[4]||(l[4]=[y(" 終了する ")])),_:1}),e(p,{h:"40"})]),_:1})]),_:1})):h("",!0)]),_:1}),Re("div",{ref_key:"element",ref:z,class:"pageOutput-scrollTarget"},null,512),a(V)?(n(),E(D,{key:1},[(n(),s(ae,{to:"#headerWideCenter"},[e(U,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(We,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:t(()=>[e(He,{class:ze(["headerPrompt-list-inner",{_empty:a(H).length===0}]),name:"プロンプト",data:a(H),more:""},null,8,["class","data"])]),_:1}),e(p,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(r,{w:"100%",h:"100%",info:"",onClick:me},{default:t(()=>[e(g,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(ae,{to:"#headerWideRightEnd"},[e(r,{class:"headerEndBtn",link:"",xsmall:"",onClick:W},{default:t(()=>[e(g,{name:"cross",size:"20"})]),_:1})]))],64)):h("",!0)])}}});export{ot as default};
