import{d as he,aI as ke,x as c,h as A,P as K,o as we,ax as X,aS as ye,X as Ce,a5 as p,f as n,g as T,z as e,w as t,F as U,G as Z,Y as a,l as k,i as s,A as g,p as $e,aK as ee,a0 as te,n as ae,c as N,e as Ee,aH as ne,D as Te,a2 as be,t as Re,U as Ie,E as Pe,V as Se,aJ as Oe,B as oe,ar as Le,$ as Be,a8 as De,_ as ze,a6 as Ae,R as Ue}from"./CZv2J2H9.js";import{_ as Ne}from"./pK5AlFZK.js";import{_ as je}from"./B1wodFGT.js";import{_ as Me}from"./DBvLVgxz.js";import{_ as xe}from"./CeKr2Em8.js";import{_ as Ge}from"./Ck06ZueD.js";import{_ as qe}from"./DBVb6VdH.js";const He=1e3,se=.1,b=3,j=99,Ze=he({__name:"output",setup(Ve){const{isQueue:R,output:le,isInitQueue:I,progress:w}=p(),r=ke(),P=c(null),y=c(0),h=c(0),S=c(!1),m=c(!1),l=c([]),M=c(!1),x=c("Starting."),O=c(-1);let L=1,B;const C=A(()=>l.value.length===j),ue=A(()=>!I.value&&(w.value>=0||l.value.length>0)?!0:I.value),G=A(()=>r.imageHeight/r.imageWidth*100),ie=async()=>{await te().open({name:"prompt"})||(R.value&&p().postInterrupt(),p().queueClear(),y.value=0,h.value=0,S.value=!1,l.value=[],await X(),await r.setWorkflow(),r.incrementRetryCount(),$())},re=()=>{r.incrementRetryCount(),ae(N().GENERATE_UPLOAD)},ce=()=>{r.init(),ae(N().GENERATE_LOOKSTYLE)},me=async o=>{await te().open({name:"upscaleSelect",options:{src:l.value[o]}})},pe=o=>{l.value.splice(o,1)},q=()=>{l.value=[],Ee().replace(N().dashboard())},H=async()=>{if(m.value)return;const o=1e3;await ne().wait(o),h.value-=o,h.value>=0?H():h.value=0},_e=o=>{Le().open({name:"imagePreview",options:{index:o,list:l.value,onDownloadEnd:()=>V()}})},$=async()=>{C.value||m.value||(R.value?(await ne().wait(He),$()):(m.value=!1,p().queuePrompt({json:JSON.stringify(r.workflow),batchCount:j-l.value.length})))},fe=()=>{m.value=!0,p().postInterrupt(),p().queueClear()},V=()=>{m.value=!1,$()};return K(()=>le.value,o=>{o&&o.length>0&&(l.value.push(o[o.length-1].replace("http://127.0.0.1:8188",Be().public.BASE_URL)),P.value&&P.value.scrollIntoView({behavior:"smooth",block:"end"}))},{deep:!0}),K(()=>w.value,(o,u)=>{if(!y.value&&u===0&&(y.value=Date.now()),o>=se&&!S.value){S.value=!0;const D=Date.now()-y.value;h.value=D*(1/se)*(j-l.value.length),H()}},{immediate:!0}),we(async()=>{await X(),$(),B=ye(()=>{L=L%3+1,x.value=" Starting "+".".repeat(L)},1e3),M.value=!0}),Ce(()=>{R.value&&p().postInterrupt(),p().queueClear(),B!==null&&clearInterval(B)}),(o,u)=>{const D=De,F=Ne,f=Te,i=be,z=Re,E=Ie,Q=je,W=ze,d=Pe,de=Ae,ve=Ue,Y=Se,ge=Me;return n(),T("div",{ref_key:"element",ref:P,class:"pageOutput",full:""},[e(z,{gap:"8",split:b},{default:t(()=>[(n(!0),T(U,null,Z(a(l),(_,v)=>(n(),s(E,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(F,{per:a(G)},{default:t(()=>[e(Oe,{onClick:J=>_e(v)},{default:t(()=>[e(D,{src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(z,{justify:"center",gap:"20"},{default:t(()=>[e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:J=>me(v)},{default:t(()=>[e(f,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:J=>pe(v)},{default:t(()=>[e(f,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(C)?k("",!0):(n(!0),T(U,{key:0},Z(b-a(l).length%b,_=>(n(),s(F,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:a(G)},{default:t(()=>[_===1?(n(),s(d,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"",onMouseover:v=>O.value=_,onMouseleave:u[0]||(u[0]=v=>O.value=-1)},{default:t(()=>[e(Q,{w:"100%",h:"100%",animation:""}),e(d,{absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[a(I)&&a(w)>0?(n(),s(W,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[g(oe(Math.round(a(w)*100))+"% ",1)]),_:1})):(n(),s(W,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[g(oe(a(x)),1)]),_:1}))]),_:1}),e(ve,{duration:"100"},{default:t(()=>[a(O)===_||a(m)?(n(),s(d,{key:0,absolute:"",top:"0",left:"0",w:"100%",h:"100%"},{default:t(()=>[e(de,null,{default:t(()=>[a(m)?(n(),s(i,{key:1,link:"",onClick:V},{default:t(()=>[e(f,{name:"play",size:"20"})]),_:1})):(n(),s(i,{key:0,link:"",onClick:fe},{default:t(()=>[e(f,{name:"pause",size:"20"})]),_:1}))]),_:1})]),_:1})):k("",!0)]),_:2},1024)]),_:2},1032,["onMouseover"])):(n(),s(Q,{key:1,w:"100%",h:"100%",animation:!a(ue),delay:_/b*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(d,{h:"36"}),a(C)?(n(),s(E,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(xe,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(Y,null,{default:t(()=>[e(E,{justify:"stretch",gap:"20"},{default:t(()=>[e(i,{onClick:re},{default:t(()=>u[1]||(u[1]=[g(" 内容を変更してやり直す ")])),_:1}),e(i,{info:"",onClick:ce},{default:t(()=>u[2]||(u[2]=[g(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):k("",!0),e(ge,null,{default:t(()=>[!a(C)&&a(m)?(n(),s(Y,{key:0},{default:t(()=>[e(E,{justify:"center"},{default:t(()=>[e(i,{info:""},{default:t(()=>u[3]||(u[3]=[g(" 続けて他の原図を生成する ")])),_:1}),e(d,{h:"0"}),e(i,{minimal:"",onClick:q},{default:t(()=>u[4]||(u[4]=[g(" 終了する ")])),_:1})]),_:1})]),_:1})):k("",!0)]),_:1}),a(M)?(n(),T(U,{key:1},[(n(),s(ee,{to:"#headerWideCenter"},[e(z,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(qe,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(Ge,{class:$e(["headerPrompt-list-inner",{_empty:a(r).prompt.length===0}]),name:"プロンプト",data:a(r).prompt},null,8,["class","data"])]),_:1}),e(d,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(i,{w:"100%",h:"100%",info:"",onClick:ie},{default:t(()=>[e(f,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),s(ee,{to:"#headerWideRightEnd"},[e(i,{class:"headerEndBtn",link:"",xsmall:"",onClick:q},{default:t(()=>[e(f,{name:"cross",size:"20"})]),_:1})]))],64)):k("",!0)],512)}}});export{Ze as default};
