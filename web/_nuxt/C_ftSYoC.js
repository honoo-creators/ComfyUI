import{d as Te,aN as Ie,aw as Pe,aY as be,x as i,h as I,P as Re,o as Ne,a5 as f,aZ as Oe,X as Se,f as n,g as P,z as t,w as a,F as V,G as ae,Y as e,l as E,i as o,aa as ze,A as b,k as xe,p as Be,aP as ne,a0 as R,aB as se,n as Y,c as N,e as De,aM as F,D as Le,a2 as Ue,t as Me,U as Ae,a6 as je,E as Ge,V as Qe,aO as Ve,B as oe,av as Ye,a8 as Fe,aD as He,R as We,_ as qe}from"./CfUbkaFb.js";import{_ as Ke}from"./C39KQJPj.js";import{_ as Je}from"./DHdAtBME.js";import{_ as Xe}from"./CgNS2OL8.js";import{_ as Ze}from"./DMENKTg5.js";import{_ as et}from"./BYR0j_PP.js";const tt={class:"pageOutput",full:""},le=1e3,O=3,ie=99,ut=Te({__name:"output",setup(at){const{isQueue:H,output:re,isInitQueue:S,progress:h,previewImageUrl:z,state:ue}=f(),r=Ie(),{processing:ce}=Pe(be()),x=i(null),pe=i(0),fe=i(0),_e=i(!1),u=i(!1),v=i(!1),B=i(!1),l=i([]),$=i(!1),W=i("Starting."),D=i(-1),_=i(!1);let L=1,U;const M=I(()=>l.value.length===ie),me=I(()=>!S.value&&(h.value>=0||l.value.length>0)?!0:S.value),q=I(()=>r.imageHeight/r.imageWidth*100),K=I(()=>r.prompt),de=async()=>{await R().open({name:"prompt"})||(await y(),await f().postInterrupt(),pe.value=0,fe.value=0,_e.value=!1,l.value=[],await se(),await r.setWorkflow(),r.incrementRetryCount(),k())},ge=()=>{r.incrementRetryCount(),Y(N().GENERATE_UPLOAD)},we=()=>{r.init(),Y(N().GENERATE_LOOKSTYLE)},he=async s=>{_.value=!0,await R().open({name:"upscaleSelect",options:{src:l.value[s]}}),_.value=!1,T()},ve=s=>{l.value.splice(s,1)},ke=async()=>{const s=await R().open({name:"uploadImage"});s&&s.base64&&s.file&&(r.continue(s.base64,s.file),Y(N().GENERATE_CONFIRM))},J=async()=>{await R().open({name:"generateEndDialog"})&&(r.init(),De().replace(N().GENERATE_LOOKSTYLE))},ye=async s=>{await Ye().open({name:"imagePreview",options:{index:s,list:l.value,onDownloadStart:()=>_.value=!0,onDownloadEnd:()=>_.value=!1}}),H.value||T()},k=async()=>{M.value||u.value||_.value||(H.value?(await F().wait(le),k()):(B.value=!0,await y(),u.value=!1,await f().queuePrompt({json:JSON.stringify(f().workflow.updateSeed(r.workflow)),batchCount:1}),B.value=!1))},A=async()=>{v.value=!0,B.value?(await F().wait(le),await A()):(await y(),await f().postInterrupt(),v.value=!1,u.value=!0)},T=()=>{u.value=!1,k()},y=async()=>{await f().queueClear(),await f().historyClear()};return Re(()=>re.value,async(s,p)=>{if(!_.value&&s&&s.length>0){const C=s[s.length-1];C.includes("upscale")||l.value.push(C),x.value&&(await se(),await F().wait(250),x.value.scrollIntoView({behavior:"smooth",block:"start"}))}s.length>p.length&&k()},{deep:!0}),Ne(async()=>{await y(),await f().postInterrupt(),k(),U=Oe(()=>{L=L%3+1,W.value=" Starting "+".".repeat(L)},1e3),$.value=!0}),Se(()=>{y(),U!==null&&clearInterval(U)}),(s,p)=>{const C=Fe,X=Ke,d=Le,c=Ue,j=Me,G=Ae,Q=Je,Ce=He,Z=je,g=Ge,Ee=We,ee=qe,$e=Qe;return n(),P("div",tt,[t(j,{justify:"center",gap:[8,28],split:O},{default:a(()=>[(n(!0),P(V,null,ae(e(l),(m,w)=>(n(),o(G,{key:`pageOutput-item-generate-${w}`,justify:"center",gap:"10"},{default:a(()=>[t(X,{per:e(q)},{default:a(()=>[t(Ve,{onClick:te=>ye(w)},{default:a(()=>[t(C,{class:"pageOutput-img",src:m,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),t(j,{justify:"center",gap:"20"},{default:a(()=>[t(c,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>he(w)},{default:a(()=>[t(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),t(c,{w:"20",h:"20","no-padding":"",link:"",onClick:te=>ve(w)},{default:a(()=>[t(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(M)?E("",!0):(n(!0),P(V,{key:0},ae(O-e(l).length%O,m=>(n(),o(X,{key:`pageOutput-item-${m}`,class:"pageOutput-img",per:e(q)},{default:a(()=>[m===1?(n(),o(g,{key:0,w:"100%",h:"100%",relative:"","z-index":"0",onMouseover:w=>D.value=m,onMouseleave:p[0]||(p[0]=w=>D.value=-1)},{default:a(()=>[e(ce)?(n(),o(Q,{key:0,w:"100%",h:"100%"})):e(z)?(n(),o(C,{key:2,src:e(z),cover:""},null,8,["src"])):(n(),o(Q,{key:1,w:"100%",h:"100%",animation:""})),t(Ee,{duration:"100"},{default:a(()=>[e(D)===m||e(u)?(n(),o(g,{key:0,absolute:"",top:"0",left:"0","z-index":"0",w:"100%",h:"100%",color:"dark60"},{default:a(()=>[t(Z,null,{default:a(()=>[e(v)?(n(),o(c,{key:0,link:""},{default:a(()=>[t(Ce,{size:"2.2vw",color:"light"})]),_:1})):e(u)?(n(),o(c,{key:2,link:"",onClick:T},{default:a(()=>[t(d,{name:"play",size:"2.2vw",color:"light"})]),_:1})):(n(),o(c,{key:1,link:"",onClick:A},{default:a(()=>[t(d,{name:"pause",size:"2.2vw",color:"light"})]),_:1}))]),_:1})]),_:1})):E("",!0)]),_:2},1024),!e(_)&&!e(u)&&!e(v)?(n(),o(g,{key:3,absolute:"",top:"8",left:"8","z-index":"1",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:a(()=>[e(ue)==="executing"&&e(z)&&e($)?(n(),o(ee,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:a(()=>[b(oe(Math.round(e(h)*100))+"% ",1)]),_:1})):!e(S)||e(h)===0||!e($)?(n(),o(ee,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:a(()=>[b(oe(e(W)),1)]),_:1})):E("",!0)]),_:1})):E("",!0)]),_:2},1032,["onMouseover"])):(n(),o(Q,{key:1,w:"100%",h:"100%",animation:!e(me),delay:m/O*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),t(g,{h:"40"}),e(M)?(n(),o(G,{key:0,justify:"center",gap:"40"},{default:a(()=>[t(ze,{icon:"checkCircleLine",body:"生成画像は以上です"}),t($e,null,{default:a(()=>[t(G,{justify:"stretch",gap:"20"},{default:a(()=>[t(c,{onClick:ge},{default:a(()=>p[1]||(p[1]=[b(" 内容を変更してやり直す ")])),_:1}),t(c,{info:"",onClick:we},{default:a(()=>p[2]||(p[2]=[b(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):(n(),o(g,{key:1,w:"100%",fixed:"",bottom:"20"},{default:a(()=>[t(Z,null,{default:a(()=>[t(et,{paused:e(u),processing:!e(l).length&&!e(h)&&!e(u)||e(v),progress:e(l).length+e(h),count:e(l).length,total:ie,onPause:A,onResume:T,onNext:ke,onEnd:J},null,8,["paused","processing","progress","count"])]),_:1})]),_:1})),xe("div",{ref_key:"element",ref:x,class:"pageOutput-scrollTarget"},null,512),e($)?(n(),P(V,{key:2},[(n(),o(ne,{to:"#headerWideCenter"},[t(j,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:a(()=>[t(Ze,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":""},{default:a(()=>[t(Xe,{class:Be(["headerPrompt-list-inner",{_empty:e(K).length===0}]),name:"プロンプト",data:e(K),more:""},null,8,["class","data"])]),_:1}),t(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:a(()=>[t(c,{w:"100%",h:"100%",info:"",onClick:de},{default:a(()=>[t(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(ne,{to:"#headerWideRightEnd"},[t(c,{class:"headerEndBtn",link:"",xsmall:"",onClick:J},{default:a(()=>[t(d,{name:"cross",size:"20"})]),_:1})]))],64)):E("",!0)])}}});export{ut as default};
