import{d as re,aI as ue,x as c,h as d,P as Q,o as ie,aw as V,aR as ce,X as me,a5 as m,f as s,g as C,z as e,w as t,F as I,G as W,Y as n,l as L,i as r,A as y,p as pe,aK as F,c as B,a0 as _e,n as Y,aH as J,t as fe,a2 as de,U as ge,V as he,D as ve,aJ as we,B as K,aq as Ce,$ as ye,a8 as ke,_ as Ee,E as $e}from"./DmyA04cl.js";import{_ as Pe}from"./Bn0YPiTc.js";import{_ as Te}from"./Dmt2AqC-.js";import{_ as Re}from"./CX8nAfqe.js";import{_ as be}from"./DsW89wX7.js";import{_ as Oe}from"./YTtTyyQ5.js";const Se={class:"pageOutput",full:""},Ie=1e3,X=.1,k=3,E=99,qe=re({__name:"output",setup(Le){const{isQueue:$,output:Z,isInitQueue:P,progress:p}=m(),l=ue(),g=c(0),u=c(0),T=c(!1),h=c(!1),o=c([]),U=c(!1),A=c("Starting.");let R=1,b;d(()=>{const a=Math.floor(u.value/36e5),i=Math.floor(u.value%36e5/6e4),_=Math.floor(u.value%6e4/1e3);return{hours:a,minutes:i,seconds:_}}),d(()=>(o.value.length+p.value)/E*100);const O=d(()=>o.value.length===E),ee=d(()=>!P.value&&(p.value>=0||o.value.length>0)?!0:P.value),D=d(()=>l.imageHeight/l.imageWidth*100),te=async()=>{await _e().open({name:"prompt"})||($.value&&m().postInterrupt(),m().queueClear(),g.value=0,u.value=0,T.value=!1,o.value=[],await V(),await l.setWorkflow(),l.incrementRetryCount(),v())},ae=()=>{l.incrementRetryCount(),Y(B().GENERATE_UPLOAD)},ne=()=>{l.init(),Y(B().GENERATE_LOOKSTYLE)},N=async()=>{if(h.value)return;const a=1e3;await J().wait(a),u.value-=a,u.value>=0?N():u.value=0},se=a=>{Ce().open({name:"imagePreview",options:{index:a,list:o.value,onDownloadEnd:()=>oe()}})},v=async()=>{O.value||h.value||($.value?(await J().wait(Ie),v()):(h.value=!1,m().queuePrompt({json:JSON.stringify(l.workflow),batchCount:E-o.value.length})))},oe=()=>{h.value=!1,v()};return Q(()=>Z.value,a=>{a&&a.length>0&&o.value.push(a[a.length-1].replace("http://127.0.0.1:8188",ye().public.BASE_URL))},{deep:!0}),Q(()=>p.value,(a,i)=>{if(!g.value&&i===0&&(g.value=Date.now()),a>=X&&!T.value){T.value=!0;const _=Date.now()-g.value;u.value=_*(1/X)*(E-o.value.length),N()}},{immediate:!0}),ie(async()=>{await V(),v(),b=ce(()=>{R=R%3+1,A.value=" Starting "+".".repeat(R)},1e3),U.value=!0}),me(()=>{$.value&&m().postInterrupt(),m().queueClear(),b!==null&&clearInterval(b)}),(a,i)=>{const _=ke,M=Pe,G=Te,q=Ee,x=$e,z=fe,w=de,S=ge,le=he,j=ve;return s(),C("div",Se,[e(S,{gap:"36"},{default:t(()=>[e(z,{gap:"8",split:k},{default:t(()=>[(s(!0),C(I,null,W(n(o),(f,H)=>(s(),r(M,{key:`pageOutput-item-generate-${H}`,class:"pageOutput-img",per:n(D)},{default:t(()=>[e(we,{onClick:Be=>se(H)},{default:t(()=>[e(_,{src:f,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]))),128)),n(O)?L("",!0):(s(!0),C(I,{key:0},W(k-n(o).length%k,f=>(s(),r(M,{key:`pageOutput-item-${f}`,class:"pageOutput-img",per:n(D)},{default:t(()=>[f===1?(s(),r(x,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:""},{default:t(()=>[e(G,{w:"100%",h:"100%",animation:""}),e(x,{absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[n(P)&&n(p)>0?(s(),r(q,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[y(K(Math.round(n(p)*100))+"% ",1)]),_:1})):(s(),r(q,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[y(K(n(A)),1)]),_:1}))]),_:1})]),_:1})):(s(),r(G,{key:1,w:"100%",h:"100%",animation:!n(ee),delay:f/k*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),n(O)?(s(),r(S,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Re,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(le,null,{default:t(()=>[e(S,{justify:"stretch",gap:"20"},{default:t(()=>[e(w,{onClick:ae},{default:t(()=>i[0]||(i[0]=[y(" 内容を変更してやり直す ")])),_:1}),e(w,{info:"",onClick:ne},{default:t(()=>i[1]||(i[1]=[y(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):L("",!0)]),_:1}),n(U)?(s(),C(I,{key:0},[(s(),r(F,{to:"#headerWideCenter"},[e(z,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(Oe,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(be,{class:pe(["headerPrompt-list-inner",{_empty:n(l).prompt.length===0}]),name:"プロンプト",data:n(l).prompt},null,8,["class","data"])]),_:1}),e(w,{w:"40",h:"40",info:"",onClick:te},{default:t(()=>[e(j,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})])),(s(),r(F,{to:"#headerWideRightEnd"},[e(w,{class:"headerEndBtn",link:"",xsmall:"",to:("useConstantsPath"in a?a.useConstantsPath:n(B))().dashboard()},{default:t(()=>[e(j,{name:"cross",size:"20"})]),_:1},8,["to"])]))],64)):L("",!0)])}}});export{qe as default};
