import{d as ge,aI as ve,x as u,h as L,P as he,o as ke,ax as F,aS as ye,X as we,a5 as m,f as n,g as $,z as e,w as t,F as U,G as Y,Y as a,l as v,i as o,A as h,p as Ce,aK as J,a0 as K,n as X,c as N,e as $e,aH as Ee,D as Te,a2 as be,t as Ie,U as Pe,E as Oe,V as Re,aJ as Se,B as Z,ar as ze,a8 as Be,_ as Le,a6 as Ue,R as Ne}from"./Bf47Oq4_.js";import{_ as je}from"./BSXs1Q7Q.js";import{_ as Ae}from"./DROxRDyC.js";import{_ as De}from"./CXjRBVIr.js";import{_ as Me}from"./Bb7ewZ2a.js";import{_ as xe}from"./BIioZ3aK.js";import{_ as qe}from"./BFpSAfyC.js";const Ge=1e3,E=3,ee=99,Xe=ge({__name:"output",setup(He){const{isQueue:k,output:te,isInitQueue:T,progress:b,previewImageUrl:j}=m(),c=ve(),I=u(null),ae=u(0),ne=u(0),oe=u(!1),p=u(!1),l=u([]),A=u(!1),D=u("Starting."),P=u(-1),O=u(!1);let R=1,S;const y=L(()=>l.value.length===ee),se=L(()=>!T.value&&(b.value>=0||l.value.length>0)?!0:T.value),M=L(()=>c.imageHeight/c.imageWidth*100),le=async()=>{await K().open({name:"prompt"})||(k.value&&m().postInterrupt(),m().queueClear(),ae.value=0,ne.value=0,oe.value=!1,l.value=[],await F(),await c.setWorkflow(),c.incrementRetryCount(),w())},ie=()=>{c.incrementRetryCount(),X(N().GENERATE_UPLOAD)},re=()=>{c.init(),X(N().GENERATE_LOOKSTYLE)},ue=async i=>{O.value=!0,await K().open({name:"upscaleSelect",options:{src:l.value[i]}}),O.value=!1,z()},ce=i=>{l.value.splice(i,1)},x=()=>{l.value=[],$e().replace(N().dashboard())},me=async i=>{await ze().open({name:"imagePreview",options:{index:i,list:l.value}}),k.value||z()},w=async()=>{y.value||p.value||(k.value?(await Ee().wait(Ge),w()):(p.value=!1,m().queuePrompt({json:JSON.stringify(c.workflow),batchCount:ee-l.value.length})))},pe=()=>{p.value=!0,m().postInterrupt(),m().queueClear()},z=()=>{p.value=!1,w()};return he(()=>te.value,i=>{if(i&&i.length>0){const s=i[i.length-1];s.includes("upscale")||l.value.push(s),I.value&&I.value.scrollIntoView({behavior:"smooth",block:"end"})}},{deep:!0}),ke(async()=>{await F(),w(),S=ye(()=>{R=R%3+1,D.value=" Starting "+".".repeat(R)},1e3),A.value=!0}),we(()=>{k.value&&m().postInterrupt(),m().queueClear(),S!==null&&clearInterval(S)}),(i,s)=>{const q=Be,G=je,f=Te,r=be,B=Ie,C=Pe,H=Ae,V=Le,d=Oe,_e=Ue,fe=Ne,Q=Re,de=De;return n(),$("div",{ref_key:"element",ref:I,class:"pageOutput",full:""},[e(B,{gap:[8,28],split:E},{default:t(()=>[(n(!0),$(U,null,Y(a(l),(_,g)=>(n(),o(C,{key:`pageOutput-item-generate-${g}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(G,{per:a(M)},{default:t(()=>[e(Se,{onClick:W=>me(g)},{default:t(()=>[e(q,{src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(B,{justify:"center",gap:"20"},{default:t(()=>[e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:W=>ue(g)},{default:t(()=>[e(f,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(r,{w:"20",h:"20","no-padding":"",link:"",onClick:W=>ce(g)},{default:t(()=>[e(f,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(y)?v("",!0):(n(!0),$(U,{key:0},Y(E-a(l).length%E,_=>(n(),o(G,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:a(M)},{default:t(()=>[_===1?(n(),o(d,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"",onMouseover:g=>P.value=_,onMouseleave:s[0]||(s[0]=g=>P.value=-1)},{default:t(()=>[a(j)?(n(),o(q,{key:1,src:a(j),cover:""},null,8,["src"])):(n(),o(H,{key:0,w:"100%",h:"100%",animation:""})),a(O)?v("",!0):(n(),o(d,{key:2,absolute:"",top:"8",left:"8",color:"dark90","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4","bg-blur":""},{default:t(()=>[a(T)&&a(b)>0?(n(),o(V,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[h(Z(Math.round(a(b)*100))+"% ",1)]),_:1})):(n(),o(V,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[h(Z(a(D)),1)]),_:1}))]),_:1})),e(fe,{duration:"100"},{default:t(()=>[a(P)===_||a(p)?(n(),o(d,{key:0,absolute:"",top:"0",left:"0",w:"100%",h:"100%",color:"dark60"},{default:t(()=>[e(_e,null,{default:t(()=>[a(p)?(n(),o(r,{key:1,link:"",onClick:z},{default:t(()=>[e(f,{name:"play",size:"20",color:"light"})]),_:1})):(n(),o(r,{key:0,link:"",onClick:pe},{default:t(()=>[e(f,{name:"pause",size:"20",color:"light"})]),_:1}))]),_:1})]),_:1})):v("",!0)]),_:2},1024)]),_:2},1032,["onMouseover"])):(n(),o(H,{key:1,w:"100%",h:"100%",animation:!a(se),delay:_/E*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(d,{h:"36"}),a(y)?(n(),o(C,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Me,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(Q,null,{default:t(()=>[e(C,{justify:"stretch",gap:"20"},{default:t(()=>[e(r,{onClick:ie},{default:t(()=>s[1]||(s[1]=[h(" 内容を変更してやり直す ")])),_:1}),e(r,{info:"",onClick:re},{default:t(()=>s[2]||(s[2]=[h(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):v("",!0),e(de,null,{default:t(()=>[!a(y)&&a(p)?(n(),o(Q,{key:0},{default:t(()=>[e(C,{justify:"center"},{default:t(()=>[e(r,{info:""},{default:t(()=>s[3]||(s[3]=[h(" 続けて他の原図を生成する ")])),_:1}),e(d,{h:"0"}),e(r,{minimal:"",onClick:x},{default:t(()=>s[4]||(s[4]=[h(" 終了する ")])),_:1})]),_:1})]),_:1})):v("",!0)]),_:1}),a(A)?(n(),$(U,{key:1},[(n(),o(J,{to:"#headerWideCenter"},[e(B,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(qe,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(xe,{class:Ce(["headerPrompt-list-inner",{_empty:a(c).prompt.length===0}]),name:"プロンプト",data:a(c).prompt},null,8,["class","data"])]),_:1}),e(d,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(r,{w:"100%",h:"100%",info:"",onClick:le},{default:t(()=>[e(f,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(J,{to:"#headerWideRightEnd"},[e(r,{class:"headerEndBtn",link:"",xsmall:"",onClick:x},{default:t(()=>[e(f,{name:"cross",size:"20"})]),_:1})]))],64)):v("",!0)],512)}}});export{Xe as default};
