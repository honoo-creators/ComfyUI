import{d as R,a9 as V,z,c as L,f as r,k as l,w as o,h as n,i as e,q as u,B as g,D as I,ai as h,aD as W,a0 as D,$ as O,e as P,aj as q,C as F,W as M,V as Q,_ as Y,aq as H,y as J,a2 as K,a as X}from"./CvNwVGvF.js";import{_ as Z}from"./DCrCMofR.js";import{_ as ee}from"./jO_HZLqU.js";import{_ as te,a as w}from"./fuiV-uq0.js";import{u as N}from"./-l16dqB2.js";import{u as ae}from"./CKGx6a2W.js";import"./DFiSov9q.js";import"./KL11dRCu.js";const me=R({__name:"confirm",setup(oe){const{lookStyle:E,base64:k,imageFile:S,promptA:d,promptB:c,promptC:m,promptD:f,customWorkflow:$}=N(),{face:U,name:A,ticket:v}=V(),j=X(),T=ae(),C=z(!1),x=L(()=>D().public.COMFYUI_GENERATE_ENABLED),B=()=>{h().alert({title:"ComfyUI Queue Disabled",message:"この環境では画像生成が許可されていません。",icon:"prohibited"})},G=async()=>{C.value=!0;try{const _=await W().optimize(k,512e3),{original_image_id:i}=await j.upload.originalImage(_);let a;if($)a=$,a&&typeof a=="object"&&"nodes"in a&&a.nodes.forEach(t=>{t.type==="CLIPTextEncode"&&Array.isArray(t.widgets_values)&&t.widgets_values.length>0&&(d.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},What to draw,${d.join(",")}`),c.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},Environment around,${c.join(",")}`),m.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},Color tone and mood,${m.join(",")}`),f.length>0&&(t.widgets_values[0]=`${String(t.widgets_values[0])},Lighting,${f.join(",")}`))});else{const{workflow:s}=await j.template.workflow({backgroundArtStyleId:2,prompt:[d,c,m,f].join(" "),retry_count:0,original_image_id:i});a=s}if(D().public.ENVIRONMENT==="local"){const{name:s}=await T.upload.image(S);typeof a=="object"&&a!==null&&"nodes"in a&&a.nodes.forEach(b=>{const p=b;p.type==="LoadImage"&&(p.widgets_values=p.widgets_values.map(y=>typeof y=="string"?s:y))})}N().setWorkflow(a),O().push(P().OUTPUT)}catch(_){C.value=!1,_ instanceof q?h().error(_):h().error({title:"Generate Error",message:"生成に失敗しました。",icon:"exclamation",button:"閉じる",code:F.UnknownError,name:"UnknownError"})}};return(_,i)=>{const a=M,s=Q,t=Y,b=H,p=J,y=K;return r(),l(s,{class:"pageGenerateConfirm",gap:"28"},{default:o(()=>[n(a,null,{default:o(()=>[n(Z,{icon:"document",title:"設定内容の確認",body:"設定内容をご確認ください"})]),_:1}),n(a,null,{default:o(()=>[n(s,{justify:"stretch",gap:"32"},{default:o(()=>[n(s,{justify:"stretch",gap:"8"},{default:o(()=>[e(E)?(r(),l(ee,{key:0,class:"pageGenerateConfirm-lookstyle",data:e(E)},null,8,["data"])):u("",!0),e(k)?(r(),l(te,{key:1,data:e(k)},null,8,["data"])):u("",!0),e(d)?(r(),l(w,{key:2,data:e(d),name:"何を描くか"},null,8,["data"])):u("",!0),e(c)?(r(),l(w,{key:3,data:e(c),name:"周りの環境"},null,8,["data"])):u("",!0),e(m)?(r(),l(w,{key:4,data:e(m),name:"色調・ムード"},null,8,["data"])):u("",!0),e(f)?(r(),l(w,{key:5,data:e(f),name:"ライティング"},null,8,["data"])):u("",!0)]),_:1}),n(t,{title3:"",center:""},{default:o(()=>i[0]||(i[0]=[g(" 上記の設定で背景美術を生成します。 ")])),_:1}),n(s,{justify:"center",gap:"8"},{default:o(()=>[n(b,{src:e(U),size:"72"},null,8,["src"]),n(t,{headline:"",extrabold:"",center:""},{default:o(()=>[g(I(e(A)),1)]),_:1}),e(v)!==1/0?(r(),l(p,{key:0,justify:"center",align:"end",gap:"1",nowrap:""},{default:o(()=>[n(t,{body:"",bold:"","baseline-height":""},{default:o(()=>[g(I(e(v)),1)]),_:1}),n(t,{caption2:"",bold:"","baseline-height":""},{default:o(()=>i[1]||(i[1]=[g(" チケット ")])),_:1})]),_:1})):u("",!0)]),_:1}),n(y,{loading:e(C),disabled:!e(x),onClick:G,onDisabledClick:B},{default:o(()=>i[2]||(i[2]=[g(" 生成する ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})}}});export{me as default};
