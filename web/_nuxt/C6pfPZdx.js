import{d as de,aI as ge,x as r,h as D,P as ve,o as he,ax as Q,aS as ke,X as ye,a5 as m,f as n,g as E,z as e,w as t,F as L,G as W,Y as a,l as h,i as o,A as k,p as we,aK as F,a0 as Y,n as J,c as N,e as Ce,aH as $e,D as Ee,a2 as Te,t as Ie,U as be,E as Pe,V as Se,aJ as Oe,B as K,ar as Re,a8 as ze,_ as Be,a6 as De,R as Le}from"./DYIiZsNF.js";import{_ as Ne}from"./JH4K3dxB.js";import{_ as Ue}from"./DpsycgDG.js";import{_ as je}from"./5iOGN6sp.js";import{_ as Ae}from"./Cw-ZWkYx.js";import{_ as Me}from"./Dr79C56m.js";import{_ as xe}from"./NPm6Fh3r.js";const qe=1e3,T=3,X=99,Ke=de({__name:"output",setup(Ge){const{isQueue:y,output:Z,isInitQueue:I,progress:b}=m(),c=ge(),P=r(null),ee=r(0),te=r(0),ae=r(!1),p=r(!1),l=r([]),U=r(!1),j=r("Starting."),S=r(-1),f=r(!1);let O=1,R;const w=D(()=>l.value.length===X),ne=D(()=>!I.value&&(b.value>=0||l.value.length>0)?!0:I.value),A=D(()=>c.imageHeight/c.imageWidth*100),oe=async()=>{await Y().open({name:"prompt"})||(y.value&&m().postInterrupt(),m().queueClear(),ee.value=0,te.value=0,ae.value=!1,l.value=[],await Q(),await c.setWorkflow(),c.incrementRetryCount(),C())},se=()=>{c.incrementRetryCount(),J(N().GENERATE_UPLOAD)},le=()=>{c.init(),J(N().GENERATE_LOOKSTYLE)},ue=async u=>{f.value=!0,await Y().open({name:"upscaleSelect",options:{src:l.value[u]}}),f.value=!1,z()},ie=u=>{l.value.splice(u,1)},M=()=>{l.value=[],Ce().replace(N().dashboard())},re=async u=>{await Re().open({name:"imagePreview",options:{index:u,list:l.value,onDownloadStart:()=>f.value=!0,onDownloadEnd:()=>f.value=!1}}),y.value||z()},C=async()=>{w.value||p.value||(y.value?(await $e().wait(qe),C()):(p.value=!1,m().queuePrompt({json:JSON.stringify(c.workflow),batchCount:X-l.value.length})))},ce=()=>{p.value=!0,m().postInterrupt(),m().queueClear()},z=()=>{p.value=!1,C()};return ve(()=>Z.value,u=>{if(!f.value&&u&&u.length>0){const s=u[u.length-1];s.includes("upscale")||l.value.push(s),P.value&&P.value.scrollIntoView({behavior:"smooth",block:"end"})}},{deep:!0}),he(async()=>{await Q(),C(),R=ke(()=>{O=O%3+1,j.value=" Starting "+".".repeat(O)},1e3),U.value=!0}),ye(()=>{y.value&&m().postInterrupt(),m().queueClear(),R!==null&&clearInterval(R)}),(u,s)=>{const me=ze,x=Ne,d=Ee,i=Te,B=Ie,$=be,q=Ue,G=Be,g=Pe,pe=De,_e=Le,H=Se,fe=je;return n(),E("div",{ref_key:"element",ref:P,class:"pageOutput",full:""},[e(B,{gap:"8",split:T},{default:t(()=>[(n(!0),E(L,null,W(a(l),(_,v)=>(n(),o($,{key:`pageOutput-item-generate-${v}`,class:"pageOutput-img",justify:"center",gap:"10"},{default:t(()=>[e(x,{per:a(A)},{default:t(()=>[e(Oe,{onClick:V=>re(v)},{default:t(()=>[e(me,{src:_,cover:""},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1032,["per"]),e(B,{justify:"center",gap:"20"},{default:t(()=>[e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:V=>ue(v)},{default:t(()=>[e(d,{name:"download",size:"20"})]),_:2},1032,["onClick"]),e(i,{w:"20",h:"20","no-padding":"",link:"",onClick:V=>ie(v)},{default:t(()=>[e(d,{name:"trush",size:"20"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(w)?h("",!0):(n(!0),E(L,{key:0},W(T-a(l).length%T,_=>(n(),o(x,{key:`pageOutput-item-${_}`,class:"pageOutput-img",per:a(A)},{default:t(()=>[_===1?(n(),o(g,{key:0,class:"pageOutput-img-progress",w:"100%",h:"100%",relative:"",onMouseover:v=>S.value=_,onMouseleave:s[0]||(s[0]=v=>S.value=-1)},{default:t(()=>[e(q,{w:"100%",h:"100%",animation:""}),a(f)?h("",!0):(n(),o(g,{key:0,absolute:"",top:"8",left:"8",color:"dark","min-w":"32",r:"4",pt:"4",pb:"4",pr:"4",pl:"4"},{default:t(()=>[a(I)&&a(b)>0?(n(),o(G,{key:0,callout:"",bold:"",center:"",color:"light","baseline-height":""},{default:t(()=>[k(K(Math.round(a(b)*100))+"% ",1)]),_:1})):(n(),o(G,{key:1,callout:"",bold:"",color:"light","baseline-height":"",style:{width:"56px"}},{default:t(()=>[k(K(a(j)),1)]),_:1}))]),_:1})),e(_e,{duration:"100"},{default:t(()=>[a(S)===_||a(p)?(n(),o(g,{key:0,absolute:"",top:"0",left:"0",w:"100%",h:"100%"},{default:t(()=>[e(pe,null,{default:t(()=>[a(p)?(n(),o(i,{key:1,link:"",onClick:z},{default:t(()=>[e(d,{name:"play",size:"20"})]),_:1})):(n(),o(i,{key:0,link:"",onClick:ce},{default:t(()=>[e(d,{name:"pause",size:"20"})]),_:1}))]),_:1})]),_:1})):h("",!0)]),_:2},1024)]),_:2},1032,["onMouseover"])):(n(),o(q,{key:1,w:"100%",h:"100%",animation:!a(ne),delay:_/T*150},null,8,["animation","delay"]))]),_:2},1032,["per"]))),128))]),_:1}),e(g,{h:"36"}),a(w)?(n(),o($,{key:0,justify:"center",gap:"40"},{default:t(()=>[e(Ae,{icon:"checkCircleLine",body:"生成画像は以上です"}),e(H,null,{default:t(()=>[e($,{justify:"stretch",gap:"20"},{default:t(()=>[e(i,{onClick:se},{default:t(()=>s[1]||(s[1]=[k(" 内容を変更してやり直す ")])),_:1}),e(i,{info:"",onClick:le},{default:t(()=>s[2]||(s[2]=[k(" 新しい背景美術を生成する ")])),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),e(fe,null,{default:t(()=>[!a(w)&&a(p)?(n(),o(H,{key:0},{default:t(()=>[e($,{justify:"center"},{default:t(()=>[e(i,{info:""},{default:t(()=>s[3]||(s[3]=[k(" 続けて他の原図を生成する ")])),_:1}),e(g,{h:"0"}),e(i,{minimal:"",onClick:M},{default:t(()=>s[4]||(s[4]=[k(" 終了する ")])),_:1})]),_:1})]),_:1})):h("",!0)]),_:1}),a(U)?(n(),E(L,{key:1},[(n(),o(F,{to:"#headerWideCenter"},[e(B,{class:"headerPrompt",justify:"center",align:"center",gap:"8",nowrap:""},{default:t(()=>[e(xe,{class:"headerPrompt-list",name:"プロンプト",icon:"edit",current:"","is-set":"",disabled:""},{default:t(()=>[e(Me,{class:we(["headerPrompt-list-inner",{_empty:a(c).prompt.length===0}]),name:"プロンプト",data:a(c).prompt},null,8,["class","data"])]),_:1}),e(g,{"min-w":"40",w:"20","min-h":"40",h:"20",relative:""},{default:t(()=>[e(i,{w:"100%",h:"100%",info:"",onClick:oe},{default:t(()=>[e(d,{name:"edit",size:"20",color:"gradationHorizontal"})]),_:1})]),_:1})]),_:1})])),(n(),o(F,{to:"#headerWideRightEnd"},[e(i,{class:"headerEndBtn",link:"",xsmall:"",onClick:M},{default:t(()=>[e(d,{name:"cross",size:"20"})]),_:1})]))],64)):h("",!0)],512)}}});export{Ke as default};
